var Quadtree;Quadtree=function(){function e(t){var n,i;if(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.maxElements=t.maxElements,null==this.width||null==this.height)throw new Error("Missing quadtree dimensions.");if(null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.maxElements&&(this.maxElements=1),this.contents=[],this.oversized=[],this.size=0,this.x<0||this.y<0||this.width<1||this.height<1)throw new Error("Dimensions and coordinates must be positive integers.");if(this.maxElements<1)throw new Error("The maximum number of elements before a split must be a positive integer.");i=this,this.children={NW:{create:function(){return new e({x:i.x,y:i.y,width:Math.max(Math.floor(i.width/2),1),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},NE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y,width:Math.ceil(i.width/2),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},SW:{create:function(){return new e({x:i.x,y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.max(Math.floor(i.width/2),1),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null},SE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.ceil(i.width/2),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null}};for(n in this.children)this.children[n].get=function(){return null!=this.tree?this.tree:(this.tree=this.create(),this.tree)}}var t,n,i,r,h;return n=function(e){var t,n;return{x:Math.floor((null!=(t=e.width)?t:1)/2)+e.x,y:Math.floor((null!=(n=e.height)?n:1)/2)+e.y}},h=function(e){if(null==e.x||null==e.y||e.x<0||e.y<0)throw new Error("Object must contain x or y positions as arguments, and they must be positive integers.");if((null!=e?e.width:void 0)<0||(null!=e?e.height:void 0)<0)throw new Error("Width and height must be positive integers.")},t=function(e,t){var i;return i=n(t),e.x<i.x?e.y<i.y?"NW":"SW":e.y<i.y?"NE":"SE"},i=function(e,t){var n,i;return e.x<t.x||e.x+(null!=(n=e.width)?n:0)>=t.x+t.width||e.y<t.y||e.y+(null!=(i=e.height)?i:0)>=t.y+t.height},r=function(e,t){var n;return n=function(n){return e["_"+n]=e[n],Object.defineProperty(e,n,{set:function(e){return t.remove(this),this["_"+n]=e,t.push(this)},get:function(){return this["_"+n]},configurable:!0})},n("x"),n("y"),n("width"),n("height")},e.prototype.push=function(e,t){return this.pushAll([e],t)},e.prototype.pushAll=function(e,n){var l,o,s,u,f,c,d,a,m,p,x,g,y,v,w,E,z,M,b;for(p=0,y=e.length;p<y;p++)m=e[p],h(m),n&&r(m,this);for(d=[{tree:this,elements:e}];d.length>0;){for(M=d.shift(),b=M.tree,c=M.elements,a={NW:null,NE:null,SW:null,SE:null},x=0,v=c.length;x<v;x++)if(f=c[x],b.size++,u=t(f,b),z=b.children[u],1===b.width||1===b.height||i(f,z.create()))b.oversized.push(f);else if(b.size<=b.maxElements)b.contents.push(f);else{for(null==a[u]&&(a[u]={tree:z.get(),elements:[]}),a[u].elements.push(f),E=b.contents,g=0,w=E.length;g<w;g++)o=E[g],s=t(o,b),null==a[s]&&(a[s]={tree:b.children[s].get(),elements:[]}),a[s].elements.push(o);b.contents=[]}for(u in a)l=a[u],null!=l&&d.push(l)}return this},e.prototype.remove=function(e){var n,i;return h(e),n=this.oversized.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(n=this.contents.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(i=this.children[t(e,this)],null!=i.tree&&(!!i.tree.remove(e)&&(this.size--,0===i.tree.size&&(i.tree=null),!0))))},e.prototype.colliding=function(e,n){var r,l,o,s,u,f,c,d,a,m,p,x,g;for(h(e),r=function(e,t){var n,i,r,h;return!(e.x>t.x+(null!=(n=t.width)?n:0)||e.x+(null!=(i=e.width)?i:0)<t.x||e.y>t.y+(null!=(r=t.height)?r:0)||e.y+(null!=(h=e.height)?h:0)<t.y)},null==n&&(n=r),u=[],s=[this];s.length>0;){for(g=s.shift(),m=g.oversized,f=0,d=m.length;f<d;f++)o=m[f],o!==e&&n(e,o)&&u.push(o);for(p=g.contents,c=0,a=p.length;c<a;c++)o=p[c],o!==e&&n(e,o)&&u.push(o);if(x=g.children[t(e,g)],i(e,x.create()))for(l in g.children)null!=g.children[l].tree&&r(g.children[l].tree,e)&&s.push(g.children[l].tree);else null!=x.tree&&s.push(x.tree)}return u},e.prototype.get=function(e){return this.where(e)},e.prototype.where=function(e){var n,i,r,l,o,s,u,f,c,d,a,m,p;if("object"==typeof e&&null==e.x&&null==e.y)return this.find(function(t){var n,i;n=!0;for(i in e)e[i]!==t[i]&&(n=!1);return n});for(h(e),l=[],r=[this];r.length>0;){for(p=r.shift(),d=p.oversized,o=0,f=d.length;o<f;o++){i=d[o],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}for(a=p.contents,s=0,c=a.length;s<c;s++){i=a[s],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}m=p.children[t(e,p)],null!=m.tree&&r.push(m.tree)}return l},e.prototype.each=function(e){var t,n,i,r,h,l,o,s,u,f;for(n=[this];n.length>0;){for(f=n.shift(),s=f.oversized,r=0,l=s.length;r<l;r++)i=s[r],"function"==typeof e&&e(i);for(u=f.contents,h=0,o=u.length;h<o;h++)i=u[h],"function"==typeof e&&e(i);for(t in f.children)null!=f.children[t].tree&&n.push(f.children[t].tree)}return this},e.prototype.find=function(e){var t,n,i,r,h,l,o,s,u,f,c;for(n=[this],r=[];n.length>0;){for(c=n.shift(),u=c.oversized,h=0,o=u.length;h<o;h++)i=u[h],("function"==typeof e?e(i):void 0)&&r.push(i);for(f=c.contents,l=0,s=f.length;l<s;l++)i=f[l],("function"==typeof e?e(i):void 0)&&r.push(i);for(t in c.children)null!=c.children[t].tree&&n.push(c.children[t].tree)}return r},e.prototype.filter=function(t){var n;return(n=function(i){var r,h,l,o,s,u,f,c,d,a,m;h=new e({x:i.x,y:i.y,width:i.width,height:i.height,maxElements:i.maxElements}),h.size=0;for(r in i.children)null!=i.children[r].tree&&(h.children[r].tree=n(i.children[r].tree),h.size+=null!=(c=null!=(d=h.children[r].tree)?d.size:void 0)?c:0);for(a=i.oversized,o=0,u=a.length;o<u;o++)l=a[o],(null==t||("function"==typeof t?t(l):void 0))&&h.oversized.push(l);for(m=i.contents,s=0,f=m.length;s<f;s++)l=m[s],(null==t||("function"==typeof t?t(l):void 0))&&h.contents.push(l);return h.size+=h.oversized.length+h.contents.length,0===h.size?null:h})(this)},e.prototype.reject=function(e){return this.filter(function(t){return!("function"==typeof e?e(t):void 0)})},e.prototype.visit=function(e){var t,n,i;for(n=[this];n.length>0;){i=n.shift(),e.bind(i)();for(t in i.children)null!=i.children[t].tree&&n.push(i.children[t].tree)}return this},e}(),"undefined"!=typeof module&&null!==module&&(module.exports=Quadtree);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1YWR0cmVlLmNvZmZlZSIsInF1YWR0cmVlLmpzIl0sIm5hbWVzIjpbIlF1YWR0cmVlIiwiYXJnIiwiY2hpbGQiLCJ0aGF0IiwidGhpcyIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXhFbGVtZW50cyIsIkVycm9yIiwiY29udGVudHMiLCJvdmVyc2l6ZWQiLCJzaXplIiwiY2hpbGRyZW4iLCJOVyIsImNyZWF0ZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsInRyZWUiLCJORSIsImNlaWwiLCJTVyIsIlNFIiwiZ2V0IiwiY2FsY3VsYXRlRGlyZWN0aW9uIiwiZ2V0Q2VudGVyIiwiaXNPdmVyc2l6ZWQiLCJvYnNlcnZlIiwidmFsaWRhdGVFbGVtZW50IiwiaXRlbSIsInJlZiIsInJlZjEiLCJlbGVtZW50IiwicXVhZENlbnRlciIsIndyaXRlQWNjZXNzb3JzIiwicHJvcE5hbWUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInNldCIsInZhbCIsInJlbW92ZSIsInB1c2giLCJjb25maWd1cmFibGUiLCJwcm90b3R5cGUiLCJkb09ic2VydmUiLCJwdXNoQWxsIiwiaXRlbXMiLCJjYW5kaWRhdGUiLCJjb250ZW50IiwiY29udGVudERpciIsImRpcmVjdGlvbiIsImVsZW1lbnRzIiwiZmlmbyIsImZpZm9DYW5kaWRhdGVzIiwiaiIsImsiLCJsIiwibGVuIiwibGVuMSIsImxlbjIiLCJyZWxhdGVkQ2hpbGQiLCJ0b3AiLCJsZW5ndGgiLCJzaGlmdCIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImNvbGxpZGluZyIsImNvbGxpc2lvbkZ1bmN0aW9uIiwiYm91bmRpbmdCb3hDb2xsaXNpb24iLCJlbHQiLCJlbHQxIiwiZWx0MiIsInJlZjIiLCJyZWYzIiwicXVlcnkiLCJ3aGVyZSIsImNoZWNrIiwia2V5IiwiZmluZCIsImVhY2giLCJhY3Rpb24iLCJpIiwicHJlZGljYXRlIiwiZmlsdGVyIiwiZGVlcGNsb25lIiwidGFyZ2V0IiwiY29weWNhdCIsInJl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QixNQUM1QmtDLEVBQUtYLEtBQUt4QyxFQUFLVyxTQUFTWixHQUFPa0IsTUNxSDNDLE1EcEhJaEIsT0N1SENKLEtBSWEsbUJBQVg2RixTQUFxQyxPQUFYQSxTRHhIckNBLE9BQVFDLFFBQVU5RiIsImZpbGUiOiJxdWFkdHJlZS5qcyIsInNvdXJjZXNDb250ZW50IjpbbnVsbCwidmFyIFF1YWR0cmVlO1xuXG5RdWFkdHJlZSA9IChmdW5jdGlvbigpIHtcbiAgdmFyIGNhbGN1bGF0ZURpcmVjdGlvbiwgZ2V0Q2VudGVyLCBpc092ZXJzaXplZCwgb2JzZXJ2ZSwgdmFsaWRhdGVFbGVtZW50O1xuXG4gIGZ1bmN0aW9uIFF1YWR0cmVlKGFyZykge1xuICAgIHZhciBjaGlsZCwgdGhhdDtcbiAgICB0aGlzLnggPSBhcmcueCwgdGhpcy55ID0gYXJnLnksIHRoaXMud2lkdGggPSBhcmcud2lkdGgsIHRoaXMuaGVpZ2h0ID0gYXJnLmhlaWdodCwgdGhpcy5tYXhFbGVtZW50cyA9IGFyZy5tYXhFbGVtZW50cztcbiAgICBpZiAoKHRoaXMud2lkdGggPT0gbnVsbCkgfHwgKHRoaXMuaGVpZ2h0ID09IG51bGwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIHF1YWR0cmVlIGRpbWVuc2lvbnMuXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy54ID09IG51bGwpIHtcbiAgICAgIHRoaXMueCA9IDA7XG4gICAgfVxuICAgIGlmICh0aGlzLnkgPT0gbnVsbCkge1xuICAgICAgdGhpcy55ID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMubWF4RWxlbWVudHMgPT0gbnVsbCkge1xuICAgICAgdGhpcy5tYXhFbGVtZW50cyA9IDE7XG4gICAgfVxuICAgIHRoaXMuY29udGVudHMgPSBbXTtcbiAgICB0aGlzLm92ZXJzaXplZCA9IFtdO1xuICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgaWYgKHRoaXMueCA8IDAgfHwgdGhpcy55IDwgMCB8fCB0aGlzLndpZHRoIDwgMSB8fCB0aGlzLmhlaWdodCA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkRpbWVuc2lvbnMgYW5kIGNvb3JkaW5hdGVzIG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhFbGVtZW50cyA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBtYXhpbXVtIG51bWJlciBvZiBlbGVtZW50cyBiZWZvcmUgYSBzcGxpdCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci5cIik7XG4gICAgfVxuICAgIHRoYXQgPSB0aGlzO1xuICAgIHRoaXMuY2hpbGRyZW4gPSB7XG4gICAgICBcIk5XXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCxcbiAgICAgICAgICAgIHk6IHRoYXQueSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmVlOiBudWxsXG4gICAgICB9LFxuICAgICAgXCJORVwiOiB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICB4OiB0aGF0LnggKyBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICB5OiB0aGF0LnksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsKHRoYXQud2lkdGggLyAyKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIlNXXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCxcbiAgICAgICAgICAgIHk6IHRoYXQueSArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwodGhhdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIlNFXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHk6IHRoYXQueSArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsKHRoYXQud2lkdGggLyAyKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5jZWlsKHRoYXQuaGVpZ2h0IC8gMiksXG4gICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmVlOiBudWxsXG4gICAgICB9XG4gICAgfTtcbiAgICBmb3IgKGNoaWxkIGluIHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgIHRoaXMuY2hpbGRyZW5bY2hpbGRdLmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMudHJlZSA9IHRoaXMuY3JlYXRlKCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBnZXRDZW50ZXIgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgdmFyIHJlZiwgcmVmMTtcbiAgICByZXR1cm4ge1xuICAgICAgeDogTWF0aC5mbG9vcigoKHJlZiA9IGl0ZW0ud2lkdGgpICE9IG51bGwgPyByZWYgOiAxKSAvIDIpICsgaXRlbS54LFxuICAgICAgeTogTWF0aC5mbG9vcigoKHJlZjEgPSBpdGVtLmhlaWdodCkgIT0gbnVsbCA/IHJlZjEgOiAxKSAvIDIpICsgaXRlbS55XG4gICAgfTtcbiAgfTtcblxuICB2YWxpZGF0ZUVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgaWYgKCF0eXBlb2YgZWxlbWVudCA9PT0gXCJvYmplY3RcIiB8fCAoZWxlbWVudC54ID09IG51bGwpIHx8IChlbGVtZW50LnkgPT0gbnVsbCkgfHwgZWxlbWVudC54IDwgMCB8fCBlbGVtZW50LnkgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPYmplY3QgbXVzdCBjb250YWluIHggb3IgeSBwb3NpdGlvbnMgYXMgYXJndW1lbnRzLCBhbmQgdGhleSBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiKTtcbiAgICB9XG4gICAgaWYgKChlbGVtZW50ICE9IG51bGwgPyBlbGVtZW50LndpZHRoIDogdm9pZCAwKSA8IDAgfHwgKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQuaGVpZ2h0IDogdm9pZCAwKSA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIldpZHRoIGFuZCBoZWlnaHQgbXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7XG4gICAgfVxuICB9O1xuXG4gIGNhbGN1bGF0ZURpcmVjdGlvbiA9IGZ1bmN0aW9uKGVsZW1lbnQsIHRyZWUpIHtcbiAgICB2YXIgcXVhZENlbnRlcjtcbiAgICBxdWFkQ2VudGVyID0gZ2V0Q2VudGVyKHRyZWUpO1xuICAgIGlmIChlbGVtZW50LnggPCBxdWFkQ2VudGVyLngpIHtcbiAgICAgIGlmIChlbGVtZW50LnkgPCBxdWFkQ2VudGVyLnkpIHtcbiAgICAgICAgcmV0dXJuIFwiTldcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIlNXXCI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlbGVtZW50LnkgPCBxdWFkQ2VudGVyLnkpIHtcbiAgICAgICAgcmV0dXJuIFwiTkVcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIlNFXCI7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGlzT3ZlcnNpemVkID0gZnVuY3Rpb24oZWxlbWVudCwgdHJlZSkge1xuICAgIHZhciByZWYsIHJlZjE7XG4gICAgcmV0dXJuIGVsZW1lbnQueCA8IHRyZWUueCB8fCBlbGVtZW50LnggKyAoKHJlZiA9IGVsZW1lbnQud2lkdGgpICE9IG51bGwgPyByZWYgOiAwKSA+PSB0cmVlLnggKyB0cmVlLndpZHRoIHx8IGVsZW1lbnQueSA8IHRyZWUueSB8fCBlbGVtZW50LnkgKyAoKHJlZjEgPSBlbGVtZW50LmhlaWdodCkgIT0gbnVsbCA/IHJlZjEgOiAwKSA+PSB0cmVlLnkgKyB0cmVlLmhlaWdodDtcbiAgfTtcblxuICBvYnNlcnZlID0gZnVuY3Rpb24oaXRlbSwgdHJlZSkge1xuICAgIHZhciB3cml0ZUFjY2Vzc29ycztcbiAgICB3cml0ZUFjY2Vzc29ycyA9IGZ1bmN0aW9uKHByb3BOYW1lKSB7XG4gICAgICBpdGVtW1wiX1wiICsgcHJvcE5hbWVdID0gaXRlbVtwcm9wTmFtZV07XG4gICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGl0ZW0sIHByb3BOYW1lLCB7XG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdHJlZS5yZW1vdmUodGhpcyk7XG4gICAgICAgICAgdGhpc1tcIl9cIiArIHByb3BOYW1lXSA9IHZhbDtcbiAgICAgICAgICByZXR1cm4gdHJlZS5wdXNoKHRoaXMpO1xuICAgICAgICB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW1wiX1wiICsgcHJvcE5hbWVdO1xuICAgICAgICB9LFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgIH0pO1xuICAgIH07XG4gICAgd3JpdGVBY2Nlc3NvcnMoXCJ4XCIpO1xuICAgIHdyaXRlQWNjZXNzb3JzKFwieVwiKTtcbiAgICB3cml0ZUFjY2Vzc29ycyhcIndpZHRoXCIpO1xuICAgIHJldHVybiB3cml0ZUFjY2Vzc29ycyhcImhlaWdodFwiKTtcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uKGl0ZW0sIGRvT2JzZXJ2ZSkge1xuICAgIHJldHVybiB0aGlzLnB1c2hBbGwoW2l0ZW1dLCBkb09ic2VydmUpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5wdXNoQWxsID0gZnVuY3Rpb24oaXRlbXMsIGRvT2JzZXJ2ZSkge1xuICAgIHZhciBjYW5kaWRhdGUsIGNvbnRlbnQsIGNvbnRlbnREaXIsIGRpcmVjdGlvbiwgZWxlbWVudCwgZWxlbWVudHMsIGZpZm8sIGZpZm9DYW5kaWRhdGVzLCBpdGVtLCBqLCBrLCBsLCBsZW4sIGxlbjEsIGxlbjIsIHJlZiwgcmVsYXRlZENoaWxkLCB0b3AsIHRyZWU7XG4gICAgZm9yIChqID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGl0ZW0gPSBpdGVtc1tqXTtcbiAgICAgIHZhbGlkYXRlRWxlbWVudChpdGVtKTtcbiAgICAgIGlmIChkb09ic2VydmUpIHtcbiAgICAgICAgb2JzZXJ2ZShpdGVtLCB0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZmlmbyA9IFtcbiAgICAgIHtcbiAgICAgICAgdHJlZTogdGhpcyxcbiAgICAgICAgZWxlbWVudHM6IGl0ZW1zXG4gICAgICB9XG4gICAgXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICB0cmVlID0gdG9wLnRyZWU7XG4gICAgICBlbGVtZW50cyA9IHRvcC5lbGVtZW50cztcbiAgICAgIGZpZm9DYW5kaWRhdGVzID0ge1xuICAgICAgICBcIk5XXCI6IG51bGwsXG4gICAgICAgIFwiTkVcIjogbnVsbCxcbiAgICAgICAgXCJTV1wiOiBudWxsLFxuICAgICAgICBcIlNFXCI6IG51bGxcbiAgICAgIH07XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gZWxlbWVudHMubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50c1trXTtcbiAgICAgICAgdHJlZS5zaXplKys7XG4gICAgICAgIGRpcmVjdGlvbiA9IGNhbGN1bGF0ZURpcmVjdGlvbihlbGVtZW50LCB0cmVlKTtcbiAgICAgICAgcmVsYXRlZENoaWxkID0gdHJlZS5jaGlsZHJlbltkaXJlY3Rpb25dO1xuICAgICAgICBpZiAodHJlZS53aWR0aCA9PT0gMSB8fCB0cmVlLmhlaWdodCA9PT0gMSB8fCBpc092ZXJzaXplZChlbGVtZW50LCByZWxhdGVkQ2hpbGQuY3JlYXRlKCkpKSB7XG4gICAgICAgICAgdHJlZS5vdmVyc2l6ZWQucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIGlmICh0cmVlLnNpemUgPD0gdHJlZS5tYXhFbGVtZW50cykge1xuICAgICAgICAgIHRyZWUuY29udGVudHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZmlmb0NhbmRpZGF0ZXNbZGlyZWN0aW9uXSA9PSBudWxsKSB7XG4gICAgICAgICAgICBmaWZvQ2FuZGlkYXRlc1tkaXJlY3Rpb25dID0ge1xuICAgICAgICAgICAgICB0cmVlOiByZWxhdGVkQ2hpbGQuZ2V0KCksXG4gICAgICAgICAgICAgIGVsZW1lbnRzOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZmlmb0NhbmRpZGF0ZXNbZGlyZWN0aW9uXS5lbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgIHJlZiA9IHRyZWUuY29udGVudHM7XG4gICAgICAgICAgZm9yIChsID0gMCwgbGVuMiA9IHJlZi5sZW5ndGg7IGwgPCBsZW4yOyBsKyspIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSByZWZbbF07XG4gICAgICAgICAgICBjb250ZW50RGlyID0gY2FsY3VsYXRlRGlyZWN0aW9uKGNvbnRlbnQsIHRyZWUpO1xuICAgICAgICAgICAgaWYgKGZpZm9DYW5kaWRhdGVzW2NvbnRlbnREaXJdID09IG51bGwpIHtcbiAgICAgICAgICAgICAgZmlmb0NhbmRpZGF0ZXNbY29udGVudERpcl0gPSB7XG4gICAgICAgICAgICAgICAgdHJlZTogdHJlZS5jaGlsZHJlbltjb250ZW50RGlyXS5nZXQoKSxcbiAgICAgICAgICAgICAgICBlbGVtZW50czogW11cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpZm9DYW5kaWRhdGVzW2NvbnRlbnREaXJdLmVsZW1lbnRzLnB1c2goY29udGVudCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyZWUuY29udGVudHMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChkaXJlY3Rpb24gaW4gZmlmb0NhbmRpZGF0ZXMpIHtcbiAgICAgICAgY2FuZGlkYXRlID0gZmlmb0NhbmRpZGF0ZXNbZGlyZWN0aW9uXTtcbiAgICAgICAgaWYgKGNhbmRpZGF0ZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgaW5kZXgsIHJlbGF0ZWRDaGlsZDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgaW5kZXggPSB0aGlzLm92ZXJzaXplZC5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLm92ZXJzaXplZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaW5kZXggPSB0aGlzLmNvbnRlbnRzLmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgIHRoaXMub3ZlcnNpemVkLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB0aGlzLnNpemUtLTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZWxhdGVkQ2hpbGQgPSB0aGlzLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihpdGVtLCB0aGlzKV07XG4gICAgaWYgKHJlbGF0ZWRDaGlsZC50cmVlID09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHJlbGF0ZWRDaGlsZC50cmVlLnJlbW92ZShpdGVtKSkge1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUuc2l6ZSA9PT0gMCkge1xuICAgICAgICByZWxhdGVkQ2hpbGQudHJlZSA9IG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuY29sbGlkaW5nID0gZnVuY3Rpb24oaXRlbSwgY29sbGlzaW9uRnVuY3Rpb24pIHtcbiAgICB2YXIgYm91bmRpbmdCb3hDb2xsaXNpb24sIGNoaWxkLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVsYXRlZENoaWxkLCB0b3A7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGJvdW5kaW5nQm94Q29sbGlzaW9uID0gZnVuY3Rpb24oZWx0MSwgZWx0Mikge1xuICAgICAgdmFyIHJlZiwgcmVmMSwgcmVmMiwgcmVmMztcbiAgICAgIHJldHVybiAhKGVsdDEueCA+IGVsdDIueCArICgocmVmID0gZWx0Mi53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDApIHx8IGVsdDEueCArICgocmVmMSA9IGVsdDEud2lkdGgpICE9IG51bGwgPyByZWYxIDogMCkgPCBlbHQyLnggfHwgZWx0MS55ID4gZWx0Mi55ICsgKChyZWYyID0gZWx0Mi5oZWlnaHQpICE9IG51bGwgPyByZWYyIDogMCkgfHwgZWx0MS55ICsgKChyZWYzID0gZWx0MS5oZWlnaHQpICE9IG51bGwgPyByZWYzIDogMCkgPCBlbHQyLnkpO1xuICAgIH07XG4gICAgaWYgKGNvbGxpc2lvbkZ1bmN0aW9uID09IG51bGwpIHtcbiAgICAgIGNvbGxpc2lvbkZ1bmN0aW9uID0gYm91bmRpbmdCb3hDb2xsaXNpb247XG4gICAgfVxuICAgIGl0ZW1zID0gW107XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgaWYgKGVsdCAhPT0gaXRlbSAmJiBjb2xsaXNpb25GdW5jdGlvbihpdGVtLCBlbHQpKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGVsdCA9IHJlZjFba107XG4gICAgICAgIGlmIChlbHQgIT09IGl0ZW0gJiYgY29sbGlzaW9uRnVuY3Rpb24oaXRlbSwgZWx0KSkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goZWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihpdGVtLCB0b3ApXTtcbiAgICAgIGlmIChpc092ZXJzaXplZChpdGVtLCByZWxhdGVkQ2hpbGQuY3JlYXRlKCkpKSB7XG4gICAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgICAgaWYgKCh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkgJiYgYm91bmRpbmdCb3hDb2xsaXNpb24odG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlLCBpdGVtKSkge1xuICAgICAgICAgICAgZmlmby5wdXNoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHJlbGF0ZWRDaGlsZC50cmVlICE9IG51bGwpIHtcbiAgICAgICAgZmlmby5wdXNoKHJlbGF0ZWRDaGlsZC50cmVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1zO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgIHJldHVybiB0aGlzLndoZXJlKHF1ZXJ5KTtcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUud2hlcmUgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgIHZhciBjaGVjaywgZWx0LCBmaWZvLCBpdGVtcywgaiwgaywga2V5LCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVsYXRlZENoaWxkLCB0b3A7XG4gICAgaWYgKHR5cGVvZiBxdWVyeSA9PT0gXCJvYmplY3RcIiAmJiAocXVlcnkueCA9PSBudWxsKSAmJiAocXVlcnkueSA9PSBudWxsKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZmluZChmdW5jdGlvbihlbHQpIHtcbiAgICAgICAgdmFyIGNoZWNrLCBrZXk7XG4gICAgICAgIGNoZWNrID0gdHJ1ZTtcbiAgICAgICAgZm9yIChrZXkgaW4gcXVlcnkpIHtcbiAgICAgICAgICBpZiAocXVlcnlba2V5XSAhPT0gZWx0W2tleV0pIHtcbiAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGVjaztcbiAgICAgIH0pO1xuICAgIH1cbiAgICB2YWxpZGF0ZUVsZW1lbnQocXVlcnkpO1xuICAgIGl0ZW1zID0gW107XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgIGlmIChxdWVyeVtrZXldICE9PSBlbHRba2V5XSkge1xuICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGVsdCA9IHJlZjFba107XG4gICAgICAgIGNoZWNrID0gdHJ1ZTtcbiAgICAgICAgZm9yIChrZXkgaW4gcXVlcnkpIHtcbiAgICAgICAgICBpZiAocXVlcnlba2V5XSAhPT0gZWx0W2tleV0pIHtcbiAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjaGVjaykge1xuICAgICAgICAgIGl0ZW1zLnB1c2goZWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihxdWVyeSwgdG9wKV07XG4gICAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICBmaWZvLnB1c2gocmVsYXRlZENoaWxkLnRyZWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmVhY2ggPSBmdW5jdGlvbihhY3Rpb24pIHtcbiAgICB2YXIgY2hpbGQsIGZpZm8sIGksIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCB0b3A7XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGkgPSByZWZbal07XG4gICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBhY3Rpb24oaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgaSA9IHJlZjFba107XG4gICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBhY3Rpb24oaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIGZpZm8ucHVzaCh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgdmFyIGNoaWxkLCBmaWZvLCBpLCBpdGVtcywgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHRvcDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIGl0ZW1zID0gW107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zaGlmdCgpO1xuICAgICAgcmVmID0gdG9wLm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpID0gcmVmW2pdO1xuICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGkpIDogdm9pZCAwKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMSA9IHRvcC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpKSA6IHZvaWQgMCkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIGZpZm8ucHVzaCh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgdmFyIGRlZXBjbG9uZTtcbiAgICBkZWVwY2xvbmUgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgIHZhciBjaGlsZCwgY29weWNhdCwgaXRlbSwgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHJlZjIsIHJlZjM7XG4gICAgICBjb3B5Y2F0ID0gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgeDogdGFyZ2V0LngsXG4gICAgICAgIHk6IHRhcmdldC55LFxuICAgICAgICB3aWR0aDogdGFyZ2V0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRhcmdldC5oZWlnaHQsXG4gICAgICAgIG1heEVsZW1lbnRzOiB0YXJnZXQubWF4RWxlbWVudHNcbiAgICAgIH0pO1xuICAgICAgY29weWNhdC5zaXplID0gMDtcbiAgICAgIGZvciAoY2hpbGQgaW4gdGFyZ2V0LmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICghKHRhcmdldC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvcHljYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUgPSBkZWVwY2xvbmUodGFyZ2V0LmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgY29weWNhdC5zaXplICs9IChyZWYgPSAocmVmMSA9IGNvcHljYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpICE9IG51bGwgPyByZWYxLnNpemUgOiB2b2lkIDApICE9IG51bGwgPyByZWYgOiAwO1xuICAgICAgfVxuICAgICAgcmVmMiA9IHRhcmdldC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYyLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGl0ZW0gPSByZWYyW2pdO1xuICAgICAgICBpZiAoKHByZWRpY2F0ZSA9PSBudWxsKSB8fCAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGl0ZW0pIDogdm9pZCAwKSkge1xuICAgICAgICAgIGNvcHljYXQub3ZlcnNpemVkLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjMgPSB0YXJnZXQuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMy5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgaXRlbSA9IHJlZjNba107XG4gICAgICAgIGlmICgocHJlZGljYXRlID09IG51bGwpIHx8ICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaXRlbSkgOiB2b2lkIDApKSB7XG4gICAgICAgICAgY29weWNhdC5jb250ZW50cy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb3B5Y2F0LnNpemUgKz0gY29weWNhdC5vdmVyc2l6ZWQubGVuZ3RoICsgY29weWNhdC5jb250ZW50cy5sZW5ndGg7XG4gICAgICBpZiAoY29weWNhdC5zaXplID09PSAwKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvcHljYXQ7XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gZGVlcGNsb25lKHRoaXMpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5yZWplY3QgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oaSkge1xuICAgICAgcmV0dXJuICEodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGkpIDogdm9pZCAwKTtcbiAgICB9KTtcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUudmlzaXQgPSBmdW5jdGlvbihhY3Rpb24pIHtcbiAgICB2YXIgY2hpbGQsIGZpZm8sIHRoYXQ7XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0aGF0ID0gZmlmby5zaGlmdCgpO1xuICAgICAgYWN0aW9uLmJpbmQodGhhdCkoKTtcbiAgICAgIGZvciAoY2hpbGQgaW4gdGhhdC5jaGlsZHJlbikge1xuICAgICAgICBpZiAodGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRoYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIHJldHVybiBRdWFkdHJlZTtcblxufSkoKTtcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gUXVhZHRyZWU7XG59XG4iXX0=
