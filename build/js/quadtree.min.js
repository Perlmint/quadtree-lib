var Quadtree;Quadtree=function(){function e(t){var n,i;if(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.maxElements=t.maxElements,null==this.width||null==this.height)throw new Error("Missing quadtree dimensions.");if(null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.maxElements&&(this.maxElements=1),this.contents=[],this.oversized=[],this.size=0,this.x<0||this.y<0||this.width<1||this.height<1)throw new Error("Dimensions and coordinates must be positive integers.");if(this.maxElements<1)throw new Error("The maximum number of elements before a split must be a positive integer.");i=this,this.children={NW:{create:function(){return new e({x:i.x,y:i.y,width:Math.max(Math.floor(i.width/2),1),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},NE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y,width:Math.ceil(i.width/2),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},SW:{create:function(){return new e({x:i.x,y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.max(Math.floor(i.width/2),1),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null},SE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.ceil(i.width/2),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null}};for(n in this.children)this.children[n].get=function(){return null!=this.tree?this.tree:(this.tree=this.create(),this.tree)}}var t,n,i,r,h;return n=function(e){var t,n;return{x:Math.floor((null!=(t=e.width)?t:1)/2)+e.x,y:Math.floor((null!=(n=e.height)?n:1)/2)+e.y}},h=function(e){if(null==e.x||null==e.y||e.x<0||e.y<0)throw new Error("Object must contain x or y positions as arguments, and they must be positive integers.");if((null!=e?e.width:void 0)<0||(null!=e?e.height:void 0)<0)throw new Error("Width and height must be positive integers.")},t=function(e,t){var i;return i=n(t),e.x<i.x?e.y<i.y?"NW":"SW":e.y<i.y?"NE":"SE"},i=function(e,t){var n,i;return e.x<t.x||e.x+(null!=(n=e.width)?n:0)>=t.x+t.width||e.y<t.y||e.y+(null!=(i=e.height)?i:0)>=t.y+t.height},r=function(e,t){var n;return n=function(n){return e["_"+n]=e[n],Object.defineProperty(e,n,{set:function(e){return t.remove(this),this["_"+n]=e,t.push(this)},get:function(){return this["_"+n]},configurable:!0})},n("x"),n("y"),n("width"),n("height")},e.prototype.push=function(e,t){return this.pushAll([e],t)},e.prototype.pushAll=function(e,n){var l,o,s,u,f,c,d,a,p,m,g,x,y,v,w,z,E,M,b;for(m=0,y=e.length;m<y;m++)p=e[m],h(p),n&&r(p,this);for(d=[{tree:this,elements:e}];d.length>0;){for(M=d.shift(),b=M.tree,c=M.elements,a={NW:null,NE:null,SW:null,SE:null},g=0,v=c.length;g<v;g++)if(f=c[g],b.size++,u=t(f,b),E=b.children[u],1===b.width||1===b.height||i(f,E.create()))b.oversized.push(f);else if(b.size-b.oversized.length<=b.maxElements)b.contents.push(f);else{for(null==a[u]&&(a[u]={tree:E.get(),elements:[]}),a[u].elements.push(f),z=b.contents,x=0,w=z.length;x<w;x++)o=z[x],s=t(o,b),null==a[s]&&(a[s]={tree:b.children[s].get(),elements:[]}),a[s].elements.push(o);b.contents=[]}for(u in a)l=a[u],null!=l&&d.push(l)}return this},e.prototype.remove=function(e){var n,i;return h(e),n=this.oversized.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(n=this.contents.indexOf(e),n>-1?(this.contents.splice(n,1),this.size--,!0):(i=this.children[t(e,this)],null!=i.tree&&(!!i.tree.remove(e)&&(this.size--,0===i.tree.size&&(i.tree=null),!0))))},e.prototype.colliding=function(e,n){var r,l,o,s,u,f,c,d,a,p,m,g,x;for(h(e),r=function(e,t){var n,i,r,h;return!(e.x>t.x+(null!=(n=t.width)?n:0)||e.x+(null!=(i=e.width)?i:0)<t.x||e.y>t.y+(null!=(r=t.height)?r:0)||e.y+(null!=(h=e.height)?h:0)<t.y)},null==n&&(n=r),u=[],s=[this];s.length>0;){for(x=s.shift(),p=x.oversized,f=0,d=p.length;f<d;f++)o=p[f],o!==e&&n(e,o)&&u.push(o);for(m=x.contents,c=0,a=m.length;c<a;c++)o=m[c],o!==e&&n(e,o)&&u.push(o);if(g=x.children[t(e,x)],i(e,g.create()))for(l in x.children)null!=x.children[l].tree&&r(x.children[l].tree,e)&&s.push(x.children[l].tree);else null!=g.tree&&s.push(g.tree)}return u},e.prototype.get=function(e){return this.where(e)},e.prototype.where=function(e){var n,i,r,l,o,s,u,f,c,d,a,p,m;if("object"==typeof e&&null==e.x&&null==e.y)return this.find(function(t){var n,i;n=!0;for(i in e)e[i]!==t[i]&&(n=!1);return n});for(h(e),l=[],r=[this];r.length>0;){for(m=r.shift(),d=m.oversized,o=0,f=d.length;o<f;o++){i=d[o],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}for(a=m.contents,s=0,c=a.length;s<c;s++){i=a[s],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}p=m.children[t(e,m)],null!=p.tree&&r.push(p.tree)}return l},e.prototype.each=function(e){var t,n,i,r,h,l,o,s,u,f;for(n=[this];n.length>0;){for(f=n.shift(),s=f.oversized,r=0,l=s.length;r<l;r++)i=s[r],"function"==typeof e&&e(i);for(u=f.contents,h=0,o=u.length;h<o;h++)i=u[h],"function"==typeof e&&e(i);for(t in f.children)null!=f.children[t].tree&&n.push(f.children[t].tree)}return this},e.prototype.find=function(e){var t,n,i,r,h,l,o,s,u,f,c;for(n=[this],r=[];n.length>0;){for(c=n.shift(),u=c.oversized,h=0,o=u.length;h<o;h++)i=u[h],("function"==typeof e?e(i):void 0)&&r.push(i);for(f=c.contents,l=0,s=f.length;l<s;l++)i=f[l],("function"==typeof e?e(i):void 0)&&r.push(i);for(t in c.children)null!=c.children[t].tree&&n.push(c.children[t].tree)}return r},e.prototype.filter=function(t){var n;return(n=function(i){var r,h,l,o,s,u,f,c,d,a,p;h=new e({x:i.x,y:i.y,width:i.width,height:i.height,maxElements:i.maxElements}),h.size=0;for(r in i.children)null!=i.children[r].tree&&(h.children[r].tree=n(i.children[r].tree),h.size+=null!=(c=null!=(d=h.children[r].tree)?d.size:void 0)?c:0);for(a=i.oversized,o=0,u=a.length;o<u;o++)l=a[o],(null==t||("function"==typeof t?t(l):void 0))&&h.oversized.push(l);for(p=i.contents,s=0,f=p.length;s<f;s++)l=p[s],(null==t||("function"==typeof t?t(l):void 0))&&h.contents.push(l);return h.size+=h.oversized.length+h.contents.length,0===h.size?null:h})(this)},e.prototype.reject=function(e){return this.filter(function(t){return!("function"==typeof e?e(t):void 0)})},e.prototype.visit=function(e){var t,n,i;for(n=[this];n.length>0;){i=n.shift(),e.bind(i)();for(t in i.children)null!=i.children[t].tree&&n.push(i.children[t].tree)}return this},e.prototype.pretty=function(){var e,t,n,i,r,h,l;for(h="",n=function(e){var t,n,i,r;for(i="",r=t=n=e;n<=0?t<0:t>0;r=n<=0?++t:--t)i+="   ";return i},t=[{label:"ROOT",tree:this,level:0}];t.length>0;){l=t.shift(),i=n(l.level),h+=i+"| "+l.label+"\n"+i+"| ------------\n",l.tree.oversized.length>0&&(h+=i+"| * Oversized elements *\n"+i+"|   "+l.tree.oversized+"\n"),l.tree.contents.length>0&&(h+=i+"| * Leaf content *\n"+i+"|   "+l.tree.contents+"\n"),r=!1;for(e in l.tree.children)null!=l.tree.children[e].tree&&(r=!0,t.unshift({label:e,tree:l.tree.children[e].tree,level:l.level+1}));r&&(h+=i+"└──┐\n")}return h},e}(),"undefined"!=typeof module&&null!==module&&(module.exports=Quadtree);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1YWR0cmVlLmNvZmZlZSIsInF1YWR0cmVlLmpzIl0sIm5hbWVzIjpbIlF1YWR0cmVlIiwiYXJnIiwiY2hpbGQiLCJ0aGF0IiwidGhpcyIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXhFbGVtZW50cyIsIkVycm9yIiwiY29udGVudHMiLCJvdmVyc2l6ZWQiLCJzaXplIiwiY2hpbGRyZW4iLCJOVyIsImNyZWF0ZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsInRyZWUiLCJORSIsImNlaWwiLCJTVyIsIlNFIiwiZ2V0IiwiY2FsY3VsYXRlRGlyZWN0aW9uIiwiZ2V0Q2VudGVyIiwiaXNPdmVyc2l6ZWQiLCJvYnNlcnZlIiwidmFsaWRhdGVFbGVtZW50IiwiaXRlbSIsInJlZiIsInJlZjEiLCJlbGVtZW50IiwicXVhZENlbnRlciIsIndyaXRlQWNjZXNzb3JzIiwicHJvcE5hbWUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInNldCIsInZhbCIsInJlbW92ZSIsInB1c2giLCJjb25maWd1cmFibGUiLCJwcm90b3R5cGUiLCJkb09ic2VydmUiLCJwdXNoQWxsIiwiaXRlbXMiLCJjYW5kaWRhdGUiLCJjb250ZW50IiwiY29udGVudERpciIsImRpcmVjdGlvbiIsImVsZW1lbnRzIiwiZmlmbyIsImZpZm9DYW5kaWRhdGVzIiwiaiIsImsiLCJsIiwibGVuIiwibGVuMSIsImxlbjIiLCJyZWxhdGVkQ2hpbGQiLCJ0b3AiLCJsZW5ndGgiLCJzaGlmdCIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImNvbGxpZGluZyIsImNvbGxpc2lvbkZ1bmN0aW9uIiwiYm91bmRpbmdCb3hDb2xsaXNpb24iLCJlbHQiLCJlbHQxIiwiZWx0MiIsInJlZjIiLCJyZWYzIiwicXVlcnkiLCJ3aGVyZSIsImNoZWNrIiwia2V5IiwiZmluZCIsImVhY2giLCJhY3Rpb24iLCJpIiwicHJlZGljYXRlIiwiZmlsdGVyIiwiZGVlcGNsb25lIiwidGFyZ2V0IiwiY29weWNhdCIsInJlamVjdCIsInZpc2l0IiwiYmluZCIsInByZXR0eSIsImluZGVudCIsImluZGVudGF0aW9uIiwiaXNQYXJlbnQiLCJzdHIiLCJsZXZlbCIsInJlcyIsInRpbWVzIiwibGFiZWwiLCJ1bnNoaWZ0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBU0EsR0FBQUEsU0FBTUEsVUFBQSxXQU9XLFFBQUFBLEdBQUNDLEdBR1YsR0FBQUMsR0FBQUMsQ0FBQSxJQUhXQyxLQUFDQyxFQUFBSixFQUFBSSxFQUFHRCxLQUFDRSxFQUFBTCxFQUFBSyxFQUFHRixLQUFDRyxNQUFBTixFQUFBTSxNQUFPSCxLQUFDSSxPQUFBUCxFQUFBTyxPQUFRSixLQUFDSyxZQUFBUixFQUFBUSxZQUdpQixNQUFBTCxLQUFBRyxPQUFlLE1BQUFILEtBQUFJLE9BQXJFLEtBQU0sSUFBSUUsT0FBTSwrQkFTaEIsSUNqQlUsTUFBVk4sS0FBS0MsSURTTEQsS0FBQ0MsRUFBSyxHQ05JLE1BQVZELEtBQUtFLElET0xGLEtBQUNFLEVBQUssR0NKYyxNQUFwQkYsS0FBS0ssY0RLTEwsS0FBQ0ssWUFBZSxHQUNoQkwsS0FBQ08sWUFDRFAsS0FBQ1EsYUFDRFIsS0FBQ1MsS0FBTyxFQUdtRVQsS0FBQ0MsRUFBSSxHQUFLRCxLQUFDRSxFQUFJLEdBQUtGLEtBQUNHLE1BQVEsR0FBS0gsS0FBQ0ksT0FBUyxFQUF2SCxLQUFNLElBQUlFLE9BQU0sd0RBQ2hCLElBQStGTixLQUFDSyxZQUFjLEVBQTlHLEtBQU0sSUFBSUMsT0FBTSw0RUFFaEJQLEdBQU9DLEtBR1BBLEtBQUNVLFVBRUdDLElBQ0lDLE9BQVEsV0NKZCxNREtVLElBQUloQixJQUNBSyxFQUFHRixFQUFLRSxFQUNSQyxFQUFHSCxFQUFLRyxFQUNSQyxNQUFPVSxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ksTUFBUSxHQUFJLEdBQzdDQyxPQUFRUyxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ssT0FBUyxHQUFJLEdBQy9DQyxZQUFhTixFQUFLTSxlQUUxQlcs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Z0QsU0FBVUQsTUFBT25HLEVBQU9rQixLQUFNMkMsRUFBSTNDLEtBQUtOLFNBQVNaLEdBQU9rQixLQUFNOEUsTUFBT25DLEVBQUltQyxNQUFRLElBRXRGRixLQUFjQyxHQUFVRixFQUFZLFVDOEgvQyxNRDVISUUsSUMrSENqRyxLQUlhLG1CQUFYdUcsU0FBcUMsT0FBWEEsU0QvSHJDQSxPQUFRQyxRQUFVeEciLCJmaWxlIjoicXVhZHRyZWUuanMiLCJzb3VyY2VzQ29udGVudCI6W251bGwsInZhciBRdWFkdHJlZTtcblxuUXVhZHRyZWUgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBjYWxjdWxhdGVEaXJlY3Rpb24sIGdldENlbnRlciwgaXNPdmVyc2l6ZWQsIG9ic2VydmUsIHZhbGlkYXRlRWxlbWVudDtcblxuICBmdW5jdGlvbiBRdWFkdHJlZShhcmcpIHtcbiAgICB2YXIgY2hpbGQsIHRoYXQ7XG4gICAgdGhpcy54ID0gYXJnLngsIHRoaXMueSA9IGFyZy55LCB0aGlzLndpZHRoID0gYXJnLndpZHRoLCB0aGlzLmhlaWdodCA9IGFyZy5oZWlnaHQsIHRoaXMubWF4RWxlbWVudHMgPSBhcmcubWF4RWxlbWVudHM7XG4gICAgaWYgKCh0aGlzLndpZHRoID09IG51bGwpIHx8ICh0aGlzLmhlaWdodCA9PSBudWxsKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBxdWFkdHJlZSBkaW1lbnNpb25zLlwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMueCA9PSBudWxsKSB7XG4gICAgICB0aGlzLnggPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy55ID09IG51bGwpIHtcbiAgICAgIHRoaXMueSA9IDA7XG4gICAgfVxuICAgIGlmICh0aGlzLm1heEVsZW1lbnRzID09IG51bGwpIHtcbiAgICAgIHRoaXMubWF4RWxlbWVudHMgPSAxO1xuICAgIH1cbiAgICB0aGlzLmNvbnRlbnRzID0gW107XG4gICAgdGhpcy5vdmVyc2l6ZWQgPSBbXTtcbiAgICB0aGlzLnNpemUgPSAwO1xuICAgIGlmICh0aGlzLnggPCAwIHx8IHRoaXMueSA8IDAgfHwgdGhpcy53aWR0aCA8IDEgfHwgdGhpcy5oZWlnaHQgPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEaW1lbnNpb25zIGFuZCBjb29yZGluYXRlcyBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubWF4RWxlbWVudHMgPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbWF4aW11bSBudW1iZXIgb2YgZWxlbWVudHMgYmVmb3JlIGEgc3BsaXQgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIuXCIpO1xuICAgIH1cbiAgICB0aGF0ID0gdGhpcztcbiAgICB0aGlzLmNoaWxkcmVuID0ge1xuICAgICAgXCJOV1wiOiB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICB4OiB0aGF0LngsXG4gICAgICAgICAgICB5OiB0aGF0LnksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQuaGVpZ2h0IC8gMiksIDEpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiTkVcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgeTogdGhhdC55LFxuICAgICAgICAgICAgd2lkdGg6IE1hdGguY2VpbCh0aGF0LndpZHRoIC8gMiksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmVlOiBudWxsXG4gICAgICB9LFxuICAgICAgXCJTV1wiOiB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICB4OiB0aGF0LngsXG4gICAgICAgICAgICB5OiB0aGF0LnkgKyBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQuaGVpZ2h0IC8gMiksIDEpLFxuICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5jZWlsKHRoYXQuaGVpZ2h0IC8gMiksXG4gICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmVlOiBudWxsXG4gICAgICB9LFxuICAgICAgXCJTRVwiOiB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICB4OiB0aGF0LnggKyBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICB5OiB0aGF0LnkgKyBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQuaGVpZ2h0IC8gMiksIDEpLFxuICAgICAgICAgICAgd2lkdGg6IE1hdGguY2VpbCh0aGF0LndpZHRoIC8gMiksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGguY2VpbCh0aGF0LmhlaWdodCAvIDIpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfVxuICAgIH07XG4gICAgZm9yIChjaGlsZCBpbiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICB0aGlzLmNoaWxkcmVuW2NoaWxkXS5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLmNyZWF0ZSgpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgZ2V0Q2VudGVyID0gZnVuY3Rpb24oaXRlbSkge1xuICAgIHZhciByZWYsIHJlZjE7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IE1hdGguZmxvb3IoKChyZWYgPSBpdGVtLndpZHRoKSAhPSBudWxsID8gcmVmIDogMSkgLyAyKSArIGl0ZW0ueCxcbiAgICAgIHk6IE1hdGguZmxvb3IoKChyZWYxID0gaXRlbS5oZWlnaHQpICE9IG51bGwgPyByZWYxIDogMSkgLyAyKSArIGl0ZW0ueVxuICAgIH07XG4gIH07XG5cbiAgdmFsaWRhdGVFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGlmICghdHlwZW9mIGVsZW1lbnQgPT09IFwib2JqZWN0XCIgfHwgKGVsZW1lbnQueCA9PSBudWxsKSB8fCAoZWxlbWVudC55ID09IG51bGwpIHx8IGVsZW1lbnQueCA8IDAgfHwgZWxlbWVudC55IDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT2JqZWN0IG11c3QgY29udGFpbiB4IG9yIHkgcG9zaXRpb25zIGFzIGFyZ3VtZW50cywgYW5kIHRoZXkgbXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7XG4gICAgfVxuICAgIGlmICgoZWxlbWVudCAhPSBudWxsID8gZWxlbWVudC53aWR0aCA6IHZvaWQgMCkgPCAwIHx8IChlbGVtZW50ICE9IG51bGwgPyBlbGVtZW50LmhlaWdodCA6IHZvaWQgMCkgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXaWR0aCBhbmQgaGVpZ2h0IG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIpO1xuICAgIH1cbiAgfTtcblxuICBjYWxjdWxhdGVEaXJlY3Rpb24gPSBmdW5jdGlvbihlbGVtZW50LCB0cmVlKSB7XG4gICAgdmFyIHF1YWRDZW50ZXI7XG4gICAgcXVhZENlbnRlciA9IGdldENlbnRlcih0cmVlKTtcbiAgICBpZiAoZWxlbWVudC54IDwgcXVhZENlbnRlci54KSB7XG4gICAgICBpZiAoZWxlbWVudC55IDwgcXVhZENlbnRlci55KSB7XG4gICAgICAgIHJldHVybiBcIk5XXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJTV1wiO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZWxlbWVudC55IDwgcXVhZENlbnRlci55KSB7XG4gICAgICAgIHJldHVybiBcIk5FXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJTRVwiO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBpc092ZXJzaXplZCA9IGZ1bmN0aW9uKGVsZW1lbnQsIHRyZWUpIHtcbiAgICB2YXIgcmVmLCByZWYxO1xuICAgIHJldHVybiBlbGVtZW50LnggPCB0cmVlLnggfHwgZWxlbWVudC54ICsgKChyZWYgPSBlbGVtZW50LndpZHRoKSAhPSBudWxsID8gcmVmIDogMCkgPj0gdHJlZS54ICsgdHJlZS53aWR0aCB8fCBlbGVtZW50LnkgPCB0cmVlLnkgfHwgZWxlbWVudC55ICsgKChyZWYxID0gZWxlbWVudC5oZWlnaHQpICE9IG51bGwgPyByZWYxIDogMCkgPj0gdHJlZS55ICsgdHJlZS5oZWlnaHQ7XG4gIH07XG5cbiAgb2JzZXJ2ZSA9IGZ1bmN0aW9uKGl0ZW0sIHRyZWUpIHtcbiAgICB2YXIgd3JpdGVBY2Nlc3NvcnM7XG4gICAgd3JpdGVBY2Nlc3NvcnMgPSBmdW5jdGlvbihwcm9wTmFtZSkge1xuICAgICAgaXRlbVtcIl9cIiArIHByb3BOYW1lXSA9IGl0ZW1bcHJvcE5hbWVdO1xuICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpdGVtLCBwcm9wTmFtZSwge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRyZWUucmVtb3ZlKHRoaXMpO1xuICAgICAgICAgIHRoaXNbXCJfXCIgKyBwcm9wTmFtZV0gPSB2YWw7XG4gICAgICAgICAgcmV0dXJuIHRyZWUucHVzaCh0aGlzKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1tcIl9cIiArIHByb3BOYW1lXTtcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHdyaXRlQWNjZXNzb3JzKFwieFwiKTtcbiAgICB3cml0ZUFjY2Vzc29ycyhcInlcIik7XG4gICAgd3JpdGVBY2Nlc3NvcnMoXCJ3aWR0aFwiKTtcbiAgICByZXR1cm4gd3JpdGVBY2Nlc3NvcnMoXCJoZWlnaHRcIik7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihpdGVtLCBkb09ic2VydmUpIHtcbiAgICByZXR1cm4gdGhpcy5wdXNoQWxsKFtpdGVtXSwgZG9PYnNlcnZlKTtcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUucHVzaEFsbCA9IGZ1bmN0aW9uKGl0ZW1zLCBkb09ic2VydmUpIHtcbiAgICB2YXIgY2FuZGlkYXRlLCBjb250ZW50LCBjb250ZW50RGlyLCBkaXJlY3Rpb24sIGVsZW1lbnQsIGVsZW1lbnRzLCBmaWZvLCBmaWZvQ2FuZGlkYXRlcywgaXRlbSwgaiwgaywgbCwgbGVuLCBsZW4xLCBsZW4yLCByZWYsIHJlbGF0ZWRDaGlsZCwgdG9wLCB0cmVlO1xuICAgIGZvciAoaiA9IDAsIGxlbiA9IGl0ZW1zLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBpdGVtID0gaXRlbXNbal07XG4gICAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgICBpZiAoZG9PYnNlcnZlKSB7XG4gICAgICAgIG9ic2VydmUoaXRlbSwgdGhpcyk7XG4gICAgICB9XG4gICAgfVxuICAgIGZpZm8gPSBbXG4gICAgICB7XG4gICAgICAgIHRyZWU6IHRoaXMsXG4gICAgICAgIGVsZW1lbnRzOiBpdGVtc1xuICAgICAgfVxuICAgIF07XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zaGlmdCgpO1xuICAgICAgdHJlZSA9IHRvcC50cmVlO1xuICAgICAgZWxlbWVudHMgPSB0b3AuZWxlbWVudHM7XG4gICAgICBmaWZvQ2FuZGlkYXRlcyA9IHtcbiAgICAgICAgXCJOV1wiOiBudWxsLFxuICAgICAgICBcIk5FXCI6IG51bGwsXG4gICAgICAgIFwiU1dcIjogbnVsbCxcbiAgICAgICAgXCJTRVwiOiBudWxsXG4gICAgICB9O1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IGVsZW1lbnRzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBlbGVtZW50ID0gZWxlbWVudHNba107XG4gICAgICAgIHRyZWUuc2l6ZSsrO1xuICAgICAgICBkaXJlY3Rpb24gPSBjYWxjdWxhdGVEaXJlY3Rpb24oZWxlbWVudCwgdHJlZSk7XG4gICAgICAgIHJlbGF0ZWRDaGlsZCA9IHRyZWUuY2hpbGRyZW5bZGlyZWN0aW9uXTtcbiAgICAgICAgaWYgKHRyZWUud2lkdGggPT09IDEgfHwgdHJlZS5oZWlnaHQgPT09IDEgfHwgaXNPdmVyc2l6ZWQoZWxlbWVudCwgcmVsYXRlZENoaWxkLmNyZWF0ZSgpKSkge1xuICAgICAgICAgIHRyZWUub3ZlcnNpemVkLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoKHRyZWUuc2l6ZSAtIHRyZWUub3ZlcnNpemVkLmxlbmd0aCkgPD0gdHJlZS5tYXhFbGVtZW50cykge1xuICAgICAgICAgIHRyZWUuY29udGVudHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZmlmb0NhbmRpZGF0ZXNbZGlyZWN0aW9uXSA9PSBudWxsKSB7XG4gICAgICAgICAgICBmaWZvQ2FuZGlkYXRlc1tkaXJlY3Rpb25dID0ge1xuICAgICAgICAgICAgICB0cmVlOiByZWxhdGVkQ2hpbGQuZ2V0KCksXG4gICAgICAgICAgICAgIGVsZW1lbnRzOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZmlmb0NhbmRpZGF0ZXNbZGlyZWN0aW9uXS5lbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgIHJlZiA9IHRyZWUuY29udGVudHM7XG4gICAgICAgICAgZm9yIChsID0gMCwgbGVuMiA9IHJlZi5sZW5ndGg7IGwgPCBsZW4yOyBsKyspIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSByZWZbbF07XG4gICAgICAgICAgICBjb250ZW50RGlyID0gY2FsY3VsYXRlRGlyZWN0aW9uKGNvbnRlbnQsIHRyZWUpO1xuICAgICAgICAgICAgaWYgKGZpZm9DYW5kaWRhdGVzW2NvbnRlbnREaXJdID09IG51bGwpIHtcbiAgICAgICAgICAgICAgZmlmb0NhbmRpZGF0ZXNbY29udGVudERpcl0gPSB7XG4gICAgICAgICAgICAgICAgdHJlZTogdHJlZS5jaGlsZHJlbltjb250ZW50RGlyXS5nZXQoKSxcbiAgICAgICAgICAgICAgICBlbGVtZW50czogW11cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpZm9DYW5kaWRhdGVzW2NvbnRlbnREaXJdLmVsZW1lbnRzLnB1c2goY29udGVudCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyZWUuY29udGVudHMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChkaXJlY3Rpb24gaW4gZmlmb0NhbmRpZGF0ZXMpIHtcbiAgICAgICAgY2FuZGlkYXRlID0gZmlmb0NhbmRpZGF0ZXNbZGlyZWN0aW9uXTtcbiAgICAgICAgaWYgKGNhbmRpZGF0ZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgaW5kZXgsIHJlbGF0ZWRDaGlsZDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgaW5kZXggPSB0aGlzLm92ZXJzaXplZC5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLm92ZXJzaXplZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaW5kZXggPSB0aGlzLmNvbnRlbnRzLmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgIHRoaXMuY29udGVudHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIHRoaXMuc2l6ZS0tO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJlbGF0ZWRDaGlsZCA9IHRoaXMuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGl0ZW0sIHRoaXMpXTtcbiAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUucmVtb3ZlKGl0ZW0pKSB7XG4gICAgICB0aGlzLnNpemUtLTtcbiAgICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZS5zaXplID09PSAwKSB7XG4gICAgICAgIHJlbGF0ZWRDaGlsZC50cmVlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5jb2xsaWRpbmcgPSBmdW5jdGlvbihpdGVtLCBjb2xsaXNpb25GdW5jdGlvbikge1xuICAgIHZhciBib3VuZGluZ0JveENvbGxpc2lvbiwgY2hpbGQsIGVsdCwgZmlmbywgaXRlbXMsIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgYm91bmRpbmdCb3hDb2xsaXNpb24gPSBmdW5jdGlvbihlbHQxLCBlbHQyKSB7XG4gICAgICB2YXIgcmVmLCByZWYxLCByZWYyLCByZWYzO1xuICAgICAgcmV0dXJuICEoZWx0MS54ID4gZWx0Mi54ICsgKChyZWYgPSBlbHQyLndpZHRoKSAhPSBudWxsID8gcmVmIDogMCkgfHwgZWx0MS54ICsgKChyZWYxID0gZWx0MS53aWR0aCkgIT0gbnVsbCA/IHJlZjEgOiAwKSA8IGVsdDIueCB8fCBlbHQxLnkgPiBlbHQyLnkgKyAoKHJlZjIgPSBlbHQyLmhlaWdodCkgIT0gbnVsbCA/IHJlZjIgOiAwKSB8fCBlbHQxLnkgKyAoKHJlZjMgPSBlbHQxLmhlaWdodCkgIT0gbnVsbCA/IHJlZjMgOiAwKSA8IGVsdDIueSk7XG4gICAgfTtcbiAgICBpZiAoY29sbGlzaW9uRnVuY3Rpb24gPT0gbnVsbCkge1xuICAgICAgY29sbGlzaW9uRnVuY3Rpb24gPSBib3VuZGluZ0JveENvbGxpc2lvbjtcbiAgICB9XG4gICAgaXRlbXMgPSBbXTtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgZWx0ID0gcmVmW2pdO1xuICAgICAgICBpZiAoZWx0ICE9PSBpdGVtICYmIGNvbGxpc2lvbkZ1bmN0aW9uKGl0ZW0sIGVsdCkpIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKGVsdCAhPT0gaXRlbSAmJiBjb2xsaXNpb25GdW5jdGlvbihpdGVtLCBlbHQpKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0b3AuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGl0ZW0sIHRvcCldO1xuICAgICAgaWYgKGlzT3ZlcnNpemVkKGl0ZW0sIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKSkpIHtcbiAgICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgICBpZiAoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSAmJiBib3VuZGluZ0JveENvbGxpc2lvbih0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUsIGl0ZW0pKSB7XG4gICAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocmVsYXRlZENoaWxkLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICBmaWZvLnB1c2gocmVsYXRlZENoaWxkLnRyZWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgcmV0dXJuIHRoaXMud2hlcmUocXVlcnkpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS53aGVyZSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgdmFyIGNoZWNrLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBrZXksIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICBpZiAodHlwZW9mIHF1ZXJ5ID09PSBcIm9iamVjdFwiICYmIChxdWVyeS54ID09IG51bGwpICYmIChxdWVyeS55ID09IG51bGwpKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kKGZ1bmN0aW9uKGVsdCkge1xuICAgICAgICB2YXIgY2hlY2ssIGtleTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgIGlmIChxdWVyeVtrZXldICE9PSBlbHRba2V5XSkge1xuICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoZWNrO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHZhbGlkYXRlRWxlbWVudChxdWVyeSk7XG4gICAgaXRlbXMgPSBbXTtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgZWx0ID0gcmVmW2pdO1xuICAgICAgICBjaGVjayA9IHRydWU7XG4gICAgICAgIGZvciAoa2V5IGluIHF1ZXJ5KSB7XG4gICAgICAgICAgaWYgKHF1ZXJ5W2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgIGlmIChxdWVyeVtrZXldICE9PSBlbHRba2V5XSkge1xuICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0b3AuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKHF1ZXJ5LCB0b3ApXTtcbiAgICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZSAhPSBudWxsKSB7XG4gICAgICAgIGZpZm8ucHVzaChyZWxhdGVkQ2hpbGQudHJlZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaSwgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHRvcDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaSA9IHJlZltqXTtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGFjdGlvbihpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMSA9IHRvcC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGFjdGlvbihpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICB2YXIgY2hpbGQsIGZpZm8sIGksIGl0ZW1zLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgdG9wO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgaXRlbXMgPSBbXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGkgPSByZWZbal07XG4gICAgICAgIGlmICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaSkgOiB2b2lkIDApIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGkgPSByZWYxW2tdO1xuICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGkpIDogdm9pZCAwKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1zO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICB2YXIgZGVlcGNsb25lO1xuICAgIGRlZXBjbG9uZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgdmFyIGNoaWxkLCBjb3B5Y2F0LCBpdGVtLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVmMiwgcmVmMztcbiAgICAgIGNvcHljYXQgPSBuZXcgUXVhZHRyZWUoe1xuICAgICAgICB4OiB0YXJnZXQueCxcbiAgICAgICAgeTogdGFyZ2V0LnksXG4gICAgICAgIHdpZHRoOiB0YXJnZXQud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGFyZ2V0LmhlaWdodCxcbiAgICAgICAgbWF4RWxlbWVudHM6IHRhcmdldC5tYXhFbGVtZW50c1xuICAgICAgfSk7XG4gICAgICBjb3B5Y2F0LnNpemUgPSAwO1xuICAgICAgZm9yIChjaGlsZCBpbiB0YXJnZXQuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKCEodGFyZ2V0LmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSA9IGRlZXBjbG9uZSh0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICBjb3B5Y2F0LnNpemUgKz0gKHJlZiA9IChyZWYxID0gY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSkgIT0gbnVsbCA/IHJlZjEuc2l6ZSA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZiA6IDA7XG4gICAgICB9XG4gICAgICByZWYyID0gdGFyZ2V0Lm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZjIubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaXRlbSA9IHJlZjJbal07XG4gICAgICAgIGlmICgocHJlZGljYXRlID09IG51bGwpIHx8ICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaXRlbSkgOiB2b2lkIDApKSB7XG4gICAgICAgICAgY29weWNhdC5vdmVyc2l6ZWQucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMyA9IHRhcmdldC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpdGVtID0gcmVmM1trXTtcbiAgICAgICAgaWYgKChwcmVkaWNhdGUgPT0gbnVsbCkgfHwgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpdGVtKSA6IHZvaWQgMCkpIHtcbiAgICAgICAgICBjb3B5Y2F0LmNvbnRlbnRzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvcHljYXQuc2l6ZSArPSBjb3B5Y2F0Lm92ZXJzaXplZC5sZW5ndGggKyBjb3B5Y2F0LmNvbnRlbnRzLmxlbmd0aDtcbiAgICAgIGlmIChjb3B5Y2F0LnNpemUgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gY29weWNhdDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBkZWVwY2xvbmUodGhpcyk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbihpKSB7XG4gICAgICByZXR1cm4gISh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaSkgOiB2b2lkIDApO1xuICAgIH0pO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS52aXNpdCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgdGhhdDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoYXQgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICBhY3Rpb24uYmluZCh0aGF0KSgpO1xuICAgICAgZm9yIChjaGlsZCBpbiB0aGF0LmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICh0aGF0LmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICBmaWZvLnB1c2godGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnByZXR0eSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaW5kZW50LCBpbmRlbnRhdGlvbiwgaXNQYXJlbnQsIHN0ciwgdG9wO1xuICAgIHN0ciA9IFwiXCI7XG4gICAgaW5kZW50ID0gZnVuY3Rpb24obGV2ZWwpIHtcbiAgICAgIHZhciBqLCByZWYsIHJlcywgdGltZXM7XG4gICAgICByZXMgPSBcIlwiO1xuICAgICAgZm9yICh0aW1lcyA9IGogPSByZWYgPSBsZXZlbDsgcmVmIDw9IDAgPyBqIDwgMCA6IGogPiAwOyB0aW1lcyA9IHJlZiA8PSAwID8gKytqIDogLS1qKSB7XG4gICAgICAgIHJlcyArPSBcIiAgIFwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcztcbiAgICB9O1xuICAgIGZpZm8gPSBbXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBcIlJPT1RcIixcbiAgICAgICAgdHJlZTogdGhpcyxcbiAgICAgICAgbGV2ZWw6IDBcbiAgICAgIH1cbiAgICBdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIGluZGVudGF0aW9uID0gaW5kZW50KHRvcC5sZXZlbCk7XG4gICAgICBzdHIgKz0gaW5kZW50YXRpb24gKyBcInwgXCIgKyB0b3AubGFiZWwgKyBcIlxcblwiICsgaW5kZW50YXRpb24gKyBcInwgLS0tLS0tLS0tLS0tXFxuXCI7XG4gICAgICBpZiAodG9wLnRyZWUub3ZlcnNpemVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3RyICs9IGluZGVudGF0aW9uICsgXCJ8ICogT3ZlcnNpemVkIGVsZW1lbnRzICpcXG5cIiArIGluZGVudGF0aW9uICsgXCJ8ICAgXCIgKyB0b3AudHJlZS5vdmVyc2l6ZWQgKyBcIlxcblwiO1xuICAgICAgfVxuICAgICAgaWYgKHRvcC50cmVlLmNvbnRlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3RyICs9IGluZGVudGF0aW9uICsgXCJ8ICogTGVhZiBjb250ZW50ICpcXG5cIiArIGluZGVudGF0aW9uICsgXCJ8ICAgXCIgKyB0b3AudHJlZS5jb250ZW50cyArIFwiXFxuXCI7XG4gICAgICB9XG4gICAgICBpc1BhcmVudCA9IGZhbHNlO1xuICAgICAgZm9yIChjaGlsZCBpbiB0b3AudHJlZS5jaGlsZHJlbikge1xuICAgICAgICBpZiAoISh0b3AudHJlZS5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlzUGFyZW50ID0gdHJ1ZTtcbiAgICAgICAgZmlmby51bnNoaWZ0KHtcbiAgICAgICAgICBsYWJlbDogY2hpbGQsXG4gICAgICAgICAgdHJlZTogdG9wLnRyZWUuY2hpbGRyZW5bY2hpbGRdLnRyZWUsXG4gICAgICAgICAgbGV2ZWw6IHRvcC5sZXZlbCArIDFcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoaXNQYXJlbnQpIHtcbiAgICAgICAgc3RyICs9IGluZGVudGF0aW9uICsgXCLilJTilIDilIDilJBcXG5cIjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbiAgfTtcblxuICByZXR1cm4gUXVhZHRyZWU7XG5cbn0pKCk7XG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1vZHVsZSAhPT0gbnVsbCkge1xuICBtb2R1bGUuZXhwb3J0cyA9IFF1YWR0cmVlO1xufVxuIl19
