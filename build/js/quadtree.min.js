var Quadtree;Quadtree=function(){function e(t){var n,i;if(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.maxElements=t.maxElements,null==this.width||null==this.height)throw new Error("Missing quadtree dimensions.");if(null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.maxElements&&(this.maxElements=1),this.contents=[],this.oversized=[],this.size=0,this.x<0||this.y<0||this.width<1||this.height<1)throw new Error("Dimensions and coordinates must be positive integers.");if(this.maxElements<1)throw new Error("The maximum number of elements before a split must be a positive integer.");i=this,this.children={NW:{create:function(){return new e({x:i.x,y:i.y,width:Math.max(Math.floor(i.width/2),1),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},NE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y,width:Math.ceil(i.width/2),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},SW:{create:function(){return new e({x:i.x,y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.max(Math.floor(i.width/2),1),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null},SE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.ceil(i.width/2),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null}};for(n in this.children)this.children[n].get=function(){return null!=this.tree?this.tree:(this.tree=this.create(),this.tree)}}var t,n,i,r,h;return n=function(e){var t,n;return{x:Math.floor((null!=(t=e.width)?t:1)/2)+e.x,y:Math.floor((null!=(n=e.height)?n:1)/2)+e.y}},h=function(e){if(null==e.x||null==e.y||e.x<0||e.y<0)throw new Error("Object must contain x or y positions as arguments, and they must be positive integers.");if((null!=e?e.width:void 0)<0||(null!=e?e.height:void 0)<0)throw new Error("Width and height must be positive integers.")},t=function(e,t){var i;return i=n(t),e.x<i.x?e.y<i.y?"NW":"SW":e.y<i.y?"NE":"SE"},i=function(e,t){var n,i;return e.x<t.x||e.x+(null!=(n=e.width)?n:0)>=t.x+t.width||e.y<t.y||e.y+(null!=(i=e.height)?i:0)>=t.y+t.height},r=function(e,t){var n;return n=function(n){return e["_"+n]=e[n],Object.defineProperty(e,n,{set:function(e){return t.remove(this),this["_"+n]=e,t.push(this)},get:function(){return this["_"+n]},configurable:!0})},n("x"),n("y"),n("width"),n("height")},e.prototype.push=function(e,t){return this.pushAll([e],t)},e.prototype.pushAll=function(e,n){var l,o,s,u,f,c,d,a,p,m,g,x,y,v,w,z,E,M,b;for(m=0,y=e.length;m<y;m++)p=e[m],h(p),n&&r(p,this);for(d=[{tree:this,elements:e}];d.length>0;){for(M=d.shift(),b=M.tree,c=M.elements,a={NW:null,NE:null,SW:null,SE:null},g=0,v=c.length;g<v;g++)if(f=c[g],b.size++,u=t(f,b),E=b.children[u],1===b.width||1===b.height||i(f,E.create()))b.oversized.push(f);else if(b.size<=b.maxElements)b.contents.push(f);else{for(null==a[u]&&(a[u]={tree:E.get(),elements:[]}),a[u].elements.push(f),z=b.contents,x=0,w=z.length;x<w;x++)o=z[x],s=t(o,b),null==a[s]&&(a[s]={tree:b.children[s].get(),elements:[]}),a[s].elements.push(o);b.contents=[]}for(u in a)l=a[u],null!=l&&d.push(l)}return this},e.prototype.remove=function(e){var n,i;return h(e),n=this.oversized.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(n=this.contents.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(i=this.children[t(e,this)],null!=i.tree&&(!!i.tree.remove(e)&&(this.size--,0===i.tree.size&&(i.tree=null),!0))))},e.prototype.colliding=function(e,n){var r,l,o,s,u,f,c,d,a,p,m,g,x;for(h(e),r=function(e,t){var n,i,r,h;return!(e.x>t.x+(null!=(n=t.width)?n:0)||e.x+(null!=(i=e.width)?i:0)<t.x||e.y>t.y+(null!=(r=t.height)?r:0)||e.y+(null!=(h=e.height)?h:0)<t.y)},null==n&&(n=r),u=[],s=[this];s.length>0;){for(x=s.shift(),p=x.oversized,f=0,d=p.length;f<d;f++)o=p[f],o!==e&&n(e,o)&&u.push(o);for(m=x.contents,c=0,a=m.length;c<a;c++)o=m[c],o!==e&&n(e,o)&&u.push(o);if(g=x.children[t(e,x)],i(e,g.create()))for(l in x.children)null!=x.children[l].tree&&r(x.children[l].tree,e)&&s.push(x.children[l].tree);else null!=g.tree&&s.push(g.tree)}return u},e.prototype.get=function(e){return this.where(e)},e.prototype.where=function(e){var n,i,r,l,o,s,u,f,c,d,a,p,m;if("object"==typeof e&&null==e.x&&null==e.y)return this.find(function(t){var n,i;n=!0;for(i in e)e[i]!==t[i]&&(n=!1);return n});for(h(e),l=[],r=[this];r.length>0;){for(m=r.shift(),d=m.oversized,o=0,f=d.length;o<f;o++){i=d[o],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}for(a=m.contents,s=0,c=a.length;s<c;s++){i=a[s],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}p=m.children[t(e,m)],null!=p.tree&&r.push(p.tree)}return l},e.prototype.each=function(e){var t,n,i,r,h,l,o,s,u,f;for(n=[this];n.length>0;){for(f=n.shift(),s=f.oversized,r=0,l=s.length;r<l;r++)i=s[r],"function"==typeof e&&e(i);for(u=f.contents,h=0,o=u.length;h<o;h++)i=u[h],"function"==typeof e&&e(i);for(t in f.children)null!=f.children[t].tree&&n.push(f.children[t].tree)}return this},e.prototype.find=function(e){var t,n,i,r,h,l,o,s,u,f,c;for(n=[this],r=[];n.length>0;){for(c=n.shift(),u=c.oversized,h=0,o=u.length;h<o;h++)i=u[h],("function"==typeof e?e(i):void 0)&&r.push(i);for(f=c.contents,l=0,s=f.length;l<s;l++)i=f[l],("function"==typeof e?e(i):void 0)&&r.push(i);for(t in c.children)null!=c.children[t].tree&&n.push(c.children[t].tree)}return r},e.prototype.filter=function(t){var n;return(n=function(i){var r,h,l,o,s,u,f,c,d,a,p;h=new e({x:i.x,y:i.y,width:i.width,height:i.height,maxElements:i.maxElements}),h.size=0;for(r in i.children)null!=i.children[r].tree&&(h.children[r].tree=n(i.children[r].tree),h.size+=null!=(c=null!=(d=h.children[r].tree)?d.size:void 0)?c:0);for(a=i.oversized,o=0,u=a.length;o<u;o++)l=a[o],(null==t||("function"==typeof t?t(l):void 0))&&h.oversized.push(l);for(p=i.contents,s=0,f=p.length;s<f;s++)l=p[s],(null==t||("function"==typeof t?t(l):void 0))&&h.contents.push(l);return h.size+=h.oversized.length+h.contents.length,0===h.size?null:h})(this)},e.prototype.reject=function(e){return this.filter(function(t){return!("function"==typeof e?e(t):void 0)})},e.prototype.visit=function(e){var t,n,i;for(n=[this];n.length>0;){i=n.shift(),e.bind(i)();for(t in i.children)null!=i.children[t].tree&&n.push(i.children[t].tree)}return this},e.prototype.pretty=function(){var e,t,n,i,r,h,l;for(h="",n=function(e){var t,n,i,r;for(i="",r=t=n=e;n<=0?t<0:t>0;r=n<=0?++t:--t)i+="   ";return i},t=[{label:"ROOT",tree:this,level:0}];t.length>0;){l=t.shift(),i=n(l.level),h+=i+"| "+l.label+"\n"+i+"| ------------\n",l.tree.oversized.length>0&&(h+=i+"| * Oversized elements *\n"+i+"|   "+l.tree.oversized+"\n"),l.tree.contents.length>0&&(h+=i+"| * Leaf content *\n"+i+"|   "+l.tree.contents+"\n"),r=!1;for(e in l.tree.children)null!=l.tree.children[e].tree&&(r=!0,t.unshift({label:e,tree:l.tree.children[e].tree,level:l.level+1}));r&&(h+=i+"└──┐\n")}return h},e}(),"undefined"!=typeof module&&null!==module&&(module.exports=Quadtree);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1YWR0cmVlLmNvZmZlZSIsInF1YWR0cmVlLmpzIl0sIm5hbWVzIjpbIlF1YWR0cmVlIiwiYXJnIiwiY2hpbGQiLCJ0aGF0IiwidGhpcyIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXhFbGVtZW50cyIsIkVycm9yIiwiY29udGVudHMiLCJvdmVyc2l6ZWQiLCJzaXplIiwiY2hpbGRyZW4iLCJOVyIsImNyZWF0ZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsInRyZWUiLCJORSIsImNlaWwiLCJTVyIsIlNFIiwiZ2V0IiwiY2FsY3VsYXRlRGlyZWN0aW9uIiwiZ2V0Q2VudGVyIiwiaXNPdmVyc2l6ZWQiLCJvYnNlcnZlIiwidmFsaWRhdGVFbGVtZW50IiwiaXRlbSIsInJlZiIsInJlZjEiLCJlbGVtZW50IiwicXVhZENlbnRlciIsIndyaXRlQWNjZXNzb3JzIiwicHJvcE5hbWUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInNldCIsInZhbCIsInJlbW92ZSIsInB1c2giLCJjb25maWd1cmFibGUiLCJwcm90b3R5cGUiLCJkb09ic2VydmUiLCJwdXNoQWxsIiwiaXRlbXMiLCJjYW5kaWRhdGUiLCJjb250ZW50IiwiY29udGVudERpciIsImRpcmVjdGlvbiIsImVsZW1lbnRzIiwiZmlmbyIsImZpZm9DYW5kaWRhdGVzIiwiaiIsImsiLCJsIiwibGVuIiwibGVuMSIsImxlbjIiLCJyZWxhdGVkQ2hpbGQiLCJ0b3AiLCJsZW5ndGgiLCJzaGlmdCIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImNvbGxpZGluZyIsImNvbGxpc2lvbkZ1bmN0aW9uIiwiYm91bmRpbmdCb3hDb2xsaXNpb24iLCJlbHQiLCJlbHQxIiwiZWx0MiIsInJlZjIiLCJyZWYzIiwicXVlcnkiLCJ3aGVyZSIsImNoZWNrIiwia2V5IiwiZmluZCIsImVhY2giLCJhY3Rpb24iLCJpIiwicHJlZGljYXRlIiwiZmlsdGVyIiwiZGVlcGNsb25lIiwidGFyZ2V0IiwiY29weWNhdCIsInJlamVjdCIsInZpc2l0IiwiYmluZCIsInByZXR0eSIsImluZGVudCIsImluZGVudGF0aW9uIiwiaXNQYXJlbnQiLCJzdHIiLCJsZXZlbCIsInJlcyIsInRpbWVzIiwibGFiZWwiLCJ1bnNoaWZ0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBU0EsR0FBQUEsU0FBTUEsVUFBQSxXQU9XLFFBQUFBLEdBQUNDLEdBR1YsR0FBQUMsR0FBQUMsQ0FBQSxJQUhXQyxLQUFDQyxFQUFBSixFQUFBSSxFQUFHRCxLQUFDRSxFQUFBTCxFQUFBSyxFQUFHRixLQUFDRyxNQUFBTixFQUFBTSxNQUFPSCxLQUFDSSxPQUFBUCxFQUFBTyxPQUFRSixLQUFDSyxZQUFBUixFQUFBUSxZQUdpQixNQUFBTCxLQUFBRyxPQUFlLE1BQUFILEtBQUFJLE9BQXJFLEtBQU0sSUFBSUUsT0FBTSwrQkFTaEIsSUNqQlUsTUFBVk4sS0FBS0MsSURTTEQsS0FBQ0MsRUFBSyxHQ05JLE1BQVZELEtBQUtFLElET0xGLEtBQUNFLEVBQUssR0NKYyxNQUFwQkYsS0FBS0ssY0RLTEwsS0FBQ0ssWUFBZSxHQUNoQkwsS0FBQ08sWUFDRFAsS0FBQ1EsYUFDRFIsS0FBQ1MsS0FBTyxFQUdtRVQsS0FBQ0MsRUFBSSxHQUFLRCxLQUFDRSxFQUFJLEdBQUtGLEtBQUNHLE1BQVEsR0FBS0gsS0FBQ0ksT0FBUyxFQUF2SCxLQUFNLElBQUlFLE9BQU0sd0RBQ2hCLElBQStGTixLQUFDSyxZQUFjLEVBQTlHLEtBQU0sSUFBSUMsT0FBTSw0RUFFaEJQLEdBQU9DLEtBR1BBLEtBQUNVLFVBRUdDLElBQ0lDLE9BQVEsV0NKZCxNREtVLElBQUloQixJQUNBSyxFQUFHRixFQUFLRSxFQUNSQyxFQUFHSCxFQUFLRyxFQUNSQyxNQUFPVSxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ksTUFBUSxHQUFJLEdBQzdDQyxPQUFRUyxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ssT0FBUyxHQUFJLEdBQy9DQyxZQUFhTixFQUFLTSxlQUUxQlcs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a0IsS0FBTTJDLEVBQUkzQyxLQUFLTixTQUFTWixHQUFPa0IsS0FBTThFLE1BQU9uQyxFQUFJbUMsTUFBUSxJQUV0RkYsS0FBY0MsR0FBVUYsRUFBWSxVQzhIL0MsTUQ1SElFLElDK0hDakcsS0FJYSxtQkFBWHVHLFNBQXFDLE9BQVhBLFNEL0hyQ0EsT0FBUUMsUUFBVXhHIiwiZmlsZSI6InF1YWR0cmVlLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCJ2YXIgUXVhZHRyZWU7XG5cblF1YWR0cmVlID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgY2FsY3VsYXRlRGlyZWN0aW9uLCBnZXRDZW50ZXIsIGlzT3ZlcnNpemVkLCBvYnNlcnZlLCB2YWxpZGF0ZUVsZW1lbnQ7XG5cbiAgZnVuY3Rpb24gUXVhZHRyZWUoYXJnKSB7XG4gICAgdmFyIGNoaWxkLCB0aGF0O1xuICAgIHRoaXMueCA9IGFyZy54LCB0aGlzLnkgPSBhcmcueSwgdGhpcy53aWR0aCA9IGFyZy53aWR0aCwgdGhpcy5oZWlnaHQgPSBhcmcuaGVpZ2h0LCB0aGlzLm1heEVsZW1lbnRzID0gYXJnLm1heEVsZW1lbnRzO1xuICAgIGlmICgodGhpcy53aWR0aCA9PSBudWxsKSB8fCAodGhpcy5oZWlnaHQgPT0gbnVsbCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgcXVhZHRyZWUgZGltZW5zaW9ucy5cIik7XG4gICAgfVxuICAgIGlmICh0aGlzLnggPT0gbnVsbCkge1xuICAgICAgdGhpcy54ID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMueSA9PSBudWxsKSB7XG4gICAgICB0aGlzLnkgPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhFbGVtZW50cyA9PSBudWxsKSB7XG4gICAgICB0aGlzLm1heEVsZW1lbnRzID0gMTtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50cyA9IFtdO1xuICAgIHRoaXMub3ZlcnNpemVkID0gW107XG4gICAgdGhpcy5zaXplID0gMDtcbiAgICBpZiAodGhpcy54IDwgMCB8fCB0aGlzLnkgPCAwIHx8IHRoaXMud2lkdGggPCAxIHx8IHRoaXMuaGVpZ2h0IDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGltZW5zaW9ucyBhbmQgY29vcmRpbmF0ZXMgbXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7XG4gICAgfVxuICAgIGlmICh0aGlzLm1heEVsZW1lbnRzIDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIG1heGltdW0gbnVtYmVyIG9mIGVsZW1lbnRzIGJlZm9yZSBhIHNwbGl0IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLlwiKTtcbiAgICB9XG4gICAgdGhhdCA9IHRoaXM7XG4gICAgdGhpcy5jaGlsZHJlbiA9IHtcbiAgICAgIFwiTldcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54LFxuICAgICAgICAgICAgeTogdGhhdC55LFxuICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIk5FXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHk6IHRoYXQueSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwodGhhdC53aWR0aCAvIDIpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQuaGVpZ2h0IC8gMiksIDEpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiU1dcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54LFxuICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGguY2VpbCh0aGF0LmhlaWdodCAvIDIpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiU0VcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwodGhhdC53aWR0aCAvIDIpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwodGhhdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH1cbiAgICB9O1xuICAgIGZvciAoY2hpbGQgaW4gdGhpcy5jaGlsZHJlbikge1xuICAgICAgdGhpcy5jaGlsZHJlbltjaGlsZF0uZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50cmVlID0gdGhpcy5jcmVhdGUoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGdldENlbnRlciA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgcmVmLCByZWYxO1xuICAgIHJldHVybiB7XG4gICAgICB4OiBNYXRoLmZsb29yKCgocmVmID0gaXRlbS53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDEpIC8gMikgKyBpdGVtLngsXG4gICAgICB5OiBNYXRoLmZsb29yKCgocmVmMSA9IGl0ZW0uaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDEpIC8gMikgKyBpdGVtLnlcbiAgICB9O1xuICB9O1xuXG4gIHZhbGlkYXRlRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBpZiAoIXR5cGVvZiBlbGVtZW50ID09PSBcIm9iamVjdFwiIHx8IChlbGVtZW50LnggPT0gbnVsbCkgfHwgKGVsZW1lbnQueSA9PSBudWxsKSB8fCBlbGVtZW50LnggPCAwIHx8IGVsZW1lbnQueSA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk9iamVjdCBtdXN0IGNvbnRhaW4geCBvciB5IHBvc2l0aW9ucyBhcyBhcmd1bWVudHMsIGFuZCB0aGV5IG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIpO1xuICAgIH1cbiAgICBpZiAoKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQud2lkdGggOiB2b2lkIDApIDwgMCB8fCAoZWxlbWVudCAhPSBudWxsID8gZWxlbWVudC5oZWlnaHQgOiB2b2lkIDApIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiV2lkdGggYW5kIGhlaWdodCBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiKTtcbiAgICB9XG4gIH07XG5cbiAgY2FsY3VsYXRlRGlyZWN0aW9uID0gZnVuY3Rpb24oZWxlbWVudCwgdHJlZSkge1xuICAgIHZhciBxdWFkQ2VudGVyO1xuICAgIHF1YWRDZW50ZXIgPSBnZXRDZW50ZXIodHJlZSk7XG4gICAgaWYgKGVsZW1lbnQueCA8IHF1YWRDZW50ZXIueCkge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJOV1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU1dcIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJORVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU0VcIjtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgaXNPdmVyc2l6ZWQgPSBmdW5jdGlvbihlbGVtZW50LCB0cmVlKSB7XG4gICAgdmFyIHJlZiwgcmVmMTtcbiAgICByZXR1cm4gZWxlbWVudC54IDwgdHJlZS54IHx8IGVsZW1lbnQueCArICgocmVmID0gZWxlbWVudC53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDApID49IHRyZWUueCArIHRyZWUud2lkdGggfHwgZWxlbWVudC55IDwgdHJlZS55IHx8IGVsZW1lbnQueSArICgocmVmMSA9IGVsZW1lbnQuaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDApID49IHRyZWUueSArIHRyZWUuaGVpZ2h0O1xuICB9O1xuXG4gIG9ic2VydmUgPSBmdW5jdGlvbihpdGVtLCB0cmVlKSB7XG4gICAgdmFyIHdyaXRlQWNjZXNzb3JzO1xuICAgIHdyaXRlQWNjZXNzb3JzID0gZnVuY3Rpb24ocHJvcE5hbWUpIHtcbiAgICAgIGl0ZW1bXCJfXCIgKyBwcm9wTmFtZV0gPSBpdGVtW3Byb3BOYW1lXTtcbiAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoaXRlbSwgcHJvcE5hbWUsIHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0cmVlLnJlbW92ZSh0aGlzKTtcbiAgICAgICAgICB0aGlzW1wiX1wiICsgcHJvcE5hbWVdID0gdmFsO1xuICAgICAgICAgIHJldHVybiB0cmVlLnB1c2godGhpcyk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbXCJfXCIgKyBwcm9wTmFtZV07XG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB3cml0ZUFjY2Vzc29ycyhcInhcIik7XG4gICAgd3JpdGVBY2Nlc3NvcnMoXCJ5XCIpO1xuICAgIHdyaXRlQWNjZXNzb3JzKFwid2lkdGhcIik7XG4gICAgcmV0dXJuIHdyaXRlQWNjZXNzb3JzKFwiaGVpZ2h0XCIpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oaXRlbSwgZG9PYnNlcnZlKSB7XG4gICAgcmV0dXJuIHRoaXMucHVzaEFsbChbaXRlbV0sIGRvT2JzZXJ2ZSk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnB1c2hBbGwgPSBmdW5jdGlvbihpdGVtcywgZG9PYnNlcnZlKSB7XG4gICAgdmFyIGNhbmRpZGF0ZSwgY29udGVudCwgY29udGVudERpciwgZGlyZWN0aW9uLCBlbGVtZW50LCBlbGVtZW50cywgZmlmbywgZmlmb0NhbmRpZGF0ZXMsIGl0ZW0sIGosIGssIGwsIGxlbiwgbGVuMSwgbGVuMiwgcmVmLCByZWxhdGVkQ2hpbGQsIHRvcCwgdHJlZTtcbiAgICBmb3IgKGogPSAwLCBsZW4gPSBpdGVtcy5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgaXRlbSA9IGl0ZW1zW2pdO1xuICAgICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgICAgaWYgKGRvT2JzZXJ2ZSkge1xuICAgICAgICBvYnNlcnZlKGl0ZW0sIHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgICBmaWZvID0gW1xuICAgICAge1xuICAgICAgICB0cmVlOiB0aGlzLFxuICAgICAgICBlbGVtZW50czogaXRlbXNcbiAgICAgIH1cbiAgICBdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHRyZWUgPSB0b3AudHJlZTtcbiAgICAgIGVsZW1lbnRzID0gdG9wLmVsZW1lbnRzO1xuICAgICAgZmlmb0NhbmRpZGF0ZXMgPSB7XG4gICAgICAgIFwiTldcIjogbnVsbCxcbiAgICAgICAgXCJORVwiOiBudWxsLFxuICAgICAgICBcIlNXXCI6IG51bGwsXG4gICAgICAgIFwiU0VcIjogbnVsbFxuICAgICAgfTtcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSBlbGVtZW50cy5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnRzW2tdO1xuICAgICAgICB0cmVlLnNpemUrKztcbiAgICAgICAgZGlyZWN0aW9uID0gY2FsY3VsYXRlRGlyZWN0aW9uKGVsZW1lbnQsIHRyZWUpO1xuICAgICAgICByZWxhdGVkQ2hpbGQgPSB0cmVlLmNoaWxkcmVuW2RpcmVjdGlvbl07XG4gICAgICAgIGlmICh0cmVlLndpZHRoID09PSAxIHx8IHRyZWUuaGVpZ2h0ID09PSAxIHx8IGlzT3ZlcnNpemVkKGVsZW1lbnQsIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKSkpIHtcbiAgICAgICAgICB0cmVlLm92ZXJzaXplZC5wdXNoKGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKHRyZWUuc2l6ZSA8PSB0cmVlLm1heEVsZW1lbnRzKSB7XG4gICAgICAgICAgdHJlZS5jb250ZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChmaWZvQ2FuZGlkYXRlc1tkaXJlY3Rpb25dID09IG51bGwpIHtcbiAgICAgICAgICAgIGZpZm9DYW5kaWRhdGVzW2RpcmVjdGlvbl0gPSB7XG4gICAgICAgICAgICAgIHRyZWU6IHJlbGF0ZWRDaGlsZC5nZXQoKSxcbiAgICAgICAgICAgICAgZWxlbWVudHM6IFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBmaWZvQ2FuZGlkYXRlc1tkaXJlY3Rpb25dLmVsZW1lbnRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgICAgcmVmID0gdHJlZS5jb250ZW50cztcbiAgICAgICAgICBmb3IgKGwgPSAwLCBsZW4yID0gcmVmLmxlbmd0aDsgbCA8IGxlbjI7IGwrKykge1xuICAgICAgICAgICAgY29udGVudCA9IHJlZltsXTtcbiAgICAgICAgICAgIGNvbnRlbnREaXIgPSBjYWxjdWxhdGVEaXJlY3Rpb24oY29udGVudCwgdHJlZSk7XG4gICAgICAgICAgICBpZiAoZmlmb0NhbmRpZGF0ZXNbY29udGVudERpcl0gPT0gbnVsbCkge1xuICAgICAgICAgICAgICBmaWZvQ2FuZGlkYXRlc1tjb250ZW50RGlyXSA9IHtcbiAgICAgICAgICAgICAgICB0cmVlOiB0cmVlLmNoaWxkcmVuW2NvbnRlbnREaXJdLmdldCgpLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRzOiBbXVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmlmb0NhbmRpZGF0ZXNbY29udGVudERpcl0uZWxlbWVudHMucHVzaChjb250ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHJlZS5jb250ZW50cyA9IFtdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGRpcmVjdGlvbiBpbiBmaWZvQ2FuZGlkYXRlcykge1xuICAgICAgICBjYW5kaWRhdGUgPSBmaWZvQ2FuZGlkYXRlc1tkaXJlY3Rpb25dO1xuICAgICAgICBpZiAoY2FuZGlkYXRlICE9IG51bGwpIHtcbiAgICAgICAgICBmaWZvLnB1c2goY2FuZGlkYXRlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaXRlbSkge1xuICAgIHZhciBpbmRleCwgcmVsYXRlZENoaWxkO1xuICAgIHZhbGlkYXRlRWxlbWVudChpdGVtKTtcbiAgICBpbmRleCA9IHRoaXMub3ZlcnNpemVkLmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgIHRoaXMub3ZlcnNpemVkLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB0aGlzLnNpemUtLTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpbmRleCA9IHRoaXMuY29udGVudHMuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5vdmVyc2l6ZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIHRoaXMuc2l6ZS0tO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJlbGF0ZWRDaGlsZCA9IHRoaXMuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGl0ZW0sIHRoaXMpXTtcbiAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUucmVtb3ZlKGl0ZW0pKSB7XG4gICAgICB0aGlzLnNpemUtLTtcbiAgICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZS5zaXplID09PSAwKSB7XG4gICAgICAgIHJlbGF0ZWRDaGlsZC50cmVlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5jb2xsaWRpbmcgPSBmdW5jdGlvbihpdGVtLCBjb2xsaXNpb25GdW5jdGlvbikge1xuICAgIHZhciBib3VuZGluZ0JveENvbGxpc2lvbiwgY2hpbGQsIGVsdCwgZmlmbywgaXRlbXMsIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgYm91bmRpbmdCb3hDb2xsaXNpb24gPSBmdW5jdGlvbihlbHQxLCBlbHQyKSB7XG4gICAgICB2YXIgcmVmLCByZWYxLCByZWYyLCByZWYzO1xuICAgICAgcmV0dXJuICEoZWx0MS54ID4gZWx0Mi54ICsgKChyZWYgPSBlbHQyLndpZHRoKSAhPSBudWxsID8gcmVmIDogMCkgfHwgZWx0MS54ICsgKChyZWYxID0gZWx0MS53aWR0aCkgIT0gbnVsbCA/IHJlZjEgOiAwKSA8IGVsdDIueCB8fCBlbHQxLnkgPiBlbHQyLnkgKyAoKHJlZjIgPSBlbHQyLmhlaWdodCkgIT0gbnVsbCA/IHJlZjIgOiAwKSB8fCBlbHQxLnkgKyAoKHJlZjMgPSBlbHQxLmhlaWdodCkgIT0gbnVsbCA/IHJlZjMgOiAwKSA8IGVsdDIueSk7XG4gICAgfTtcbiAgICBpZiAoY29sbGlzaW9uRnVuY3Rpb24gPT0gbnVsbCkge1xuICAgICAgY29sbGlzaW9uRnVuY3Rpb24gPSBib3VuZGluZ0JveENvbGxpc2lvbjtcbiAgICB9XG4gICAgaXRlbXMgPSBbXTtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgZWx0ID0gcmVmW2pdO1xuICAgICAgICBpZiAoZWx0ICE9PSBpdGVtICYmIGNvbGxpc2lvbkZ1bmN0aW9uKGl0ZW0sIGVsdCkpIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKGVsdCAhPT0gaXRlbSAmJiBjb2xsaXNpb25GdW5jdGlvbihpdGVtLCBlbHQpKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0b3AuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGl0ZW0sIHRvcCldO1xuICAgICAgaWYgKGlzT3ZlcnNpemVkKGl0ZW0sIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKSkpIHtcbiAgICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgICBpZiAoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSAmJiBib3VuZGluZ0JveENvbGxpc2lvbih0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUsIGl0ZW0pKSB7XG4gICAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocmVsYXRlZENoaWxkLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICBmaWZvLnB1c2gocmVsYXRlZENoaWxkLnRyZWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgcmV0dXJuIHRoaXMud2hlcmUocXVlcnkpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS53aGVyZSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgdmFyIGNoZWNrLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBrZXksIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICBpZiAodHlwZW9mIHF1ZXJ5ID09PSBcIm9iamVjdFwiICYmIChxdWVyeS54ID09IG51bGwpICYmIChxdWVyeS55ID09IG51bGwpKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kKGZ1bmN0aW9uKGVsdCkge1xuICAgICAgICB2YXIgY2hlY2ssIGtleTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgIGlmIChxdWVyeVtrZXldICE9PSBlbHRba2V5XSkge1xuICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoZWNrO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHZhbGlkYXRlRWxlbWVudChxdWVyeSk7XG4gICAgaXRlbXMgPSBbXTtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgZWx0ID0gcmVmW2pdO1xuICAgICAgICBjaGVjayA9IHRydWU7XG4gICAgICAgIGZvciAoa2V5IGluIHF1ZXJ5KSB7XG4gICAgICAgICAgaWYgKHF1ZXJ5W2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgIGlmIChxdWVyeVtrZXldICE9PSBlbHRba2V5XSkge1xuICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0b3AuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKHF1ZXJ5LCB0b3ApXTtcbiAgICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZSAhPSBudWxsKSB7XG4gICAgICAgIGZpZm8ucHVzaChyZWxhdGVkQ2hpbGQudHJlZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaSwgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHRvcDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaSA9IHJlZltqXTtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGFjdGlvbihpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMSA9IHRvcC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGFjdGlvbihpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICB2YXIgY2hpbGQsIGZpZm8sIGksIGl0ZW1zLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgdG9wO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgaXRlbXMgPSBbXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGkgPSByZWZbal07XG4gICAgICAgIGlmICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaSkgOiB2b2lkIDApIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGkgPSByZWYxW2tdO1xuICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGkpIDogdm9pZCAwKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1zO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICB2YXIgZGVlcGNsb25lO1xuICAgIGRlZXBjbG9uZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgdmFyIGNoaWxkLCBjb3B5Y2F0LCBpdGVtLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVmMiwgcmVmMztcbiAgICAgIGNvcHljYXQgPSBuZXcgUXVhZHRyZWUoe1xuICAgICAgICB4OiB0YXJnZXQueCxcbiAgICAgICAgeTogdGFyZ2V0LnksXG4gICAgICAgIHdpZHRoOiB0YXJnZXQud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGFyZ2V0LmhlaWdodCxcbiAgICAgICAgbWF4RWxlbWVudHM6IHRhcmdldC5tYXhFbGVtZW50c1xuICAgICAgfSk7XG4gICAgICBjb3B5Y2F0LnNpemUgPSAwO1xuICAgICAgZm9yIChjaGlsZCBpbiB0YXJnZXQuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKCEodGFyZ2V0LmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSA9IGRlZXBjbG9uZSh0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICBjb3B5Y2F0LnNpemUgKz0gKHJlZiA9IChyZWYxID0gY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSkgIT0gbnVsbCA/IHJlZjEuc2l6ZSA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZiA6IDA7XG4gICAgICB9XG4gICAgICByZWYyID0gdGFyZ2V0Lm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZjIubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaXRlbSA9IHJlZjJbal07XG4gICAgICAgIGlmICgocHJlZGljYXRlID09IG51bGwpIHx8ICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaXRlbSkgOiB2b2lkIDApKSB7XG4gICAgICAgICAgY29weWNhdC5vdmVyc2l6ZWQucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMyA9IHRhcmdldC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpdGVtID0gcmVmM1trXTtcbiAgICAgICAgaWYgKChwcmVkaWNhdGUgPT0gbnVsbCkgfHwgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpdGVtKSA6IHZvaWQgMCkpIHtcbiAgICAgICAgICBjb3B5Y2F0LmNvbnRlbnRzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvcHljYXQuc2l6ZSArPSBjb3B5Y2F0Lm92ZXJzaXplZC5sZW5ndGggKyBjb3B5Y2F0LmNvbnRlbnRzLmxlbmd0aDtcbiAgICAgIGlmIChjb3B5Y2F0LnNpemUgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gY29weWNhdDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBkZWVwY2xvbmUodGhpcyk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbihpKSB7XG4gICAgICByZXR1cm4gISh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaSkgOiB2b2lkIDApO1xuICAgIH0pO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS52aXNpdCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgdGhhdDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoYXQgPSBmaWZvLnNoaWZ0KCk7XG4gICAgICBhY3Rpb24uYmluZCh0aGF0KSgpO1xuICAgICAgZm9yIChjaGlsZCBpbiB0aGF0LmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICh0aGF0LmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICBmaWZvLnB1c2godGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnByZXR0eSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaW5kZW50LCBpbmRlbnRhdGlvbiwgaXNQYXJlbnQsIHN0ciwgdG9wO1xuICAgIHN0ciA9IFwiXCI7XG4gICAgaW5kZW50ID0gZnVuY3Rpb24obGV2ZWwpIHtcbiAgICAgIHZhciBqLCByZWYsIHJlcywgdGltZXM7XG4gICAgICByZXMgPSBcIlwiO1xuICAgICAgZm9yICh0aW1lcyA9IGogPSByZWYgPSBsZXZlbDsgcmVmIDw9IDAgPyBqIDwgMCA6IGogPiAwOyB0aW1lcyA9IHJlZiA8PSAwID8gKytqIDogLS1qKSB7XG4gICAgICAgIHJlcyArPSBcIiAgIFwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcztcbiAgICB9O1xuICAgIGZpZm8gPSBbXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBcIlJPT1RcIixcbiAgICAgICAgdHJlZTogdGhpcyxcbiAgICAgICAgbGV2ZWw6IDBcbiAgICAgIH1cbiAgICBdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc2hpZnQoKTtcbiAgICAgIGluZGVudGF0aW9uID0gaW5kZW50KHRvcC5sZXZlbCk7XG4gICAgICBzdHIgKz0gaW5kZW50YXRpb24gKyBcInwgXCIgKyB0b3AubGFiZWwgKyBcIlxcblwiICsgaW5kZW50YXRpb24gKyBcInwgLS0tLS0tLS0tLS0tXFxuXCI7XG4gICAgICBpZiAodG9wLnRyZWUub3ZlcnNpemVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3RyICs9IGluZGVudGF0aW9uICsgXCJ8ICogT3ZlcnNpemVkIGVsZW1lbnRzICpcXG5cIiArIGluZGVudGF0aW9uICsgXCJ8ICAgXCIgKyB0b3AudHJlZS5vdmVyc2l6ZWQgKyBcIlxcblwiO1xuICAgICAgfVxuICAgICAgaWYgKHRvcC50cmVlLmNvbnRlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc3RyICs9IGluZGVudGF0aW9uICsgXCJ8ICogTGVhZiBjb250ZW50ICpcXG5cIiArIGluZGVudGF0aW9uICsgXCJ8ICAgXCIgKyB0b3AudHJlZS5jb250ZW50cyArIFwiXFxuXCI7XG4gICAgICB9XG4gICAgICBpc1BhcmVudCA9IGZhbHNlO1xuICAgICAgZm9yIChjaGlsZCBpbiB0b3AudHJlZS5jaGlsZHJlbikge1xuICAgICAgICBpZiAoISh0b3AudHJlZS5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlzUGFyZW50ID0gdHJ1ZTtcbiAgICAgICAgZmlmby51bnNoaWZ0KHtcbiAgICAgICAgICBsYWJlbDogY2hpbGQsXG4gICAgICAgICAgdHJlZTogdG9wLnRyZWUuY2hpbGRyZW5bY2hpbGRdLnRyZWUsXG4gICAgICAgICAgbGV2ZWw6IHRvcC5sZXZlbCArIDFcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoaXNQYXJlbnQpIHtcbiAgICAgICAgc3RyICs9IGluZGVudGF0aW9uICsgXCLilJTilIDilIDilJBcXG5cIjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbiAgfTtcblxuICByZXR1cm4gUXVhZHRyZWU7XG5cbn0pKCk7XG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1vZHVsZSAhPT0gbnVsbCkge1xuICBtb2R1bGUuZXhwb3J0cyA9IFF1YWR0cmVlO1xufVxuIl19
