var Quadtree;Quadtree=function(){function e(t){var n,i;if(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.maxElements=t.maxElements,null==this.width||null==this.height)throw new Error("Missing quadtree dimensions.");if(null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.maxElements&&(this.maxElements=1),this.contents=[],this.oversized=[],this.size=0,this.x<0||this.y<0||this.width<1||this.height<1)throw new Error("Dimensions must be positive integers.");if(this.maxElements<1)throw new Error("The maximum of elements by leaf must be a positive integer.");i=this,this.children={NW:{create:function(){return new e({x:i.x,y:i.y,width:Math.max(Math.floor(i.width/2),1),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},NE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y,width:Math.ceil(i.width/2),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},SW:{create:function(){return new e({x:i.x,y:i.y+Math.min(Math.floor(i.height/2),1),width:Math.max(Math.floor(i.width/2),1),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null},SE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.ceil(i.width/2),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null}};for(n in this.children)this.children[n].get=function(){return null!=this.tree?this.tree:(this.tree=this.create(),this.tree)}}var t,n,i,h;return n=function(e){var t,n;return{x:Math.floor((null!=(t=e.width)?t:1)/2)+e.x,y:Math.floor((null!=(n=e.height)?n:1)/2)+e.y}},h=function(e){if(null==e.x||null==e.y||e.x<0||e.y<0)throw new Error("Object must contain x or y positions as arguments, and they must be positive integers.");if((null!=e?e.width:void 0)<0||(null!=e?e.height:void 0)<0)throw new Error("Width and height arguments must be positive integers.")},t=function(e,t){var i;return i=n(t),e.x<i.x?e.y<i.y?"NW":"SW":e.y<i.y?"NE":"SE"},i=function(e,t){var n,i;return e.x<t.x||e.x+(null!=(n=e.width)?n:0)>=t.x+t.width||e.y<t.y||e.y+(null!=(i=e.height)?i:0)>=t.y+t.height},e.prototype.push=function(e){var n,r,l,s,o,u,c,d,f;for(h(e),l=[{tree:this,element:e}];l.length>0;)if(d=l.splice(0,1)[0],f=d.tree,r=d.element,f.size++,c=f.children[t(r,f)],1===f.width||1===f.height||i(r,c.create()))f.oversized.push(r);else if(f.size<=f.maxElements)f.contents.push(r);else{for(l.push({tree:c.get(),element:r}),u=f.contents,s=0,o=u.length;o>s;s++)n=u[s],l.push({tree:f.children[t(n,f)].get(),element:n});f.contents=[]}return this},e.prototype.remove=function(e){var n,i;return h(e),n=this.oversized.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(n=this.contents.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(i=this.children[t(e,this)],null==i.tree?!1:i.tree.remove(e)?(this.size--,0===i.tree.size&&(i.tree=null),!0):!1))},e.prototype.colliding=function(e,n){var r,l,s,o,u,c,d,f,a,m,p,x;for(h(e),null==n&&(n=function(e,t){var n,i,h,r;return!(e.x>t.x+(null!=(n=t.width)?n:0)||e.x+(null!=(i=e.width)?i:0)<t.x||e.y>t.y+(null!=(h=t.height)?h:0)||e.y+(null!=(r=e.height)?r:0)<t.y)}),o=[],s=[this];s.length>0;){for(x=s.splice(0,1)[0],a=x.oversized,u=0,d=a.length;d>u;u++)l=a[u],l!==e&&n(e,l)&&o.push(l);for(m=x.contents,c=0,f=m.length;f>c;c++)l=m[c],l!==e&&n(e,l)&&o.push(l);if(p=x.children[t(e,x)],i(e,p.create()))for(r in x.children)null!=x.children[r].tree&&s.push(x.children[r].tree);else null!=p.tree&&s.push(p.tree)}return o},e.prototype.get=function(e){return this.where(e)},e.prototype.where=function(e){var n,i,r,l,s,o,u,c,d,f,a,m,p;for(h(e),l=[],r=[this];r.length>0;){for(p=r.splice(0,1)[0],f=p.oversized,s=0,c=f.length;c>s;s++){i=f[s],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}for(a=p.contents,o=0,d=a.length;d>o;o++){i=a[o],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}m=p.children[t(e,p)],null!=m.tree&&r.push(m.tree)}return l},e.prototype.each=function(e){var t,n,i,h,r,l,s,o,u,c;for(n=[this];n.length>0;){for(c=n.splice(0,1)[0],o=c.oversized,h=0,l=o.length;l>h;h++)i=o[h],"function"==typeof e&&e(i);for(u=c.contents,r=0,s=u.length;s>r;r++)i=u[r],"function"==typeof e&&e(i);for(t in c.children)null!=c.children[t].tree&&n.push(c.children[t].tree)}return this},e.prototype.find=function(e){var t,n,i,h,r,l,s,o,u,c,d;for(n=[this],h=[];n.length>0;){for(d=n.splice(0,1)[0],u=d.oversized,r=0,s=u.length;s>r;r++)i=u[r],("function"==typeof e?e(i):void 0)&&h.push(i);for(c=d.contents,l=0,o=c.length;o>l;l++)i=c[l],("function"==typeof e?e(i):void 0)&&h.push(i);for(t in d.children)null!=d.children[t].tree&&n.push(d.children[t].tree)}return h},e.prototype.filter=function(t){var n;return(n=function(i){var h,r,l,s,o,u,c,d,f,a,m;r=new e({x:i.x,y:i.y,width:i.width,height:i.height,maxElements:i.maxElements}),r.size=0;for(h in i.children)null!=i.children[h].tree&&(r.children[h].tree=n(i.children[h].tree),r.size+=null!=(d=null!=(f=r.children[h].tree)?f.size:void 0)?d:0);for(a=i.oversized,s=0,u=a.length;u>s;s++)l=a[s],(null==t||("function"==typeof t?t(l):void 0))&&r.oversized.push(l);for(m=i.contents,o=0,c=m.length;c>o;o++)l=m[o],(null==t||("function"==typeof t?t(l):void 0))&&r.contents.push(l);return r.size+=r.oversized.length+r.contents.length,0===r.size?null:r})(this)},e.prototype.visit=function(e){var t,n,i;for(n=[this];n.length>0;){i=n.splice(0,1)[0],e.bind(i)();for(t in i.children)null!=i.children[t].tree&&n.push(i.children[t].tree)}return this},e}(),"undefined"!=typeof module&&null!==module&&(module.exports=Quadtree);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1YWR0cmVlLmNvZmZlZSIsInF1YWR0cmVlLmpzIl0sIm5hbWVzIjpbIlF1YWR0cmVlIiwiYXJnIiwiY2hpbGQiLCJ0aGF0IiwidGhpcyIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXhFbGVtZW50cyIsIkVycm9yIiwiY29udGVudHMiLCJvdmVyc2l6ZWQiLCJzaXplIiwiY2hpbGRyZW4iLCJOVyIsImNyZWF0ZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsInRyZWUiLCJORSIsImNlaWwiLCJTVyIsIm1pbiIsIlNFIiwiZ2V0IiwiY2FsY3VsYXRlRGlyZWN0aW9uIiwiZ2V0Q2VudGVyIiwiaXNPdmVyc2l6ZWQiLCJ2YWxpZGF0ZUVsZW1lbnQiLCJpdGVtIiwicmVmIiwicmVmMSIsImVsZW1lbnQiLCJxdWFkQ2VudGVyIiwicHJvdG90eXBlIiwicHVzaCIsImMiLCJmaWZvIiwiaiIsImxlbiIsInJlbGF0ZWRDaGlsZCIsInRvcCIsImxlbmd0aCIsInNwbGljZSIsInJlbW92ZSIsImluZGV4IiwiaW5kZXhPZiIsImNvbGxpZGluZyIsImNvbGxpc2lvbkZ1bmN0aW9uIiwiZWx0IiwiaXRlbXMiLCJrIiwibGVuMSIsImVsdDEiLCJlbHQyIiwicmVmMiIsInJlZjMiLCJwYXJhbXMiLCJ3aGVyZSIsImNoZWNrIiwia2V5IiwiZWFjaCIsImFjdGlvbiIsImkiLCJmaW5kIiwicHJlZGljYXRlIiwiZmlsdGVyIiwidmFsaWRhdGUiLCJkZWVwY2xvbmUiLCJ0YXJnZXQiLCJjb3B5Y2F0IiwidmlzaXQiLCJiaW5kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsU0FBTUEsVUFBQSxXQUNXLFFBQUFBLEdBQUNDLEdBQ1YsR0FBQUMsR0FBQUMsQ0FBQSxJQURXQyxLQUFDQyxFQUFBSixFQUFBSSxFQUFHRCxLQUFDRSxFQUFBTCxFQUFBSyxFQUFHRixLQUFDRyxNQUFBTixFQUFBTSxNQUFPSCxLQUFDSSxPQUFBUCxFQUFBTyxPQUFRSixL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SURwSTZCLE1BQUFnQixJQUFKLGtCQUFBQSxHQUFpQkEsRUFBVXRDLEdBQUEsVUFDeER5QyxFQUFRN0QsU0FBUzBCLEtBQUtOLEVBRzFCLE9BREF5QyxHQUFRM0QsTUFBUTJELEVBQVE1RCxVQUFVZ0MsT0FBUzRCLEVBQVE3RCxTQUFTaUMsT0FDekMsSUFBaEI0QixFQUFRM0QsS0FBZSxLQUFVMkQsSUFFOUJwRSxPQzZJaEJKLEVBQVNvQyxVRDNJUHFDLE1BQU8sU0FBQ1QsR0FDSixHQUFBOUQsR0FBQXFDLEVBQUFwQyxDQUVBLEtBRkFvQyxHQUFRbkMsTUFFRm1DLEVBQUtLLE9BQVMsR0FBcEIsQ0FDSXpDLEVBQU9vQyxFQUFLTSxPQUFPLEVBQUcsR0FBRyxHQUN6Qm1CLEVBQU9VLEtBQUt2RSxJQUVaLEtBQUFELElBQUFDLEdBQUFXLFNBQWdDLE1BQUFYLEVBQUFXLFNBQUFaLEdBQUFrQixNQUM1Qm1CLEVBQUtGLEtBQUtsQyxFQUFLVyxTQUFTWixHQUFPa0IsTUMrSTNDLE1EOUlJaEIsT0NpSkNKLEtBSWEsbUJBQVgyRSxTQUFxQyxPQUFYQSxTRG5KckNBLE9BQVFDLFFBQVU1RSIsImZpbGUiOiJxdWFkdHJlZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFF1YWR0cmVlXG4gICAgY29uc3RydWN0b3I6ICh7QHgsIEB5LCBAd2lkdGgsIEBoZWlnaHQsIEBtYXhFbGVtZW50c30pIC0+XG4gICAgICAgIHRocm93IG5ldyBFcnJvciBcIk1pc3NpbmcgcXVhZHRyZWUgZGltZW5zaW9ucy5cIiBpZiBub3QgQHdpZHRoPyBvciBub3QgQGhlaWdodD9cbiAgICAgICAgQHggPz0gMFxuICAgICAgICBAeSA/PSAwXG4gICAgICAgIEBtYXhFbGVtZW50cyA/PSAxXG4gICAgICAgIEBjb250ZW50cyA9IFtdXG4gICAgICAgIEBvdmVyc2l6ZWQgPSBbXVxuICAgICAgICBAc2l6ZSA9IDBcblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJEaW1lbnNpb25zIG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIgaWYgQHggPCAwIG9yIEB5IDwgMCBvciBAd2lkdGggPCAxIG9yIEBoZWlnaHQgPCAxXG4gICAgICAgIHRocm93IG5ldyBFcnJvciBcIlRoZSBtYXhpbXVtIG9mIGVsZW1lbnRzIGJ5IGxlYWYgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIuXCIgaWYgQG1heEVsZW1lbnRzIDwgMVxuXG4gICAgICAgIHRoYXQgPSBAXG5cbiAgICAgICAgQGNoaWxkcmVuID0ge1xuICAgICAgICAgICAgXCJOV1wiOlxuICAgICAgICAgICAgICAgIGNyZWF0ZTogKCkgLT5cbiAgICAgICAgICAgICAgICAgICAgbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRoYXQueFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogdGhhdC55XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5tYXggKE1hdGguZmxvb3IgdGhhdC53aWR0aCAvIDIpLCAxXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQuaGVpZ2h0IC8gMiksIDFcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgdHJlZTogbnVsbFxuICAgICAgICAgICAgXCJORVwiOlxuICAgICAgICAgICAgICAgIGNyZWF0ZTogKCkgLT5cbiAgICAgICAgICAgICAgICAgICAgbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRoYXQueCArIE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQud2lkdGggLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgeTogdGhhdC55XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsIHRoYXQud2lkdGggLyAyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQuaGVpZ2h0IC8gMiksIDFcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgdHJlZTogbnVsbFxuICAgICAgICAgICAgXCJTV1wiOlxuICAgICAgICAgICAgICAgIGNyZWF0ZTogKCkgLT5cbiAgICAgICAgICAgICAgICAgICAgbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRoYXQueFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5taW4gKE1hdGguZmxvb3IgdGhhdC5oZWlnaHQgLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQud2lkdGggLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwgdGhhdC5oZWlnaHQgLyAyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRyZWU6IG51bGxcbiAgICAgICAgICAgIFwiU0VcIjpcbiAgICAgICAgICAgICAgICBjcmVhdGU6ICgpIC0+XG4gICAgICAgICAgICAgICAgICAgIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB4OiB0aGF0LnggKyBNYXRoLm1heCAoTWF0aC5mbG9vciB0aGF0LndpZHRoIC8gMiksIDFcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHRoYXQueSArIE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQuaGVpZ2h0IC8gMiksIDFcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwgdGhhdC53aWR0aCAvIDJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5jZWlsIHRoYXQuaGVpZ2h0IC8gMlxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB0cmVlOiBudWxsXG4gICAgICAgIH1cbiAgICAgICAgZm9yIGNoaWxkIG9mIEBjaGlsZHJlblxuICAgICAgICAgICAgQGNoaWxkcmVuW2NoaWxkXS5nZXQgPSAoKSAtPlxuICAgICAgICAgICAgICAgIGlmIEB0cmVlPyB0aGVuIEB0cmVlIGVsc2UgQHRyZWUgPSBAY3JlYXRlKCk7IEB0cmVlXG5cbiAgICAjIyBJbnRlcm5hbCBtZXRob2RzICYgdmFycyAjI1xuXG4gICAgZ2V0Q2VudGVyID0gKGl0ZW0pIC0+XG4gICAgICAgIHg6IE1hdGguZmxvb3IoKGl0ZW0ud2lkdGggID8gMSkgLyAyKSArIGl0ZW0ueFxuICAgICAgICB5OiBNYXRoLmZsb29yKChpdGVtLmhlaWdodCA/IDEpIC8gMikgKyBpdGVtLnlcblxuICAgIHZhbGlkYXRlRWxlbWVudCA9IChlbGVtZW50KSAtPlxuICAgICAgICBpZiBub3QgdHlwZW9mIGVsZW1lbnQgaXMgXCJvYmplY3RcIiBvciBub3QgZWxlbWVudC54PyBvciBub3QgZWxlbWVudC55PyBvciBlbGVtZW50LnggPCAwIG9yIGVsZW1lbnQueSA8IDBcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciBcIk9iamVjdCBtdXN0IGNvbnRhaW4geCBvciB5IHBvc2l0aW9ucyBhcyBhcmd1bWVudHMsIGFuZCB0aGV5IG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCJcbiAgICAgICAgaWYgZWxlbWVudD8ud2lkdGggPCAwIG9yIGVsZW1lbnQ/LmhlaWdodCA8IDBcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciBcIldpZHRoIGFuZCBoZWlnaHQgYXJndW1lbnRzIG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCJcblxuICAgIGNhbGN1bGF0ZURpcmVjdGlvbiA9IChlbGVtZW50LCB0cmVlKSAtPlxuICAgICAgICBlbGVtZW50XG4gICAgICAgIHF1YWRDZW50ZXIgPSBnZXRDZW50ZXIgdHJlZVxuXG4gICAgICAgIGlmIGVsZW1lbnQueCA8IHF1YWRDZW50ZXIueFxuICAgICAgICAgICAgaWYgZWxlbWVudC55IDwgcXVhZENlbnRlci55IHRoZW4gXCJOV1wiXG4gICAgICAgICAgICBlbHNlIFwiU1dcIlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiBlbGVtZW50LnkgPCBxdWFkQ2VudGVyLnkgdGhlbiBcIk5FXCJcbiAgICAgICAgICAgIGVsc2UgXCJTRVwiXG5cbiAgICBpc092ZXJzaXplZCA9IChlbGVtZW50LCB0cmVlKSAtPlxuICAgICAgICBlbGVtZW50LnggPCB0cmVlLnggb3JcbiAgICAgICAgZWxlbWVudC54ICsgKGVsZW1lbnQud2lkdGggPyAwKSA+PSB0cmVlLnggKyB0cmVlLndpZHRoIG9yXG4gICAgICAgIGVsZW1lbnQueSA8IHRyZWUueSBvclxuICAgICAgICBlbGVtZW50LnkgKyAoZWxlbWVudC5oZWlnaHQgPyAwKSA+PSB0cmVlLnkgKyB0cmVlLmhlaWdodFxuXG4gICAgIyMgRXhwb3NlZCBtZXRob2RzICMjXG5cbiAgICBwdXNoOiAoaXRlbSkgLT5cbiAgICAgICAgdmFsaWRhdGVFbGVtZW50IGl0ZW1cblxuICAgICAgICBmaWZvID0gW3RyZWU6IEAsIGVsZW1lbnQ6IGl0ZW1dXG5cbiAgICAgICAgd2hpbGUgZmlmby5sZW5ndGggPiAwXG4gICAgICAgICAgICB0b3AgPSBmaWZvLnNwbGljZSgwLCAxKVswXVxuICAgICAgICAgICAgdHJlZSA9IHRvcC50cmVlXG4gICAgICAgICAgICBlbGVtZW50ID0gdG9wLmVsZW1lbnRcblxuICAgICAgICAgICAgdHJlZS5zaXplKytcblxuICAgICAgICAgICAgcmVsYXRlZENoaWxkID0gdHJlZS5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24gZWxlbWVudCwgdHJlZV1cblxuICAgICAgICAgICAgaWYgdHJlZS53aWR0aCBpcyAxIG9yIHRyZWUuaGVpZ2h0IGlzIDEgb3IgaXNPdmVyc2l6ZWQgZWxlbWVudCwgcmVsYXRlZENoaWxkLmNyZWF0ZSgpXG4gICAgICAgICAgICAgICAgdHJlZS5vdmVyc2l6ZWQucHVzaCBlbGVtZW50XG5cbiAgICAgICAgICAgIGVsc2UgaWYgdHJlZS5zaXplIDw9IHRyZWUubWF4RWxlbWVudHNcbiAgICAgICAgICAgICAgICB0cmVlLmNvbnRlbnRzLnB1c2ggZWxlbWVudFxuXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZmlmby5wdXNoIHRyZWU6IHJlbGF0ZWRDaGlsZC5nZXQoKSwgZWxlbWVudDogZWxlbWVudFxuXG4gICAgICAgICAgICAgICAgZm9yIGMgaW4gdHJlZS5jb250ZW50c1xuICAgICAgICAgICAgICAgICAgICBmaWZvLnB1c2ggdHJlZTogdHJlZS5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24gYywgdHJlZV0uZ2V0KCksIGVsZW1lbnQ6IGNcblxuICAgICAgICAgICAgICAgIHRyZWUuY29udGVudHMgPSBbXVxuICAgICAgICBAXG5cbiAgICByZW1vdmU6IChpdGVtKSAtPlxuICAgICAgICB2YWxpZGF0ZUVsZW1lbnQgaXRlbVxuXG4gICAgICAgIGluZGV4ID0gQG92ZXJzaXplZC5pbmRleE9mIGl0ZW1cbiAgICAgICAgaWYgaW5kZXggPiAtIDFcbiAgICAgICAgICAgIEBvdmVyc2l6ZWQuc3BsaWNlIGluZGV4LCAxXG4gICAgICAgICAgICBAc2l6ZS0tXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICBpbmRleCA9IEBjb250ZW50cy5pbmRleE9mIGl0ZW1cbiAgICAgICAgaWYgaW5kZXggPiAtIDFcbiAgICAgICAgICAgIEBvdmVyc2l6ZWQuc3BsaWNlIGluZGV4LCAxXG4gICAgICAgICAgICBAc2l6ZS0tXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgICAgIHJlbGF0ZWRDaGlsZCA9IEBjaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24gaXRlbSwgQF1cbiAgICAgICAgaWYgbm90IHJlbGF0ZWRDaGlsZC50cmVlP1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgaWYgcmVsYXRlZENoaWxkLnRyZWUucmVtb3ZlIGl0ZW1cbiAgICAgICAgICAgIEBzaXplLS1cbiAgICAgICAgICAgIHJlbGF0ZWRDaGlsZC50cmVlID0gbnVsbCBpZiByZWxhdGVkQ2hpbGQudHJlZS5zaXplIGlzIDBcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZmFsc2VcblxuICAgIGNvbGxpZGluZzogKGl0ZW0sIGNvbGxpc2lvbkZ1bmN0aW9uKSAtPlxuICAgICAgICB2YWxpZGF0ZUVsZW1lbnQgaXRlbVxuXG4gICAgICAgICMgRGVmYXVsdCByZWN0YW5nbGUgY29sbGlzaW9uXG4gICAgICAgIGlmIG5vdCBjb2xsaXNpb25GdW5jdGlvbj9cbiAgICAgICAgICAgIGNvbGxpc2lvbkZ1bmN0aW9uID0gKGVsdDEsIGVsdDIpIC0+XG4gICAgICAgICAgICAgICAgbm90KGVsdDEueCA+IGVsdDIueCArIChlbHQyLndpZHRoID8gMCkgICAgICBvclxuICAgICAgICAgICAgICAgICAgICBlbHQxLnggKyAoZWx0MS53aWR0aCA/IDApIDwgZWx0Mi54ICAgICAgb3JcbiAgICAgICAgICAgICAgICAgICAgZWx0MS55ID4gZWx0Mi55ICsgKGVsdDIuaGVpZ2h0ID8gMCkgICAgIG9yXG4gICAgICAgICAgICAgICAgICAgIGVsdDEueSArIChlbHQxLmhlaWdodCA/IDApIDwgZWx0Mi55KVxuXG4gICAgICAgIGl0ZW1zID0gW11cbiAgICAgICAgZmlmbyA9IFtAXVxuXG4gICAgICAgIHdoaWxlIGZpZm8ubGVuZ3RoID4gMFxuICAgICAgICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF1cblxuICAgICAgICAgICAgZm9yIGVsdCBpbiB0b3Aub3ZlcnNpemVkIHdoZW4gZWx0IGlzbnQgaXRlbSBhbmQgY29sbGlzaW9uRnVuY3Rpb24gaXRlbSwgZWx0IHRoZW4gaXRlbXMucHVzaCBlbHRcbiAgICAgICAgICAgIGZvciBlbHQgaW4gdG9wLmNvbnRlbnRzICB3aGVuIGVsdCBpc250IGl0ZW0gYW5kIGNvbGxpc2lvbkZ1bmN0aW9uIGl0ZW0sIGVsdCB0aGVuIGl0ZW1zLnB1c2ggZWx0XG5cbiAgICAgICAgICAgIHJlbGF0ZWRDaGlsZCA9IHRvcC5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24gaXRlbSwgdG9wXVxuXG4gICAgICAgICAgICBpZiBpc092ZXJzaXplZCBpdGVtLCByZWxhdGVkQ2hpbGQuY3JlYXRlKClcbiAgICAgICAgICAgICAgICBmb3IgY2hpbGQgb2YgdG9wLmNoaWxkcmVuIHdoZW4gdG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlP1xuICAgICAgICAgICAgICAgICAgICBmaWZvLnB1c2ggdG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlXG5cbiAgICAgICAgICAgIGVsc2UgaWYgcmVsYXRlZENoaWxkLnRyZWU/XG4gICAgICAgICAgICAgICAgZmlmby5wdXNoIHJlbGF0ZWRDaGlsZC50cmVlXG5cbiAgICAgICAgaXRlbXNcblxuICAgIGdldDogKHBhcmFtcykgLT5cbiAgICAgICAgQHdoZXJlIHBhcmFtc1xuXG4gICAgd2hlcmU6IChwYXJhbXMpIC0+XG4gICAgICAgIHZhbGlkYXRlRWxlbWVudCBwYXJhbXNcblxuICAgICAgICBpdGVtcyA9IFtdXG4gICAgICAgIGZpZm8gPSBbQF1cblxuICAgICAgICB3aGlsZSBmaWZvLmxlbmd0aCA+IDBcbiAgICAgICAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdXG5cbiAgICAgICAgICAgIGZvciBlbHQgaW4gdG9wLm92ZXJzaXplZFxuICAgICAgICAgICAgICAgIGNoZWNrID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGZvciBrZXkgb2YgcGFyYW1zIHdoZW4gcGFyYW1zW2tleV0gaXNudCBlbHRba2V5XSB0aGVuIGNoZWNrID0gZmFsc2VcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoIGVsdCBpZiBjaGVja1xuICAgICAgICAgICAgZm9yIGVsdCBpbiB0b3AuY29udGVudHNcbiAgICAgICAgICAgICAgICBjaGVjayA9IHRydWVcbiAgICAgICAgICAgICAgICBmb3Iga2V5IG9mIHBhcmFtcyB3aGVuIHBhcmFtc1trZXldIGlzbnQgZWx0W2tleV0gdGhlbiBjaGVjayA9IGZhbHNlXG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCBlbHQgaWYgY2hlY2tcblxuICAgICAgICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbiBwYXJhbXMsIHRvcF1cblxuICAgICAgICAgICAgaWYgcmVsYXRlZENoaWxkLnRyZWU/XG4gICAgICAgICAgICAgICAgZmlmby5wdXNoIHJlbGF0ZWRDaGlsZC50cmVlXG5cbiAgICAgICAgaXRlbXNcblxuICAgIGVhY2g6IChhY3Rpb24pIC0+XG4gICAgICAgIGZpZm8gPSBbQF1cblxuICAgICAgICB3aGlsZSBmaWZvLmxlbmd0aCA+IDBcbiAgICAgICAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdXG4gICAgICAgICAgICBmb3IgaSBpbiB0b3Aub3ZlcnNpemVkIHRoZW4gYWN0aW9uPyhpKVxuICAgICAgICAgICAgZm9yIGkgaW4gdG9wLmNvbnRlbnRzIHRoZW4gYWN0aW9uPyhpKVxuXG4gICAgICAgICAgICBmb3IgY2hpbGQgb2YgdG9wLmNoaWxkcmVuIHdoZW4gdG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlP1xuICAgICAgICAgICAgICAgIGZpZm8ucHVzaCB0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWVcbiAgICAgICAgQFxuXG4gICAgZmluZDogKHByZWRpY2F0ZSkgLT5cbiAgICAgICAgZmlmbyA9IFtAXVxuICAgICAgICBpdGVtcyA9IFtdXG5cbiAgICAgICAgd2hpbGUgZmlmby5sZW5ndGggPiAwXG4gICAgICAgICAgICB0b3AgPSBmaWZvLnNwbGljZSgwLCAxKVswXVxuICAgICAgICAgICAgZm9yIGkgaW4gdG9wLm92ZXJzaXplZCB3aGVuIHByZWRpY2F0ZT8oaSkgdGhlbiBpdGVtcy5wdXNoIGlcbiAgICAgICAgICAgIGZvciBpIGluIHRvcC5jb250ZW50cyB3aGVuIHByZWRpY2F0ZT8oaSkgdGhlbiBpdGVtcy5wdXNoIGlcblxuICAgICAgICAgICAgZm9yIGNoaWxkIG9mIHRvcC5jaGlsZHJlbiB3aGVuIHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZT9cbiAgICAgICAgICAgICAgICBmaWZvLnB1c2ggdG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlXG4gICAgICAgIGl0ZW1zXG5cbiAgICBmaWx0ZXI6ICh2YWxpZGF0ZSkgLT5cbiAgICAgICAgZGVlcGNsb25lID0gKHRhcmdldCkgLT5cbiAgICAgICAgICAgIGNvcHljYXQgPSBuZXcgUXVhZHRyZWUgeDogdGFyZ2V0LngsIHk6IHRhcmdldC55LCB3aWR0aDogdGFyZ2V0LndpZHRoLCBoZWlnaHQ6IHRhcmdldC5oZWlnaHQsIG1heEVsZW1lbnRzOiB0YXJnZXQubWF4RWxlbWVudHNcbiAgICAgICAgICAgIGNvcHljYXQuc2l6ZSA9IDBcbiAgICAgICAgICAgIGZvciBjaGlsZCBvZiB0YXJnZXQuY2hpbGRyZW4gd2hlbiB0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWU/XG4gICAgICAgICAgICAgICAgY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSA9IGRlZXBjbG9uZSB0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWVcbiAgICAgICAgICAgICAgICBjb3B5Y2F0LnNpemUgKz0gY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZT8uc2l6ZSA/IDBcblxuICAgICAgICAgICAgZm9yIGl0ZW0gaW4gdGFyZ2V0Lm92ZXJzaXplZCB3aGVuIG5vdCB2YWxpZGF0ZT8gb3IgdmFsaWRhdGU/KGl0ZW0pXG4gICAgICAgICAgICAgICAgY29weWNhdC5vdmVyc2l6ZWQucHVzaCBpdGVtXG4gICAgICAgICAgICBmb3IgaXRlbSBpbiB0YXJnZXQuY29udGVudHMgd2hlbiBub3QgdmFsaWRhdGU/IG9yIHZhbGlkYXRlPyhpdGVtKVxuICAgICAgICAgICAgICAgIGNvcHljYXQuY29udGVudHMucHVzaCBpdGVtXG5cbiAgICAgICAgICAgIGNvcHljYXQuc2l6ZSArPSBjb3B5Y2F0Lm92ZXJzaXplZC5sZW5ndGggKyBjb3B5Y2F0LmNvbnRlbnRzLmxlbmd0aFxuICAgICAgICAgICAgaWYgY29weWNhdC5zaXplIGlzIDAgdGhlbiBudWxsIGVsc2UgY29weWNhdFxuXG4gICAgICAgIGRlZXBjbG9uZSBAXG5cbiAgICB2aXNpdDogKGFjdGlvbikgLT5cbiAgICAgICAgZmlmbyA9IFtAXVxuXG4gICAgICAgIHdoaWxlIGZpZm8ubGVuZ3RoID4gMFxuICAgICAgICAgICAgdGhhdCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdXG4gICAgICAgICAgICBhY3Rpb24uYmluZCh0aGF0KSgpXG5cbiAgICAgICAgICAgIGZvciBjaGlsZCBvZiB0aGF0LmNoaWxkcmVuIHdoZW4gdGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZT9cbiAgICAgICAgICAgICAgICBmaWZvLnB1c2ggdGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZVxuICAgICAgICBAXG5cbm1vZHVsZT8uZXhwb3J0cyA9IFF1YWR0cmVlXG4iLCJ2YXIgUXVhZHRyZWU7XG5cblF1YWR0cmVlID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgY2FsY3VsYXRlRGlyZWN0aW9uLCBnZXRDZW50ZXIsIGlzT3ZlcnNpemVkLCB2YWxpZGF0ZUVsZW1lbnQ7XG5cbiAgZnVuY3Rpb24gUXVhZHRyZWUoYXJnKSB7XG4gICAgdmFyIGNoaWxkLCB0aGF0O1xuICAgIHRoaXMueCA9IGFyZy54LCB0aGlzLnkgPSBhcmcueSwgdGhpcy53aWR0aCA9IGFyZy53aWR0aCwgdGhpcy5oZWlnaHQgPSBhcmcuaGVpZ2h0LCB0aGlzLm1heEVsZW1lbnRzID0gYXJnLm1heEVsZW1lbnRzO1xuICAgIGlmICgodGhpcy53aWR0aCA9PSBudWxsKSB8fCAodGhpcy5oZWlnaHQgPT0gbnVsbCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgcXVhZHRyZWUgZGltZW5zaW9ucy5cIik7XG4gICAgfVxuICAgIGlmICh0aGlzLnggPT0gbnVsbCkge1xuICAgICAgdGhpcy54ID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMueSA9PSBudWxsKSB7XG4gICAgICB0aGlzLnkgPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhFbGVtZW50cyA9PSBudWxsKSB7XG4gICAgICB0aGlzLm1heEVsZW1lbnRzID0gMTtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50cyA9IFtdO1xuICAgIHRoaXMub3ZlcnNpemVkID0gW107XG4gICAgdGhpcy5zaXplID0gMDtcbiAgICBpZiAodGhpcy54IDwgMCB8fCB0aGlzLnkgPCAwIHx8IHRoaXMud2lkdGggPCAxIHx8IHRoaXMuaGVpZ2h0IDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGltZW5zaW9ucyBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubWF4RWxlbWVudHMgPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbWF4aW11bSBvZiBlbGVtZW50cyBieSBsZWFmIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLlwiKTtcbiAgICB9XG4gICAgdGhhdCA9IHRoaXM7XG4gICAgdGhpcy5jaGlsZHJlbiA9IHtcbiAgICAgIFwiTldcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54LFxuICAgICAgICAgICAgeTogdGhhdC55LFxuICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIk5FXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHk6IHRoYXQueSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwodGhhdC53aWR0aCAvIDIpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQuaGVpZ2h0IC8gMiksIDEpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiU1dcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54LFxuICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5taW4oTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGguY2VpbCh0aGF0LmhlaWdodCAvIDIpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiU0VcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwodGhhdC53aWR0aCAvIDIpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwodGhhdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH1cbiAgICB9O1xuICAgIGZvciAoY2hpbGQgaW4gdGhpcy5jaGlsZHJlbikge1xuICAgICAgdGhpcy5jaGlsZHJlbltjaGlsZF0uZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50cmVlID0gdGhpcy5jcmVhdGUoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGdldENlbnRlciA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgcmVmLCByZWYxO1xuICAgIHJldHVybiB7XG4gICAgICB4OiBNYXRoLmZsb29yKCgocmVmID0gaXRlbS53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDEpIC8gMikgKyBpdGVtLngsXG4gICAgICB5OiBNYXRoLmZsb29yKCgocmVmMSA9IGl0ZW0uaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDEpIC8gMikgKyBpdGVtLnlcbiAgICB9O1xuICB9O1xuXG4gIHZhbGlkYXRlRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBpZiAoIXR5cGVvZiBlbGVtZW50ID09PSBcIm9iamVjdFwiIHx8IChlbGVtZW50LnggPT0gbnVsbCkgfHwgKGVsZW1lbnQueSA9PSBudWxsKSB8fCBlbGVtZW50LnggPCAwIHx8IGVsZW1lbnQueSA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk9iamVjdCBtdXN0IGNvbnRhaW4geCBvciB5IHBvc2l0aW9ucyBhcyBhcmd1bWVudHMsIGFuZCB0aGV5IG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIpO1xuICAgIH1cbiAgICBpZiAoKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQud2lkdGggOiB2b2lkIDApIDwgMCB8fCAoZWxlbWVudCAhPSBudWxsID8gZWxlbWVudC5oZWlnaHQgOiB2b2lkIDApIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiV2lkdGggYW5kIGhlaWdodCBhcmd1bWVudHMgbXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7XG4gICAgfVxuICB9O1xuXG4gIGNhbGN1bGF0ZURpcmVjdGlvbiA9IGZ1bmN0aW9uKGVsZW1lbnQsIHRyZWUpIHtcbiAgICBlbGVtZW50O1xuICAgIHZhciBxdWFkQ2VudGVyO1xuICAgIHF1YWRDZW50ZXIgPSBnZXRDZW50ZXIodHJlZSk7XG4gICAgaWYgKGVsZW1lbnQueCA8IHF1YWRDZW50ZXIueCkge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJOV1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU1dcIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJORVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU0VcIjtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgaXNPdmVyc2l6ZWQgPSBmdW5jdGlvbihlbGVtZW50LCB0cmVlKSB7XG4gICAgdmFyIHJlZiwgcmVmMTtcbiAgICByZXR1cm4gZWxlbWVudC54IDwgdHJlZS54IHx8IGVsZW1lbnQueCArICgocmVmID0gZWxlbWVudC53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDApID49IHRyZWUueCArIHRyZWUud2lkdGggfHwgZWxlbWVudC55IDwgdHJlZS55IHx8IGVsZW1lbnQueSArICgocmVmMSA9IGVsZW1lbnQuaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDApID49IHRyZWUueSArIHRyZWUuaGVpZ2h0O1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oaXRlbSkge1xuICAgIHZhciBjLCBlbGVtZW50LCBmaWZvLCBqLCBsZW4sIHJlZiwgcmVsYXRlZENoaWxkLCB0b3AsIHRyZWU7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGZpZm8gPSBbXG4gICAgICB7XG4gICAgICAgIHRyZWU6IHRoaXMsXG4gICAgICAgIGVsZW1lbnQ6IGl0ZW1cbiAgICAgIH1cbiAgICBdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgdHJlZSA9IHRvcC50cmVlO1xuICAgICAgZWxlbWVudCA9IHRvcC5lbGVtZW50O1xuICAgICAgdHJlZS5zaXplKys7XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0cmVlLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihlbGVtZW50LCB0cmVlKV07XG4gICAgICBpZiAodHJlZS53aWR0aCA9PT0gMSB8fCB0cmVlLmhlaWdodCA9PT0gMSB8fCBpc092ZXJzaXplZChlbGVtZW50LCByZWxhdGVkQ2hpbGQuY3JlYXRlKCkpKSB7XG4gICAgICAgIHRyZWUub3ZlcnNpemVkLnB1c2goZWxlbWVudCk7XG4gICAgICB9IGVsc2UgaWYgKHRyZWUuc2l6ZSA8PSB0cmVlLm1heEVsZW1lbnRzKSB7XG4gICAgICAgIHRyZWUuY29udGVudHMucHVzaChlbGVtZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpZm8ucHVzaCh7XG4gICAgICAgICAgdHJlZTogcmVsYXRlZENoaWxkLmdldCgpLFxuICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgfSk7XG4gICAgICAgIHJlZiA9IHRyZWUuY29udGVudHM7XG4gICAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICAgIGMgPSByZWZbal07XG4gICAgICAgICAgZmlmby5wdXNoKHtcbiAgICAgICAgICAgIHRyZWU6IHRyZWUuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGMsIHRyZWUpXS5nZXQoKSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IGNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0cmVlLmNvbnRlbnRzID0gW107XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgdmFyIGluZGV4LCByZWxhdGVkQ2hpbGQ7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGluZGV4ID0gdGhpcy5vdmVyc2l6ZWQuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5vdmVyc2l6ZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIHRoaXMuc2l6ZS0tO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGluZGV4ID0gdGhpcy5jb250ZW50cy5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLm92ZXJzaXplZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmVsYXRlZENoaWxkID0gdGhpcy5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24oaXRlbSwgdGhpcyldO1xuICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZS5yZW1vdmUoaXRlbSkpIHtcbiAgICAgIHRoaXMuc2l6ZS0tO1xuICAgICAgaWYgKHJlbGF0ZWRDaGlsZC50cmVlLnNpemUgPT09IDApIHtcbiAgICAgICAgcmVsYXRlZENoaWxkLnRyZWUgPSBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmNvbGxpZGluZyA9IGZ1bmN0aW9uKGl0ZW0sIGNvbGxpc2lvbkZ1bmN0aW9uKSB7XG4gICAgdmFyIGNoaWxkLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVsYXRlZENoaWxkLCB0b3A7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGlmIChjb2xsaXNpb25GdW5jdGlvbiA9PSBudWxsKSB7XG4gICAgICBjb2xsaXNpb25GdW5jdGlvbiA9IGZ1bmN0aW9uKGVsdDEsIGVsdDIpIHtcbiAgICAgICAgdmFyIHJlZiwgcmVmMSwgcmVmMiwgcmVmMztcbiAgICAgICAgcmV0dXJuICEoZWx0MS54ID4gZWx0Mi54ICsgKChyZWYgPSBlbHQyLndpZHRoKSAhPSBudWxsID8gcmVmIDogMCkgfHwgZWx0MS54ICsgKChyZWYxID0gZWx0MS53aWR0aCkgIT0gbnVsbCA/IHJlZjEgOiAwKSA8IGVsdDIueCB8fCBlbHQxLnkgPiBlbHQyLnkgKyAoKHJlZjIgPSBlbHQyLmhlaWdodCkgIT0gbnVsbCA/IHJlZjIgOiAwKSB8fCBlbHQxLnkgKyAoKHJlZjMgPSBlbHQxLmhlaWdodCkgIT0gbnVsbCA/IHJlZjMgOiAwKSA8IGVsdDIueSk7XG4gICAgICB9O1xuICAgIH1cbiAgICBpdGVtcyA9IFtdO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF07XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgaWYgKGVsdCAhPT0gaXRlbSAmJiBjb2xsaXNpb25GdW5jdGlvbihpdGVtLCBlbHQpKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGVsdCA9IHJlZjFba107XG4gICAgICAgIGlmIChlbHQgIT09IGl0ZW0gJiYgY29sbGlzaW9uRnVuY3Rpb24oaXRlbSwgZWx0KSkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goZWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihpdGVtLCB0b3ApXTtcbiAgICAgIGlmIChpc092ZXJzaXplZChpdGVtLCByZWxhdGVkQ2hpbGQuY3JlYXRlKCkpKSB7XG4gICAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocmVsYXRlZENoaWxkLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICBmaWZvLnB1c2gocmVsYXRlZENoaWxkLnRyZWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHBhcmFtcykge1xuICAgIHJldHVybiB0aGlzLndoZXJlKHBhcmFtcyk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLndoZXJlID0gZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgdmFyIGNoZWNrLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBrZXksIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQocGFyYW1zKTtcbiAgICBpdGVtcyA9IFtdO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF07XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICBpZiAocGFyYW1zW2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICBpZiAocGFyYW1zW2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlbGF0ZWRDaGlsZCA9IHRvcC5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24ocGFyYW1zLCB0b3ApXTtcbiAgICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZSAhPSBudWxsKSB7XG4gICAgICAgIGZpZm8ucHVzaChyZWxhdGVkQ2hpbGQudHJlZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaSwgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHRvcDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgcmVmID0gdG9wLm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpID0gcmVmW2pdO1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgYWN0aW9uKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGkgPSByZWYxW2tdO1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgYWN0aW9uKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGNoaWxkIGluIHRvcC5jaGlsZHJlbikge1xuICAgICAgICBpZiAodG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaSwgaXRlbXMsIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCB0b3A7XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICBpdGVtcyA9IFtdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgcmVmID0gdG9wLm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpID0gcmVmW2pdO1xuICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGkpIDogdm9pZCAwKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMSA9IHRvcC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpKSA6IHZvaWQgMCkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIGZpZm8ucHVzaCh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24odmFsaWRhdGUpIHtcbiAgICB2YXIgZGVlcGNsb25lO1xuICAgIGRlZXBjbG9uZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgdmFyIGNoaWxkLCBjb3B5Y2F0LCBpdGVtLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVmMiwgcmVmMztcbiAgICAgIGNvcHljYXQgPSBuZXcgUXVhZHRyZWUoe1xuICAgICAgICB4OiB0YXJnZXQueCxcbiAgICAgICAgeTogdGFyZ2V0LnksXG4gICAgICAgIHdpZHRoOiB0YXJnZXQud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGFyZ2V0LmhlaWdodCxcbiAgICAgICAgbWF4RWxlbWVudHM6IHRhcmdldC5tYXhFbGVtZW50c1xuICAgICAgfSk7XG4gICAgICBjb3B5Y2F0LnNpemUgPSAwO1xuICAgICAgZm9yIChjaGlsZCBpbiB0YXJnZXQuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKCEodGFyZ2V0LmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSA9IGRlZXBjbG9uZSh0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICBjb3B5Y2F0LnNpemUgKz0gKHJlZiA9IChyZWYxID0gY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSkgIT0gbnVsbCA/IHJlZjEuc2l6ZSA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZiA6IDA7XG4gICAgICB9XG4gICAgICByZWYyID0gdGFyZ2V0Lm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZjIubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaXRlbSA9IHJlZjJbal07XG4gICAgICAgIGlmICgodmFsaWRhdGUgPT0gbnVsbCkgfHwgKHR5cGVvZiB2YWxpZGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gdmFsaWRhdGUoaXRlbSkgOiB2b2lkIDApKSB7XG4gICAgICAgICAgY29weWNhdC5vdmVyc2l6ZWQucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMyA9IHRhcmdldC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpdGVtID0gcmVmM1trXTtcbiAgICAgICAgaWYgKCh2YWxpZGF0ZSA9PSBudWxsKSB8fCAodHlwZW9mIHZhbGlkYXRlID09PSBcImZ1bmN0aW9uXCIgPyB2YWxpZGF0ZShpdGVtKSA6IHZvaWQgMCkpIHtcbiAgICAgICAgICBjb3B5Y2F0LmNvbnRlbnRzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvcHljYXQuc2l6ZSArPSBjb3B5Y2F0Lm92ZXJzaXplZC5sZW5ndGggKyBjb3B5Y2F0LmNvbnRlbnRzLmxlbmd0aDtcbiAgICAgIGlmIChjb3B5Y2F0LnNpemUgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gY29weWNhdDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBkZWVwY2xvbmUodGhpcyk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnZpc2l0ID0gZnVuY3Rpb24oYWN0aW9uKSB7XG4gICAgdmFyIGNoaWxkLCBmaWZvLCB0aGF0O1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdGhhdCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgYWN0aW9uLmJpbmQodGhhdCkoKTtcbiAgICAgIGZvciAoY2hpbGQgaW4gdGhhdC5jaGlsZHJlbikge1xuICAgICAgICBpZiAodGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRoYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIHJldHVybiBRdWFkdHJlZTtcblxufSkoKTtcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gUXVhZHRyZWU7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=