var Quadtree;Quadtree=function(){function e(t){var n,i;if(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.maxElements=t.maxElements,null==this.width||null==this.height)throw new Error("Missing quadtree dimensions.");if(null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.maxElements&&(this.maxElements=1),this.contents=[],this.oversized=[],this.size=0,this.x<0||this.y<0||this.width<1||this.height<1)throw new Error("Dimensions and coordinates must be positive integers.");if(this.maxElements<1)throw new Error("The maximum number of elements before a split must be a positive integer.");i=this,this.children={NW:{create:function(){return new e({x:i.x,y:i.y,width:Math.max(Math.floor(i.width/2),1),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},NE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y,width:Math.ceil(i.width/2),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},SW:{create:function(){return new e({x:i.x,y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.max(Math.floor(i.width/2),1),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null},SE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.ceil(i.width/2),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null}};for(n in this.children)this.children[n].get=function(){return null!=this.tree?this.tree:(this.tree=this.create(),this.tree)}}var t,n,i,r,h;return n=function(e){var t,n;return{x:Math.floor((null!=(t=e.width)?t:1)/2)+e.x,y:Math.floor((null!=(n=e.height)?n:1)/2)+e.y}},h=function(e){if(null==e.x||null==e.y||e.x<0||e.y<0)throw new Error("Object must contain x or y positions as arguments, and they must be positive integers.");if((null!=e?e.width:void 0)<0||(null!=e?e.height:void 0)<0)throw new Error("Width and height must be positive integers.")},t=function(e,t){var i;return i=n(t),e.x<i.x?e.y<i.y?"NW":"SW":e.y<i.y?"NE":"SE"},i=function(e,t){var n,i;return e.x<t.x||e.x+(null!=(n=e.width)?n:0)>=t.x+t.width||e.y<t.y||e.y+(null!=(i=e.height)?i:0)>=t.y+t.height},r=function(e,t){var n;return n=function(n){return e["_"+n]=e[n],Object.defineProperty(e,n,{set:function(e){return t.remove(this),this["_"+n]=e,t.push(this)},get:function(){return this["_"+n]},configurable:!0})},n("x"),n("y"),n("width"),n("height")},e.prototype.push=function(e,n){var l,o,s,u,c,f,d,a,p;for(h(e),n&&r(e,this),s=[{tree:this,element:e}];s.length>0;)if(a=s.splice(0,1)[0],p=a.tree,o=a.element,p.size++,d=p.children[t(o,p)],1===p.width||1===p.height||i(o,d.create()))p.oversized.push(o);else if(p.size<=p.maxElements)p.contents.push(o);else{for(s.push({tree:d.get(),element:o}),f=p.contents,u=0,c=f.length;u<c;u++)l=f[u],s.push({tree:p.children[t(l,p)].get(),element:l});p.contents=[]}return this},e.prototype.remove=function(e){var n,i;return h(e),n=this.oversized.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(n=this.contents.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(i=this.children[t(e,this)],null!=i.tree&&(!!i.tree.remove(e)&&(this.size--,0===i.tree.size&&(i.tree=null),!0))))},e.prototype.colliding=function(e,n){var r,l,o,s,u,c,f,d,a,p,m,x;for(h(e),null==n&&(n=function(e,t){var n,i,r,h;return!(e.x>t.x+(null!=(n=t.width)?n:0)||e.x+(null!=(i=e.width)?i:0)<t.x||e.y>t.y+(null!=(r=t.height)?r:0)||e.y+(null!=(h=e.height)?h:0)<t.y)}),s=[],o=[this];o.length>0;){for(x=o.splice(0,1)[0],a=x.oversized,u=0,f=a.length;u<f;u++)l=a[u],l!==e&&n(e,l)&&s.push(l);for(p=x.contents,c=0,d=p.length;c<d;c++)l=p[c],l!==e&&n(e,l)&&s.push(l);if(m=x.children[t(e,x)],i(e,m.create()))for(r in x.children)null!=x.children[r].tree&&o.push(x.children[r].tree);else null!=m.tree&&o.push(m.tree)}return s},e.prototype.get=function(e){return this.where(e)},e.prototype.where=function(e){var n,i,r,l,o,s,u,c,f,d,a,p,m;if("object"==typeof e&&null==e.x&&null==e.y)return this.find(function(t){var n,i;n=!0;for(i in e)e[i]!==t[i]&&(n=!1);return n});for(h(e),l=[],r=[this];r.length>0;){for(m=r.splice(0,1)[0],d=m.oversized,o=0,c=d.length;o<c;o++){i=d[o],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}for(a=m.contents,s=0,f=a.length;s<f;s++){i=a[s],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}p=m.children[t(e,m)],null!=p.tree&&r.push(p.tree)}return l},e.prototype.each=function(e){var t,n,i,r,h,l,o,s,u,c;for(n=[this];n.length>0;){for(c=n.splice(0,1)[0],s=c.oversized,r=0,l=s.length;r<l;r++)i=s[r],"function"==typeof e&&e(i);for(u=c.contents,h=0,o=u.length;h<o;h++)i=u[h],"function"==typeof e&&e(i);for(t in c.children)null!=c.children[t].tree&&n.push(c.children[t].tree)}return this},e.prototype.find=function(e){var t,n,i,r,h,l,o,s,u,c,f;for(n=[this],r=[];n.length>0;){for(f=n.splice(0,1)[0],u=f.oversized,h=0,o=u.length;h<o;h++)i=u[h],("function"==typeof e?e(i):void 0)&&r.push(i);for(c=f.contents,l=0,s=c.length;l<s;l++)i=c[l],("function"==typeof e?e(i):void 0)&&r.push(i);for(t in f.children)null!=f.children[t].tree&&n.push(f.children[t].tree)}return r},e.prototype.filter=function(t){var n;return(n=function(i){var r,h,l,o,s,u,c,f,d,a,p;h=new e({x:i.x,y:i.y,width:i.width,height:i.height,maxElements:i.maxElements}),h.size=0;for(r in i.children)null!=i.children[r].tree&&(h.children[r].tree=n(i.children[r].tree),h.size+=null!=(f=null!=(d=h.children[r].tree)?d.size:void 0)?f:0);for(a=i.oversized,o=0,u=a.length;o<u;o++)l=a[o],(null==t||("function"==typeof t?t(l):void 0))&&h.oversized.push(l);for(p=i.contents,s=0,c=p.length;s<c;s++)l=p[s],(null==t||("function"==typeof t?t(l):void 0))&&h.contents.push(l);return h.size+=h.oversized.length+h.contents.length,0===h.size?null:h})(this)},e.prototype.reject=function(e){return this.filter(function(t){return!("function"==typeof e?e(t):void 0)})},e.prototype.visit=function(e){var t,n,i;for(n=[this];n.length>0;){i=n.splice(0,1)[0],e.bind(i)();for(t in i.children)null!=i.children[t].tree&&n.push(i.children[t].tree)}return this},e}(),"undefined"!=typeof module&&null!==module&&(module.exports=Quadtree);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1YWR0cmVlLmNvZmZlZSIsInF1YWR0cmVlLmpzIl0sIm5hbWVzIjpbIlF1YWR0cmVlIiwiYXJnIiwiY2hpbGQiLCJ0aGF0IiwidGhpcyIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXhFbGVtZW50cyIsIkVycm9yIiwiY29udGVudHMiLCJvdmVyc2l6ZWQiLCJzaXplIiwiY2hpbGRyZW4iLCJOVyIsImNyZWF0ZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsInRyZWUiLCJORSIsImNlaWwiLCJTVyIsIlNFIiwiZ2V0IiwiY2FsY3VsYXRlRGlyZWN0aW9uIiwiZ2V0Q2VudGVyIiwiaXNPdmVyc2l6ZWQiLCJvYnNlcnZlIiwidmFsaWRhdGVFbGVtZW50IiwiaXRlbSIsInJlZiIsInJlZjEiLCJlbGVtZW50IiwicXVhZENlbnRlciIsIndyaXRlQWNjZXNzb3JzIiwicHJvcE5hbWUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInNldCIsInZhbCIsInJlbW92ZSIsInB1c2giLCJjb25maWd1cmFibGUiLCJwcm90b3R5cGUiLCJkb09ic2VydmUiLCJjIiwiZmlmbyIsImoiLCJsZW4iLCJyZWxhdGVkQ2hpbGQiLCJ0b3AiLCJsZW5ndGgiLCJzcGxpY2UiLCJpbmRleCIsImluZGV4T2YiLCJjb2xsaWRpbmciLCJjb2xsaXNpb25GdW5jdGlvbiIsImVsdCIsIml0ZW1zIiwiayIsImxlbjEiLCJlbHQxIiwiZWx0MiIsInJlZjIiLCJyZWYzIiwicXVlcnkiLCJ3aGVyZSIsImNoZWNrIiwia2V5IiwiZmluZCIsImVhY2giLCJhY3Rpb24iLCJpIiwicHJlZGljYXRlIiwiZmlsdGVyIiwiZGVlcGNsb25lIiwidGFyZ2V0IiwiY29weWNhdCIsInJlamVjdCIsInZpc2l0IiwiYmluZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVNBLEdBQUFBLFNBQU1BLFVBQUEsV0FPVyxRQUFBQSxHQUFDQyxHQUdWLEdBQUFDLEdBQUFDLENBQUEsSUFIV0MsS0FBQ0MsRUFBQUosRUFBQUksRUFBR0QsS0FBQ0UsRUFBQUwsRUFBQUssRUFBR0YsS0FBQ0csTUFBQU4sRUFBQU0sTUFBT0gsS0FBQ0ksT0FBQVAsRUFBQU8sT0FBUUosS0FBQ0ssWUFBQVIsRUFBQVEsWUFHaUIsTUFBQUwsS0FBQUcsT0FBZSxNQUFBSCxLQUFBSSxPQUFyRSxLQUFNLElBQUlFLE9BQU0sK0JBU2hCLElDakJVLE1BQVZOLEtBQUtDLElEU0xELEtBQUNDLEVBQUssR0NOSSxNQUFWRCxLQUFLRSxJRE9MRixLQUFDRSxFQUFLLEdDSmMsTUFBcEJGLEtBQUtLLGNES0xMLEtBQUNLLFlBQWUsR0FDaEJMLEtBQUNPLFlBQ0RQLEtBQUNRLGFBQ0RSLEtBQUNTLEtBQU8sRUFHbUVULEtBQUNDLEVBQUksR0FBS0QsS0FBQ0UsRUFBSSxHQUFLRixLQUFDRyxNQUFRLEdBQUtILEtBQUNJLE9BQVMsRUFBdkgsS0FBTSxJQUFJRSxPQUFNLHdEQUNoQixJQUErRk4sS0FBQ0ssWUFBYyxFQUE5RyxLQUFNLElBQUlDLE9BQU0sNEVBRWhCUCxHQUFPQyxLQUdQQSxLQUFDVSxVQUVHQyxJQUNJQyxPQUFRLFdDSmQsTURLVSxJQUFJaEIsSUFDQUssRUFBR0YsRUFBS0UsRUFDUkMsRUFBR0gsRUFBS0csRUFDUkMsTUFBT1UsS0FBS0MsSUFBS0QsS0FBS0UsTUFBTWhCLEVBQUtJLE1BQVEsR0FBSSxHQUM3Q0MsT0FBUVMsS0FBS0MsSUFBS0QsS0FBS0UsTUFBTWhCLEVBQUtLLE9BQVMsR0FBSSxHQUMvQ0MsWUFBYU4sRUFBS00sZUFFMUJXLEtBQU0sTUFFVkMsSUFDSUwsT0FBUSxXQ0hkLE1ESVUsSUFBSWhCLElBQ0FLLEVBQUdGLEVBQUtFLEVBQUlZLEtBQUtDLElBQUtELEtBQUtFLE1BQU1oQixFQUFLSSxNQUFRLEdBQUksR0FDbERELEVBQUdILEVBQUtHLEVBQ1JDLE1BQU9VLEtBQUtLLEtBQUtuQixFQUFLSSxNQUFRLEdBQzlCQyxPQUFRUyxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ssT0FBUyxHQUFJLEdBQy9DQyxZQUFhTixFQUFLTSxlQUUxQlcsS0FBTSxNQUVWRyxJQUNJUCxPQUFRLFdDRmQsTURHVSxJQUFJaEIsSUFDQUssRUFBR0YsRUFBS0UsRUFDUkMsRUFBR0gsRUFBS0csRUFBSVcsS0FBS0MsSUFBS0QsS0FBS0UsTUFBTWhCLEVBQUtLLE9BQVMsR0FBSSxHQUNuREQsTUFBT1UsS0FBS0MsSUFBS0QsS0FBS0UsTUFBTWhCLEVBQUtJLE1BQVEsR0FBSSxHQUM3Q0MsT0FBUVMsS0FBS0ssS0FBS25CLEVBQUtLLE9BQVMsR0FDaENDLFlBQWFOLEVBQUtNLGVBRTFCVyxLQUFNLE1BRVZJLElBQ0lSLE9BQVEsV0NEZCxNREVVLElBQUloQixJQUNBSyxFQUFHRixFQUFLRSxFQUFJWSxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ksTUFBUSxHQUFJLEdBQ2xERCxFQUFHSCxFQUFLRyxFQUFJVyxLQUFLQyxJQUFLRCxLQUFLRSxNQUFNaEIsRUFBS0ssT0FBUyxHQUFJLEdBQ25ERCxNQUFPVSxLQUFLSyxLQUFLbkIsRUFBS0ksTUFBUSxHQUM5QkMsT0FBUVMsS0FBS0ssS0FBS25CLEVBQUtLLE9BQVMsR0FDaENDLFlBQWFOLEVBQUtNLGVBRTFCVyxLQUFNLE1BR2QsS0FBQWxCLElBQUFFLE1BQUFVLFNBQ0lWLEtBQUNVLFNBQVNaLEdBQU91QixJQUFNLFdBQ25CLE1BQUcsT0FBQXJCLEtBQUFnQixLQUFZaEIsS0FBQ2dCLE1BQVVoQixLQUFDZ0IsS0FBT2hCLEtBQUNZLFNBQVVaLEtBQUNnQixPQW5FMUQsR0FBQU0sR0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsQ0M2YUYsT0RyV0VILEdBQVksU0FBQ0ksR0FDVCxHQUFBQyxHQUFBQyxDQ0tKLFFETEk1QixFQUFHWSxLQUFLRSxPQUFNLE9BQUFhLEVBQUFELEVBQUF4QixPQUFBeUIsRUFBZSxHQUFLLEdBQUtELEVBQUsxQixFQUM1Q0MsRUFBR1csS0FBS0UsT0FBTSxPQUFBYyxFQUFBRixFQUFBdkIsUUFBQXlCLEVBQWUsR0FBSyxHQUFLRixFQUFLekIsSUFHaER3QixFQUFrQixTQUFDSSxHQUNmLEdBQXlDLE1BQUFBLEVBQUE3QixHQUFrQixNQUFBNkIsRUFBQTVCLEdBQWM0QixFQUFRN0IsRUFBSSxHQUFLNkIsRUFBUTVCLEVBQUksRUFDbEcsS0FBTSxJQUFJSSxPQUFNLHlGQUNwQixLQUFBLE1BQUF3QixFQUFHQSxFQUFTM0IsTUFBQSxRQUFRLElBQWpCLE1BQUEyQixFQUFzQkEsRUFBUzFCLE9BQUEsUUFBUyxFQUN2QyxLQUFNLElBQUlFLE9BQU0sZ0RBR3hCZ0IsRUFBcUIsU0FBQ1EsRUFBU2QsR0FDM0IsR0FBQWUsRUFHQSxPQUZBQSxHQUFhUixFQUFVUCxHQUVwQmMsRUFBUTdCLEVBQUk4QixFQUFXOUIsRUFDbkI2QixFQUFRNUIsRUFBSTZCLEVBQVc3QixFQUFPLEtBQzVCLEtBRUY0QixFQUFRNUIsRUFBSTZCLEVBQVc3QixFQUFPLEtBQzVCLE1BSWJzQixFQUFjLFNBQUNNLEVBQVNkLEdBQ3BCLEdBQUFZLEdBQUFDLENDZ0JKLE9EaEJJQyxHQUFRN0IsRUFBSWUsRUFBS2YsR0FDakI2QixFQUFRN0IsR0FBSSxPQUFBMkIsRUFBQUUsRUFBQTNCLE9BQUF5QixFQUFpQixJQUFNWixFQUFLZixFQUFJZSxFQUFLYixPQUNqRDJCLEVBQVE1QixFQUFJYyxFQUFLZCxHQUNqQjRCLEVBQVE1QixHQUFJLE9BQUEyQixFQUFBQyxFQUFBMUIsUUFBQXlCLEVBQWtCLElBQU1iLEVBQUtkLEVBQUljLEVBQUtaLFFBR3REcUIsRUFBVSxTQUFDRSxFQUFNWCxHQUNiLEdBQUFnQixFQytCSixPRC9CSUEsR0FBaUIsU0FBQ0MsR0NnQnBCLE1EZk1OLEdBQUssSUFBSU0sR0FBY04sRUFBS00sR0FDNUJDLE9BQU9DLGVBQWVSLEVBQU1NLEdBQ3hCRyxJQUFLLFNBQUNDLEdDaUJaLE1EaEJVckIsR0FBS3NCLE9BQU90QyxNQUNaQSxLQUFFLElBQUlpQyxHQUFjSSxFQUNwQnJCLEVBQUt1QixLQUFLdkMsT0FDZHFCLElBQUssV0NnQlgsTURmVXJCLE1BQUUsSUFBSWlDLElBQ1ZPLGNBQWMsS0FFdEJSLEVBQWUsS0FDZkEsRUFBZSxLQUNmQSxFQUFlLFNBQ2ZBLEVBQWUsV0NvQnJCcEMsRUFBUzZDLFVEZFBGLEtBQU0sU0FBQ1osRUFBTWUsR0FDVCxHQUFBQyxHQUFBYixFQUFBYyxFQUFBQyxFQUFBQyxFQUFBbEIsRUFBQW1CLEVBQUFDLEVBQUFoQyxDQUtBLEtBTEFVLEVBQWdCQyxHQUNHZSxHQUFuQmpCLEVBQVFFLEVBQU0zQixNQUVkNEMsSUFBUTVCLEtBQU1oQixLQUFHOEIsUUFBU0gsSUFFcEJpQixFQUFLSyxPQUFTLEdBU2hCLEdBUkFELEVBQU1KLEVBQUtNLE9BQU8sRUFBRyxHQUFHLEdBQ3hCbEMsRUFBT2dDLEVBQUloQyxLQUNYYyxFQUFVa0IsRUFBSWxCLFFBRWRkLEVBQUtQLE9BRUxzQyxFQUFlL0IsRUFBS04sU0FBU1ksRUFBbUJRLEVBQVNkLElBRXhDLElBQWRBLEVBQUtiLE9BQTZCLElBQWZhLEVBQUtaLFFBQWVvQixFQUFZTSxFQUFTaUIsRUFBYW5DLFVBQ3hFSSxFQUFLUixVQUFVK0IsS0FBS1QsT0FFbkIsSUFBR2QsRUFBS1AsTUFBUU8sRUFBS1gsWUFDdEJXLEVBQUtULFNBQVNnQyxLQUFLVCxPQURsQixDQU1ELElBRkFjLEVBQUtMLE1BQUt2QixLQUFNK0IsRUFBYTFCLE1BQU9TLFFBQVNBLElBRTdDRixFQUFBWixFQUFBVCxTQUFBc0MsRUFBQSxFQUFBQyxFQUFBbEIsRUFBQXFCLE9BQUFKLEVBQUFDLEVBQUFELElDbUJORixFQUFJZixFQUFJaUIsR0RsQkVELEVBQUtMLE1BQUt2QixLQUFNQSxFQUFLTixTQUFTWSxFQUFtQnFCLEVBQUczQixJQUFNSyxNQUFPUyxRQUFTYSxHQUU5RTNCLEdBQUtULFlDeUJqQixNRHhCSVAsT0MyQk5KLEVBQVM2QyxVRHhCUEgsT0FBUSxTQUFDWCxHQUNMLEdBQUF3QixHQUFBSixDQUdBLE9BSEFyQixHQUFnQkMsR0FFaEJ3QixFQUFRbkQsS0FBQ1EsVUFBVTRDLFFBQVF6QixHQUN4QndCLE1BQ0NuRCxLQUFDUSxVQUFVMEMsT0FBT0MsRUFBTyxHQUN6Qm5ELEtBQUNTLFFBQ00sSUFDWDBDLEVBQVFuRCxLQUFDTyxTQUFTNkMsUUFBUXpCLEdBQ3ZCd0IsTUFDQ25ELEtBQUNRLFVBQVUwQyxPQUFPQyxFQUFPLEdBQ3pCbkQsS0FBQ1MsUUFDTSxJQUVYc0MsRUFBZS9DLEtBQUNVLFNBQVNZLEVBQW1CSyxFQUFNM0IsT0FDM0MsTUFBQStDLEVBQUEvQixTQUdKK0IsRUFBYS9CLEtBQUtzQixPQUFPWCxLQUN4QjNCLEtBQUNTLE9BQ3FELElBQTFCc0MsRUFBYS9CLEtBQUtQLE9BQTlDc0MsRUFBYS9CLEtBQU8sT0FDcEIsT0NpQ1ZwQixFQUFTNkMsVURuQlBZLFVBQVcsU0FBQzFCLEVBQU0yQixHQUNkLEdBQUF4RCxHQUFBeUQsRUFBQVgsRUFBQVksRUFBQVgsRUFBQVksRUFBQVgsRUFBQVksRUFBQTlCLEVBQUFDLEVBQUFrQixFQUFBQyxDQVlBLEtBWkF0QixFQUFnQkMsR0FFVCxNQUFBMkIsSUFDSEEsRUFBb0IsU0FBQ0ssRUFBTUMsR0FDdkIsR0FBQWhDLEdBQUFDLEVBQUFnQyxFQUFBQyxDQ29CUixTRHBCWUgsRUFBSzFELEVBQUkyRCxFQUFLM0QsR0FBSSxPQUFBMkIsRUFBQWdDLEVBQUF6RCxPQUFBeUIsRUFBYyxJQUNoQytCLEVBQUsxRCxHQUFJLE9BQUE0QixFQUFBOEIsRUFBQXhELE9BQUEwQixFQUFjLEdBQUsrQixFQUFLM0QsR0FDakMwRCxFQUFLekQsRUFBSTBELEVBQUsxRCxHQUFJLE9BQUEyRCxFQUFBRCxFQUFBeEQsUUFBQXlELEVBQWUsSUFDakNGLEVBQUt6RCxHQUFJLE9BQUE0RCxFQUFBSCxFQUFBdkQsUUFBQTBELEVBQWUsR0FBS0YsRUFBSzFELEtBRTlDc0QsS0FDQVosR0FBUzVDLE1BRUg0QyxFQUFLSyxPQUFTLEdBQXBCLENBR0ksSUFGQUQsRUFBTUosRUFBS00sT0FBTyxFQUFHLEdBQUcsR0FFeEJ0QixFQUFBb0IsRUFBQXhDLFVBQUFxQyxFQUFBLEVBQUFDLEVBQUFsQixFQUFBcUIsT0FBQUosRUFBQUMsRUFBQUQsSUNrQkpVLEVBQU0zQixFQUFJaUIsR0RsQndCVSxJQUFTNUIsR0FBUzJCLEVBQWtCM0IsRUFBTTRCLElBQVNDLEVBQU1qQixLQUFLZ0IsRUFDNUYsS0FBQTFCLEVBQUFtQixFQUFBekMsU0FBQWtELEVBQUEsRUFBQUMsRUFBQTdCLEVBQUFvQixPQUFBUSxFQUFBQyxFQUFBRCxJQ3dCSkYsRUFBTTFCLEVBQUs0QixHRHhCdUJGLElBQVM1QixHQUFTMkIsRUFBa0IzQixFQUFNNEIsSUFBU0MsRUFBTWpCLEtBQUtnQixFQUk1RixJQUZBUixFQUFlQyxFQUFJdEMsU0FBU1ksRUFBbUJLLEVBQU1xQixJQUVsRHhCLEVBQVlHLEVBQU1vQixFQUFhbkMsVUFDOUIsSUFBQWQsSUFBQWtELEdBQUF0QyxTQUErQixNQUFBc0MsRUFBQXRDLFNBQUFaLEdBQUFrQixNQUMzQjRCLEVBQUtMLEtBQUtTLEVBQUl0QyxTQUFTWixHQUFPa0IsVUFFOUIsT0FBQStCLEVBQUEvQixNQUNKNEIsRUFBS0wsS0FBS1EsRUFBYS9CLE1DK0JuQyxNRDdCSXdDLElDZ0NONUQsRUFBUzZDLFVEN0JQcEIsSUFBSyxTQUFDMEMsR0M4Qk4sTUQ3QkkvRCxNQUFDZ0UsTUFBTUQsSUNnQ2JuRSxFQUFTNkMsVUQ5QlB1QixNQUFPLFNBQUNELEdBRUosR0FBQUUsR0FBQVYsRUFBQVgsRUFBQVksRUFBQVgsRUFBQVksRUFBQVMsRUFBQXBCLEVBQUFZLEVBQUE5QixFQUFBQyxFQUFBa0IsRUFBQUMsQ0FBQSxJQUFtQixnQkFBVGUsSUFBMEIsTUFBQUEsRUFBQTlELEdBQWlCLE1BQUE4RCxFQUFBN0QsRUFDakQsTUFBT0YsTUFBQ21FLEtBQUssU0FBQ1osR0FDVixHQUFBVSxHQUFBQyxDQUFBRCxJQUFRLENBQ1IsS0FBQUMsSUFBQUgsR0FBc0JBLEVBQU1HLEtBQVVYLEVBQUlXLEtBQVVELEdBQVEsRUNvQ3BFLE9EbkNRQSxJQVFSLEtBTEF2QyxFQUFnQnFDLEdBRWhCUCxLQUNBWixHQUFRNUMsTUFFRjRDLEVBQUtLLE9BQVMsR0FBcEIsQ0FHSSxJQUZBRCxFQUFNSixFQUFLTSxPQUFPLEVBQUcsR0FBRyxHQUV4QnRCLEVBQUFvQixFQUFBeEMsVUFBQXFDLEVBQUEsRUFBQUMsRUFBQWxCLEVBQUFxQixPQUFBSixFQUFBQyxFQUFBRCxJQUFBLENDa0NKVSxFQUFNM0IsRUFBSWlCLEdEakNGb0IsR0FBUSxDQUNSLEtBQUFDLElBQUFILEdBQXNCQSxFQUFNRyxLQUFVWCxFQUFJVyxLQUFVRCxHQUFRLEVBQzFDQSxJQUFsQlQsRUFBTWpCLEtBQUtnQixHQUNmLElBQUExQixFQUFBbUIsRUFBQXpDLFNBQUFrRCxFQUFBLEVBQUFDLEVBQUE3QixFQUFBb0IsT0FBQVEsRUFBQUMsRUFBQUQsSUFBQSxDQzJDSkYsRUFBTTFCLEVBQUs0QixHRDFDSFEsR0FBUSxDQUNSLEtBQUFDLElBQUFILEdBQXNCQSxFQUFNRyxLQUFVWCxFQUFJVyxLQUFVRCxHQUFRLEVBQzFDQSxJQUFsQlQsRUFBTWpCLEtBQUtnQixHQUVmUixFQUFlQyxFQUFJdEMsU0FBU1ksRUFBbUJ5QyxFQUFPZixJQUVuRCxNQUFBRCxFQUFBL0IsTUFDQzRCLEVBQUtMLEtBQUtRLEVBQWEvQixNQ21EbkMsTURqREl3QyxJQ29ETjVELEVBQVM2QyxVRDlDUDJCLEtBQU0sU0FBQ0MsR0FDSCxHQUFBdkUsR0FBQThDLEVBQUEwQixFQUFBekIsRUFBQVksRUFBQVgsRUFBQVksRUFBQTlCLEVBQUFDLEVBQUFtQixDQUVBLEtBRkFKLEdBQVE1QyxNQUVGNEMsRUFBS0ssT0FBUyxHQUFwQixDQUVJLElBREFELEVBQU1KLEVBQUtNLE9BQU8sRUFBRyxHQUFHLEdBQ3hCdEIsRUFBQW9CLEVBQUF4QyxVQUFBcUMsRUFBQSxFQUFBQyxFQUFBbEIsRUFBQXFCLE9BQUFKLEVBQUFDLEVBQUFELElDZ0RKeUIsRUFBSTFDLEVBQUlpQixHQUNjLGtCQUFYd0IsSURqRHFCQSxFQUFRQyxFQUNwQyxLQUFBekMsRUFBQW1CLEVBQUF6QyxTQUFBa0QsRUFBQSxFQUFBQyxFQUFBN0IsRUFBQW9CLE9BQUFRLEVBQUFDLEVBQUFELElDc0RKYSxFQUFJekMsRUFBSzRCLEdBQ2Esa0JBQVhZLElEdkRvQkEsRUFBUUMsRUFFbkMsS0FBQXhFLElBQUFrRCxHQUFBdEMsU0FBK0IsTUFBQXNDLEVBQUF0QyxTQUFBWixHQUFBa0IsTUFDM0I0QixFQUFLTCxLQUFLUyxFQUFJdEMsU0FBU1osR0FBT2tCLE1DOEQxQyxNRDdESWhCLE9DZ0VOSixFQUFTNkMsVUQ3RFAwQixLQUFNLFNBQUNJLEdBQ0gsR0FBQXpFLEdBQUE4QyxFQUFBMEIsRUFBQWQsRUFBQVgsRUFBQVksRUFBQVgsRUFBQVksRUFBQTlCLEVBQUFDLEVBQUFtQixDQUdBLEtBSEFKLEdBQVE1QyxNQUNSd0QsS0FFTVosRUFBS0ssT0FBUyxHQUFwQixDQUVJLElBREFELEVBQU1KLEVBQUtNLE9BQU8sRUFBRyxHQUFHLEdBQ3hCdEIsRUFBQW9CLEVBQUF4QyxVQUFBcUMsRUFBQSxFQUFBQyxFQUFBbEIsRUFBQXFCLE9BQUFKLEVBQUFDLEVBQUFELElDK0RKeUIsRUFBSTFDLEVBQUlpQixJQUNpQixrQkFBZDBCLEdEaEVxQkEsRUFBV0QsR0FBQSxTQUFRZCxFQUFNakIsS0FBSytCLEVBQzFELEtBQUF6QyxFQUFBbUIsRUFBQXpDLFNBQUFrRCxFQUFBLEVBQUFDLEVBQUE3QixFQUFBb0IsT0FBQVEsRUFBQUMsRUFBQUQsSUNxRUphLEVBQUl6QyxFQUFLNEIsSUFDZ0Isa0JBQWRjLEdEdEVvQkEsRUFBV0QsR0FBQSxTQUFRZCxFQUFNakIsS0FBSytCLEVBRXpELEtBQUF4RSxJQUFBa0QsR0FBQXRDLFNBQStCLE1BQUFzQyxFQUFBdEMsU0FBQVosR0FBQWtCLE1BQzNCNEIsRUFBS0wsS0FBS1MsRUFBSXRDLFNBQVNaLEdBQU9rQixNQzZFMUMsTUQ1RUl3QyxJQytFTjVELEVBQVM2QyxVRDVFUCtCLE9BQVEsU0FBQ0QsR0FDTCxHQUFBRSxFQ21ISixRRG5ISUEsRUFBWSxTQUFDQyxHQUNULEdBQUE1RSxHQUFBNkUsRUFBQWhELEVBQUFrQixFQUFBWSxFQUFBWCxFQUFBWSxFQUFBOUIsRUFBQUMsRUFBQWdDLEVBQUFDLENBQUFhLEdBQVUsR0FBSS9FLElBQVNLLEVBQUd5RSxFQUFPekUsRUFBR0MsRUFBR3dFLEVBQU94RSxFQUFHQyxNQUFPdUUsRUFBT3ZFLE1BQU9DLE9BQVFzRSxFQUFPdEUsT0FBUUMsWUFBYXFFLEVBQU9yRSxjQUNqSHNFLEVBQVFsRSxLQUFPLENBQ2YsS0FBQVgsSUFBQTRFLEdBQUFoRSxTQUFrQyxNQUFBZ0UsRUFBQWhFLFNBQUFaLEdBQUFrQixPQUM5QjJELEVBQVFqRSxTQUFTWixHQUFPa0IsS0FBT3lELEVBQVVDLEVBQU9oRSxTQUFTWixHQUFPa0IsTUFDaEUyRCxFQUFRbEUsTUFBUixPQUFBbUIsRUFBQSxPQUFBQyxFQUFBOEMsRUFBQWpFLFNBQUFaLEdBQUFrQixNQUFBYSxFQUFBcEIsS0FBQSxRQUFBbUIsRUFBcUQsRUFFekQsS0FBQWlDLEVBQUFhLEVBQUFsRSxVQUFBcUMsRUFBQSxFQUFBQyxFQUFBZSxFQUFBWixPQUFBSixFQUFBQyxFQUFBRCxJQ3lGSmxCLEVBQU9rQyxFQUFLaEIsSUR6RjhCLE1BQUEwQixJQUFKLGtCQUFBQSxHQUFrQkEsRUFBVzVDLEdBQUEsVUFDM0RnRCxFQUFRbkUsVUFBVStCLEtBQUtaLEVBQzNCLEtBQUFtQyxFQUFBWSxFQUFBbkUsU0FBQWtELEVBQUEsRUFBQUMsRUFBQUksRUFBQWIsT0FBQVEsRUFBQUMsRUFBQUQsSUM4Rko5QixFQUFPbUMsRUFBS0wsSUQ5RjZCLE1BQUFjLElBQUosa0JBQUFBLEdBQWtCQSxFQUFXNUMsR0FBQSxVQUMxRGdELEVBQVFwRSxTQUFTZ0MsS0FBS1osRUFHMUIsT0FEQWdELEdBQVFsRSxNQUFRa0UsRUFBUW5FLFVBQVV5QyxPQUFTMEIsRUFBUXBFLFNBQVMwQyxPQUN6QyxJQUFoQjBCLEVBQVFsRSxLQUFlLEtBQVVrRSxJQUU5QjNFLE9DdUdoQkosRUFBUzZDLFVEcEdQbUMsT0FBUSxTQUFDTCxHQ3FHVCxNRHBHSXZFLE1BQUN3RSxPQUFPLFNBQUNGLEdDcUdYLFFEcEdNLGtCQUFBQyxHQUFJQSxFQUFXRCxHQUFBLFdDd0d6QjFFLEVBQVM2QyxVRHBHUG9DLE1BQU8sU0FBQ1IsR0FDSixHQUFBdkUsR0FBQThDLEVBQUE3QyxDQUVBLEtBRkE2QyxHQUFRNUMsTUFFRjRDLEVBQUtLLE9BQVMsR0FBcEIsQ0FDSWxELEVBQU82QyxFQUFLTSxPQUFPLEVBQUcsR0FBRyxHQUN6Qm1CLEVBQU9TLEtBQUsvRSxJQUVaLEtBQUFELElBQUFDLEdBQUFXLFNBQWdDLE1BQUFYLEVBQUFXLFNBQUFaLEdBQUFrQixNQUM1QjRCLEVBQUtMLEtBQUt4QyxFQUFLVyxTQUFTWixHQUFPa0IsTUN3RzNDLE1EdkdJaEIsT0MwR0NKLEtBSWEsbUJBQVhtRixTQUFxQyxPQUFYQSxTRDNHckNBLE9BQVFDLFFBQVVwRiIsImZpbGUiOiJxdWFkdHJlZS5qcyIsInNvdXJjZXNDb250ZW50IjpbbnVsbCwidmFyIFF1YWR0cmVlO1xuXG5RdWFkdHJlZSA9IChmdW5jdGlvbigpIHtcbiAgdmFyIGNhbGN1bGF0ZURpcmVjdGlvbiwgZ2V0Q2VudGVyLCBpc092ZXJzaXplZCwgb2JzZXJ2ZSwgdmFsaWRhdGVFbGVtZW50O1xuXG4gIGZ1bmN0aW9uIFF1YWR0cmVlKGFyZykge1xuICAgIHZhciBjaGlsZCwgdGhhdDtcbiAgICB0aGlzLnggPSBhcmcueCwgdGhpcy55ID0gYXJnLnksIHRoaXMud2lkdGggPSBhcmcud2lkdGgsIHRoaXMuaGVpZ2h0ID0gYXJnLmhlaWdodCwgdGhpcy5tYXhFbGVtZW50cyA9IGFyZy5tYXhFbGVtZW50cztcbiAgICBpZiAoKHRoaXMud2lkdGggPT0gbnVsbCkgfHwgKHRoaXMuaGVpZ2h0ID09IG51bGwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIHF1YWR0cmVlIGRpbWVuc2lvbnMuXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy54ID09IG51bGwpIHtcbiAgICAgIHRoaXMueCA9IDA7XG4gICAgfVxuICAgIGlmICh0aGlzLnkgPT0gbnVsbCkge1xuICAgICAgdGhpcy55ID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMubWF4RWxlbWVudHMgPT0gbnVsbCkge1xuICAgICAgdGhpcy5tYXhFbGVtZW50cyA9IDE7XG4gICAgfVxuICAgIHRoaXMuY29udGVudHMgPSBbXTtcbiAgICB0aGlzLm92ZXJzaXplZCA9IFtdO1xuICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgaWYgKHRoaXMueCA8IDAgfHwgdGhpcy55IDwgMCB8fCB0aGlzLndpZHRoIDwgMSB8fCB0aGlzLmhlaWdodCA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkRpbWVuc2lvbnMgYW5kIGNvb3JkaW5hdGVzIG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIpO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhFbGVtZW50cyA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBtYXhpbXVtIG51bWJlciBvZiBlbGVtZW50cyBiZWZvcmUgYSBzcGxpdCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci5cIik7XG4gICAgfVxuICAgIHRoYXQgPSB0aGlzO1xuICAgIHRoaXMuY2hpbGRyZW4gPSB7XG4gICAgICBcIk5XXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCxcbiAgICAgICAgICAgIHk6IHRoYXQueSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmVlOiBudWxsXG4gICAgICB9LFxuICAgICAgXCJORVwiOiB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICB4OiB0aGF0LnggKyBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICB5OiB0aGF0LnksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsKHRoYXQud2lkdGggLyAyKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIlNXXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCxcbiAgICAgICAgICAgIHk6IHRoYXQueSArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwodGhhdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIlNFXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHk6IHRoYXQueSArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC5oZWlnaHQgLyAyKSwgMSksXG4gICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsKHRoYXQud2lkdGggLyAyKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5jZWlsKHRoYXQuaGVpZ2h0IC8gMiksXG4gICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmVlOiBudWxsXG4gICAgICB9XG4gICAgfTtcbiAgICBmb3IgKGNoaWxkIGluIHRoaXMuY2hpbGRyZW4pIHtcbiAgICAgIHRoaXMuY2hpbGRyZW5bY2hpbGRdLmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMudHJlZSA9IHRoaXMuY3JlYXRlKCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBnZXRDZW50ZXIgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgdmFyIHJlZiwgcmVmMTtcbiAgICByZXR1cm4ge1xuICAgICAgeDogTWF0aC5mbG9vcigoKHJlZiA9IGl0ZW0ud2lkdGgpICE9IG51bGwgPyByZWYgOiAxKSAvIDIpICsgaXRlbS54LFxuICAgICAgeTogTWF0aC5mbG9vcigoKHJlZjEgPSBpdGVtLmhlaWdodCkgIT0gbnVsbCA/IHJlZjEgOiAxKSAvIDIpICsgaXRlbS55XG4gICAgfTtcbiAgfTtcblxuICB2YWxpZGF0ZUVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgaWYgKCF0eXBlb2YgZWxlbWVudCA9PT0gXCJvYmplY3RcIiB8fCAoZWxlbWVudC54ID09IG51bGwpIHx8IChlbGVtZW50LnkgPT0gbnVsbCkgfHwgZWxlbWVudC54IDwgMCB8fCBlbGVtZW50LnkgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPYmplY3QgbXVzdCBjb250YWluIHggb3IgeSBwb3NpdGlvbnMgYXMgYXJndW1lbnRzLCBhbmQgdGhleSBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiKTtcbiAgICB9XG4gICAgaWYgKChlbGVtZW50ICE9IG51bGwgPyBlbGVtZW50LndpZHRoIDogdm9pZCAwKSA8IDAgfHwgKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQuaGVpZ2h0IDogdm9pZCAwKSA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIldpZHRoIGFuZCBoZWlnaHQgbXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7XG4gICAgfVxuICB9O1xuXG4gIGNhbGN1bGF0ZURpcmVjdGlvbiA9IGZ1bmN0aW9uKGVsZW1lbnQsIHRyZWUpIHtcbiAgICBlbGVtZW50O1xuICAgIHZhciBxdWFkQ2VudGVyO1xuICAgIHF1YWRDZW50ZXIgPSBnZXRDZW50ZXIodHJlZSk7XG4gICAgaWYgKGVsZW1lbnQueCA8IHF1YWRDZW50ZXIueCkge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJOV1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU1dcIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJORVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU0VcIjtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgaXNPdmVyc2l6ZWQgPSBmdW5jdGlvbihlbGVtZW50LCB0cmVlKSB7XG4gICAgdmFyIHJlZiwgcmVmMTtcbiAgICByZXR1cm4gZWxlbWVudC54IDwgdHJlZS54IHx8IGVsZW1lbnQueCArICgocmVmID0gZWxlbWVudC53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDApID49IHRyZWUueCArIHRyZWUud2lkdGggfHwgZWxlbWVudC55IDwgdHJlZS55IHx8IGVsZW1lbnQueSArICgocmVmMSA9IGVsZW1lbnQuaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDApID49IHRyZWUueSArIHRyZWUuaGVpZ2h0O1xuICB9O1xuXG4gIG9ic2VydmUgPSBmdW5jdGlvbihpdGVtLCB0cmVlKSB7XG4gICAgdmFyIHdyaXRlQWNjZXNzb3JzO1xuICAgIHdyaXRlQWNjZXNzb3JzID0gZnVuY3Rpb24ocHJvcE5hbWUpIHtcbiAgICAgIGl0ZW1bXCJfXCIgKyBwcm9wTmFtZV0gPSBpdGVtW3Byb3BOYW1lXTtcbiAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoaXRlbSwgcHJvcE5hbWUsIHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0cmVlLnJlbW92ZSh0aGlzKTtcbiAgICAgICAgICB0aGlzW1wiX1wiICsgcHJvcE5hbWVdID0gdmFsO1xuICAgICAgICAgIHJldHVybiB0cmVlLnB1c2godGhpcyk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbXCJfXCIgKyBwcm9wTmFtZV07XG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB3cml0ZUFjY2Vzc29ycyhcInhcIik7XG4gICAgd3JpdGVBY2Nlc3NvcnMoXCJ5XCIpO1xuICAgIHdyaXRlQWNjZXNzb3JzKFwid2lkdGhcIik7XG4gICAgcmV0dXJuIHdyaXRlQWNjZXNzb3JzKFwiaGVpZ2h0XCIpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oaXRlbSwgZG9PYnNlcnZlKSB7XG4gICAgdmFyIGMsIGVsZW1lbnQsIGZpZm8sIGosIGxlbiwgcmVmLCByZWxhdGVkQ2hpbGQsIHRvcCwgdHJlZTtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgaWYgKGRvT2JzZXJ2ZSkge1xuICAgICAgb2JzZXJ2ZShpdGVtLCB0aGlzKTtcbiAgICB9XG4gICAgZmlmbyA9IFtcbiAgICAgIHtcbiAgICAgICAgdHJlZTogdGhpcyxcbiAgICAgICAgZWxlbWVudDogaXRlbVxuICAgICAgfVxuICAgIF07XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF07XG4gICAgICB0cmVlID0gdG9wLnRyZWU7XG4gICAgICBlbGVtZW50ID0gdG9wLmVsZW1lbnQ7XG4gICAgICB0cmVlLnNpemUrKztcbiAgICAgIHJlbGF0ZWRDaGlsZCA9IHRyZWUuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGVsZW1lbnQsIHRyZWUpXTtcbiAgICAgIGlmICh0cmVlLndpZHRoID09PSAxIHx8IHRyZWUuaGVpZ2h0ID09PSAxIHx8IGlzT3ZlcnNpemVkKGVsZW1lbnQsIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKSkpIHtcbiAgICAgICAgdHJlZS5vdmVyc2l6ZWQucHVzaChlbGVtZW50KTtcbiAgICAgIH0gZWxzZSBpZiAodHJlZS5zaXplIDw9IHRyZWUubWF4RWxlbWVudHMpIHtcbiAgICAgICAgdHJlZS5jb250ZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmlmby5wdXNoKHtcbiAgICAgICAgICB0cmVlOiByZWxhdGVkQ2hpbGQuZ2V0KCksXG4gICAgICAgICAgZWxlbWVudDogZWxlbWVudFxuICAgICAgICB9KTtcbiAgICAgICAgcmVmID0gdHJlZS5jb250ZW50cztcbiAgICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgICAgYyA9IHJlZltqXTtcbiAgICAgICAgICBmaWZvLnB1c2goe1xuICAgICAgICAgICAgdHJlZTogdHJlZS5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24oYywgdHJlZSldLmdldCgpLFxuICAgICAgICAgICAgZWxlbWVudDogY1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRyZWUuY29udGVudHMgPSBbXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgaW5kZXgsIHJlbGF0ZWRDaGlsZDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgaW5kZXggPSB0aGlzLm92ZXJzaXplZC5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLm92ZXJzaXplZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaW5kZXggPSB0aGlzLmNvbnRlbnRzLmluZGV4T2YoaXRlbSk7XG4gICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgIHRoaXMub3ZlcnNpemVkLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB0aGlzLnNpemUtLTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZWxhdGVkQ2hpbGQgPSB0aGlzLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihpdGVtLCB0aGlzKV07XG4gICAgaWYgKHJlbGF0ZWRDaGlsZC50cmVlID09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHJlbGF0ZWRDaGlsZC50cmVlLnJlbW92ZShpdGVtKSkge1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUuc2l6ZSA9PT0gMCkge1xuICAgICAgICByZWxhdGVkQ2hpbGQudHJlZSA9IG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuY29sbGlkaW5nID0gZnVuY3Rpb24oaXRlbSwgY29sbGlzaW9uRnVuY3Rpb24pIHtcbiAgICB2YXIgY2hpbGQsIGVsdCwgZmlmbywgaXRlbXMsIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQoaXRlbSk7XG4gICAgaWYgKGNvbGxpc2lvbkZ1bmN0aW9uID09IG51bGwpIHtcbiAgICAgIGNvbGxpc2lvbkZ1bmN0aW9uID0gZnVuY3Rpb24oZWx0MSwgZWx0Mikge1xuICAgICAgICB2YXIgcmVmLCByZWYxLCByZWYyLCByZWYzO1xuICAgICAgICByZXR1cm4gIShlbHQxLnggPiBlbHQyLnggKyAoKHJlZiA9IGVsdDIud2lkdGgpICE9IG51bGwgPyByZWYgOiAwKSB8fCBlbHQxLnggKyAoKHJlZjEgPSBlbHQxLndpZHRoKSAhPSBudWxsID8gcmVmMSA6IDApIDwgZWx0Mi54IHx8IGVsdDEueSA+IGVsdDIueSArICgocmVmMiA9IGVsdDIuaGVpZ2h0KSAhPSBudWxsID8gcmVmMiA6IDApIHx8IGVsdDEueSArICgocmVmMyA9IGVsdDEuaGVpZ2h0KSAhPSBudWxsID8gcmVmMyA6IDApIDwgZWx0Mi55KTtcbiAgICAgIH07XG4gICAgfVxuICAgIGl0ZW1zID0gW107XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNwbGljZSgwLCAxKVswXTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgZWx0ID0gcmVmW2pdO1xuICAgICAgICBpZiAoZWx0ICE9PSBpdGVtICYmIGNvbGxpc2lvbkZ1bmN0aW9uKGl0ZW0sIGVsdCkpIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKGVsdCAhPT0gaXRlbSAmJiBjb2xsaXNpb25GdW5jdGlvbihpdGVtLCBlbHQpKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0b3AuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGl0ZW0sIHRvcCldO1xuICAgICAgaWYgKGlzT3ZlcnNpemVkKGl0ZW0sIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKSkpIHtcbiAgICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgICBpZiAodG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIGZpZm8ucHVzaCh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChyZWxhdGVkQ2hpbGQudHJlZSAhPSBudWxsKSB7XG4gICAgICAgIGZpZm8ucHVzaChyZWxhdGVkQ2hpbGQudHJlZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICByZXR1cm4gdGhpcy53aGVyZShxdWVyeSk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLndoZXJlID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICB2YXIgY2hlY2ssIGVsdCwgZmlmbywgaXRlbXMsIGosIGssIGtleSwgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHJlbGF0ZWRDaGlsZCwgdG9wO1xuICAgIGlmICh0eXBlb2YgcXVlcnkgPT09IFwib2JqZWN0XCIgJiYgKHF1ZXJ5LnggPT0gbnVsbCkgJiYgKHF1ZXJ5LnkgPT0gbnVsbCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbmQoZnVuY3Rpb24oZWx0KSB7XG4gICAgICAgIHZhciBjaGVjaywga2V5O1xuICAgICAgICBjaGVjayA9IHRydWU7XG4gICAgICAgIGZvciAoa2V5IGluIHF1ZXJ5KSB7XG4gICAgICAgICAgaWYgKHF1ZXJ5W2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hlY2s7XG4gICAgICB9KTtcbiAgICB9XG4gICAgdmFsaWRhdGVFbGVtZW50KHF1ZXJ5KTtcbiAgICBpdGVtcyA9IFtdO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF07XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgIGlmIChxdWVyeVtrZXldICE9PSBlbHRba2V5XSkge1xuICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGVsdCA9IHJlZjFba107XG4gICAgICAgIGNoZWNrID0gdHJ1ZTtcbiAgICAgICAgZm9yIChrZXkgaW4gcXVlcnkpIHtcbiAgICAgICAgICBpZiAocXVlcnlba2V5XSAhPT0gZWx0W2tleV0pIHtcbiAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjaGVjaykge1xuICAgICAgICAgIGl0ZW1zLnB1c2goZWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihxdWVyeSwgdG9wKV07XG4gICAgICBpZiAocmVsYXRlZENoaWxkLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICBmaWZvLnB1c2gocmVsYXRlZENoaWxkLnRyZWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmVhY2ggPSBmdW5jdGlvbihhY3Rpb24pIHtcbiAgICB2YXIgY2hpbGQsIGZpZm8sIGksIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCB0b3A7XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNwbGljZSgwLCAxKVswXTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaSA9IHJlZltqXTtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGFjdGlvbihpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMSA9IHRvcC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKHR5cGVvZiBhY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGFjdGlvbihpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChjaGlsZCBpbiB0b3AuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbihwcmVkaWNhdGUpIHtcbiAgICB2YXIgY2hpbGQsIGZpZm8sIGksIGl0ZW1zLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgdG9wO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgaXRlbXMgPSBbXTtcbiAgICB3aGlsZSAoZmlmby5sZW5ndGggPiAwKSB7XG4gICAgICB0b3AgPSBmaWZvLnNwbGljZSgwLCAxKVswXTtcbiAgICAgIHJlZiA9IHRvcC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgaSA9IHJlZltqXTtcbiAgICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpKSA6IHZvaWQgMCkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgaSA9IHJlZjFba107XG4gICAgICAgIGlmICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaSkgOiB2b2lkIDApIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGNoaWxkIGluIHRvcC5jaGlsZHJlbikge1xuICAgICAgICBpZiAodG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHZhciBkZWVwY2xvbmU7XG4gICAgZGVlcGNsb25lID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB2YXIgY2hpbGQsIGNvcHljYXQsIGl0ZW0sIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWYyLCByZWYzO1xuICAgICAgY29weWNhdCA9IG5ldyBRdWFkdHJlZSh7XG4gICAgICAgIHg6IHRhcmdldC54LFxuICAgICAgICB5OiB0YXJnZXQueSxcbiAgICAgICAgd2lkdGg6IHRhcmdldC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0YXJnZXQuaGVpZ2h0LFxuICAgICAgICBtYXhFbGVtZW50czogdGFyZ2V0Lm1heEVsZW1lbnRzXG4gICAgICB9KTtcbiAgICAgIGNvcHljYXQuc2l6ZSA9IDA7XG4gICAgICBmb3IgKGNoaWxkIGluIHRhcmdldC5jaGlsZHJlbikge1xuICAgICAgICBpZiAoISh0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb3B5Y2F0LmNoaWxkcmVuW2NoaWxkXS50cmVlID0gZGVlcGNsb25lKHRhcmdldC5jaGlsZHJlbltjaGlsZF0udHJlZSk7XG4gICAgICAgIGNvcHljYXQuc2l6ZSArPSAocmVmID0gKHJlZjEgPSBjb3B5Y2F0LmNoaWxkcmVuW2NoaWxkXS50cmVlKSAhPSBudWxsID8gcmVmMS5zaXplIDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogMDtcbiAgICAgIH1cbiAgICAgIHJlZjIgPSB0YXJnZXQub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmMi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpdGVtID0gcmVmMltqXTtcbiAgICAgICAgaWYgKChwcmVkaWNhdGUgPT0gbnVsbCkgfHwgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpdGVtKSA6IHZvaWQgMCkpIHtcbiAgICAgICAgICBjb3B5Y2F0Lm92ZXJzaXplZC5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYzID0gdGFyZ2V0LmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjMubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGl0ZW0gPSByZWYzW2tdO1xuICAgICAgICBpZiAoKHByZWRpY2F0ZSA9PSBudWxsKSB8fCAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGl0ZW0pIDogdm9pZCAwKSkge1xuICAgICAgICAgIGNvcHljYXQuY29udGVudHMucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29weWNhdC5zaXplICs9IGNvcHljYXQub3ZlcnNpemVkLmxlbmd0aCArIGNvcHljYXQuY29udGVudHMubGVuZ3RoO1xuICAgICAgaWYgKGNvcHljYXQuc2l6ZSA9PT0gMCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjb3B5Y2F0O1xuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIGRlZXBjbG9uZSh0aGlzKTtcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUucmVqZWN0ID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGkpIHtcbiAgICAgIHJldHVybiAhKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpKSA6IHZvaWQgMCk7XG4gICAgfSk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLnZpc2l0ID0gZnVuY3Rpb24oYWN0aW9uKSB7XG4gICAgdmFyIGNoaWxkLCBmaWZvLCB0aGF0O1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdGhhdCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgYWN0aW9uLmJpbmQodGhhdCkoKTtcbiAgICAgIGZvciAoY2hpbGQgaW4gdGhhdC5jaGlsZHJlbikge1xuICAgICAgICBpZiAodGhhdC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgZmlmby5wdXNoKHRoYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIHJldHVybiBRdWFkdHJlZTtcblxufSkoKTtcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlICE9PSBudWxsKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gUXVhZHRyZWU7XG59XG4iXX0=
