var Quadtree;Quadtree=function(){function e(t){var n,i;if(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.maxElements=t.maxElements,null==this.width||null==this.height)throw new Error("Missing quadtree dimensions.");if(null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.maxElements&&(this.maxElements=1),this.contents=[],this.oversized=[],this.size=0,this.x<0||this.y<0||this.width<1||this.height<1)throw new Error("Dimensions must be positive integers.");if(this.maxElements<1)throw new Error("The maximum of elements by leaf must be a positive integer.");i=this,this.children={NW:{create:function(){return new e({x:i.x,y:i.y,width:Math.max(Math.floor(i.width/2),1),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},NE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y,width:Math.ceil(i.width/2),height:Math.max(Math.floor(i.height/2),1),maxElements:i.maxElements})},tree:null},SW:{create:function(){return new e({x:i.x,y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.max(Math.floor(i.width/2),1),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null},SE:{create:function(){return new e({x:i.x+Math.max(Math.floor(i.width/2),1),y:i.y+Math.max(Math.floor(i.height/2),1),width:Math.ceil(i.width/2),height:Math.ceil(i.height/2),maxElements:i.maxElements})},tree:null}};for(n in this.children)this.children[n].get=function(){return null!=this.tree?this.tree:(this.tree=this.create(),this.tree)}}var t,n,i,h;return n=function(e){var t,n;return{x:Math.floor((null!=(t=e.width)?t:1)/2)+e.x,y:Math.floor((null!=(n=e.height)?n:1)/2)+e.y}},h=function(e){if(null==e.x||null==e.y||e.x<0||e.y<0)throw new Error("Object must contain x or y positions as arguments, and they must be positive integers.");if((null!=e?e.width:void 0)<0||(null!=e?e.height:void 0)<0)throw new Error("Width and height arguments must be positive integers.")},t=function(e,t){var i;return i=n(t),e.x<i.x?e.y<i.y?"NW":"SW":e.y<i.y?"NE":"SE"},i=function(e,t){var n,i;return e.x<t.x||e.x+(null!=(n=e.width)?n:0)>=t.x+t.width||e.y<t.y||e.y+(null!=(i=e.height)?i:0)>=t.y+t.height},e.prototype.push=function(e){var n,r,l,s,o,u,c,d,f;for(h(e),l=[{tree:this,element:e}];l.length>0;)if(d=l.splice(0,1)[0],f=d.tree,r=d.element,f.size++,c=f.children[t(r,f)],1===f.width||1===f.height||i(r,c.create()))f.oversized.push(r);else if(f.size<=f.maxElements)f.contents.push(r);else{for(l.push({tree:c.get(),element:r}),u=f.contents,s=0,o=u.length;o>s;s++)n=u[s],l.push({tree:f.children[t(n,f)].get(),element:n});f.contents=[]}return this},e.prototype.remove=function(e){var n,i;return h(e),n=this.oversized.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(n=this.contents.indexOf(e),n>-1?(this.oversized.splice(n,1),this.size--,!0):(i=this.children[t(e,this)],null==i.tree?!1:i.tree.remove(e)?(this.size--,0===i.tree.size&&(i.tree=null),!0):!1))},e.prototype.colliding=function(e,n){var r,l,s,o,u,c,d,f,a,m,p,x;for(h(e),null==n&&(n=function(e,t){var n,i,h,r;return!(e.x>t.x+(null!=(n=t.width)?n:0)||e.x+(null!=(i=e.width)?i:0)<t.x||e.y>t.y+(null!=(h=t.height)?h:0)||e.y+(null!=(r=e.height)?r:0)<t.y)}),o=[],s=[this];s.length>0;){for(x=s.splice(0,1)[0],a=x.oversized,u=0,d=a.length;d>u;u++)l=a[u],l!==e&&n(e,l)&&o.push(l);for(m=x.contents,c=0,f=m.length;f>c;c++)l=m[c],l!==e&&n(e,l)&&o.push(l);if(p=x.children[t(e,x)],i(e,p.create()))for(r in x.children)null!=x.children[r].tree&&s.push(x.children[r].tree);else null!=p.tree&&s.push(p.tree)}return o},e.prototype.get=function(e){return this.where(e)},e.prototype.where=function(e){var n,i,r,l,s,o,u,c,d,f,a,m,p;for(h(e),l=[],r=[this];r.length>0;){for(p=r.splice(0,1)[0],f=p.oversized,s=0,c=f.length;c>s;s++){i=f[s],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}for(a=p.contents,o=0,d=a.length;d>o;o++){i=a[o],n=!0;for(u in e)e[u]!==i[u]&&(n=!1);n&&l.push(i)}m=p.children[t(e,p)],null!=m.tree&&r.push(m.tree)}return l},e.prototype.each=function(e){var t,n,i,h,r,l,s,o,u,c;for(n=[this];n.length>0;){for(c=n.splice(0,1)[0],o=c.oversized,h=0,l=o.length;l>h;h++)i=o[h],"function"==typeof e&&e(i);for(u=c.contents,r=0,s=u.length;s>r;r++)i=u[r],"function"==typeof e&&e(i);for(t in c.children)null!=c.children[t].tree&&n.push(c.children[t].tree)}return this},e.prototype.find=function(e){var t,n,i,h,r,l,s,o,u,c,d;for(n=[this],h=[];n.length>0;){for(d=n.splice(0,1)[0],u=d.oversized,r=0,s=u.length;s>r;r++)i=u[r],("function"==typeof e?e(i):void 0)&&h.push(i);for(c=d.contents,l=0,o=c.length;o>l;l++)i=c[l],("function"==typeof e?e(i):void 0)&&h.push(i);for(t in d.children)null!=d.children[t].tree&&n.push(d.children[t].tree)}return h},e.prototype.filter=function(t){var n;return(n=function(i){var h,r,l,s,o,u,c,d,f,a,m;r=new e({x:i.x,y:i.y,width:i.width,height:i.height,maxElements:i.maxElements}),r.size=0;for(h in i.children)null!=i.children[h].tree&&(r.children[h].tree=n(i.children[h].tree),r.size+=null!=(d=null!=(f=r.children[h].tree)?f.size:void 0)?d:0);for(a=i.oversized,s=0,u=a.length;u>s;s++)l=a[s],(null==t||("function"==typeof t?t(l):void 0))&&r.oversized.push(l);for(m=i.contents,o=0,c=m.length;c>o;o++)l=m[o],(null==t||("function"==typeof t?t(l):void 0))&&r.contents.push(l);return r.size+=r.oversized.length+r.contents.length,0===r.size?null:r})(this)},e.prototype.visit=function(e){var t,n,i;for(n=[this];n.length>0;){i=n.splice(0,1)[0],e.bind(i)();for(t in i.children)null!=i.children[t].tree&&n.push(i.children[t].tree)}return this},e}(),"undefined"!=typeof module&&null!==module&&(module.exports=Quadtree);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1YWR0cmVlLmNvZmZlZSIsInF1YWR0cmVlLmpzIl0sIm5hbWVzIjpbIlF1YWR0cmVlIiwiYXJnIiwiY2hpbGQiLCJ0aGF0IiwidGhpcyIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJtYXhFbGVtZW50cyIsIkVycm9yIiwiY29udGVudHMiLCJvdmVyc2l6ZWQiLCJzaXplIiwiY2hpbGRyZW4iLCJOVyIsImNyZWF0ZSIsIk1hdGgiLCJtYXgiLCJmbG9vciIsInRyZWUiLCJORSIsImNlaWwiLCJTVyIsIlNFIiwiZ2V0IiwiY2FsY3VsYXRlRGlyZWN0aW9uIiwiZ2V0Q2VudGVyIiwiaXNPdmVyc2l6ZWQiLCJ2YWxpZGF0ZUVsZW1lbnQiLCJpdGVtIiwicmVmIiwicmVmMSIsImVsZW1lbnQiLCJxdWFkQ2VudGVyIiwicHJvdG90eXBlIiwicHVzaCIsImMiLCJmaWZvIiwiaiIsImxlbiIsInJlbGF0ZWRDaGlsZCIsInRvcCIsImxlbmd0aCIsInNwbGljZSIsInJlbW92ZSIsImluZGV4IiwiaW5kZXhPZiIsImNvbGxpZGluZyIsImNvbGxpc2lvbkZ1bmN0aW9uIiwiZWx0IiwiaXRlbXMiLCJrIiwibGVuMSIsImVsdDEiLCJlbHQyIiwicmVmMiIsInJlZjMiLCJwYXJhbXMiLCJ3aGVyZSIsImNoZWNrIiwia2V5IiwiZWFjaCIsImFjdGlvbiIsImkiLCJmaW5kIiwicHJlZGljYXRlIiwiZmlsdGVyIiwiZGVlcGNsb25lIiwidGFyZ2V0IiwiY29weWNhdCIsInZpc2l0IiwiYmluZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVNBLEdBQUFBLFNBQU1BLFVBQUEsV0FPVyxRQUFBQSxHQUFDQyxHQUVWLEdBQUFDLEdBQUFDLENBQUEsSUFGV0MsS0FBQ0MsRUFBQUosRUFBQUksRUFBR0QsS0FBQ0UsRUFBQUwsRUFBQUssRUFBR0YsS0FBQ0csTUFBQU4sRUFBQU0sTUFBT0gsS0FBQ0ksT0FBQVAsRUFBQU8sT0FBUUosS0FBQ0ssWUFBQVIsRUFBQVEs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QkEsRUFBV3BDLEdBQUEsVUFDMUR3QyxFQUFRM0QsU0FBU3lCLEtBQUtOLEVBRzFCLE9BREF3QyxHQUFRekQsTUFBUXlELEVBQVExRCxVQUFVK0IsT0FBUzJCLEVBQVEzRCxTQUFTZ0MsT0FDekMsSUFBaEIyQixFQUFRekQsS0FBZSxLQUFVeUQsSUFFOUJsRSxPQ2dHaEJKLEVBQVNtQyxVRDVGUG9DLE1BQU8sU0FBQ1IsR0FDSixHQUFBN0QsR0FBQW9DLEVBQUFuQyxDQUVBLEtBRkFtQyxHQUFRbEMsTUFFRmtDLEVBQUtLLE9BQVMsR0FBcEIsQ0FDSXhDLEVBQU9tQyxFQUFLTSxPQUFPLEVBQUcsR0FBRyxHQUN6Qm1CLEVBQU9TLEtBQUtyRSxJQUVaLEtBQUFELElBQUFDLEdBQUFXLFNBQWdDLE1BQUFYLEVBQUFXLFNBQUFaLEdBQUFrQixNQUM1QmtCLEVBQUtGLEtBQUtqQyxFQUFLVyxTQUFTWixHQUFPa0IsTUNnRzNDLE1EL0ZJaEIsT0NrR0NKLEtBSWEsbUJBQVh5RSxTQUFxQyxPQUFYQSxTRG5HckNBLE9BQVFDLFFBQVUxRSIsImZpbGUiOiJxdWFkdHJlZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiMgcXVhZHRyZWUtbGliXG4jID09PT09PT09PT09PVxuI1xuIyAqKlF1YWR0cmVlLWxpYioqIGlzIGFuIGVhc3kgdG8gdXNlLCBkZXZlbG9wZXIgZnJpZW5kbHkgcXVhZHRyZWUgbGlicmFyeVxuIyB3aGljaCBjb250YWlucyBtYW55IGhlbHBlciBtZXRob2RzIHRvIGFkZCwgcmVtb3ZlLCBpdGVyYXRlLCBmaWx0ZXIsIHNpbXVsYXRlXG4jIGNvbGxpc2lvbnMgb3ZlciAyZCBlbGVtZW50cyBhbmQgbW9yZS5cbiNcbiMgVGhlIFF1YWR0cmVlIGNsYXNzLlxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tXG5jbGFzcyBRdWFkdHJlZVxuICAgICMgIyMjIENvbnN0cnVjdG9yXG5cbiAgICAjIEEgcXVhZHRyZWUgaXMgYnVpbHQgd2l0aCA1IG1haW4gcGFyYW1ldGVycyA6XG4gICAgIyAtIHggJiB5IGNvb3JkaW5hdGVzIHdoaWNoIGFyZSBhbHdheXMgKDAsMCkgZm9yIHRoZSByb290IHRyZWUuXG4gICAgIyAtIGl0cyBkaW1lbnNpb25zICh3aWR0aCAmIGxlbmd0aCksIG1hbmRhdG9yeS5cbiAgICAjIC0gdGhlIG1heGltdW0gbnVtYmVyIG9mIGVsZW1lbnRzIGJlZm9yZSBpdCAnc3BsaXRzJyBpbnRvIHN1YnRyZWVzLiAoZGVmYXVsdHMgdG8gMSlcbiAgICBjb25zdHJ1Y3RvcjogKHtAeCwgQHksIEB3aWR0aCwgQGhlaWdodCwgQG1heEVsZW1lbnRzfSkgLT5cbiAgICAgICAgIyBBbiBlcnJvciBpcyB0aHJvd24gd2hlbiB0aGUgd2lkdGggJiBsZW5ndGggYXJlIG5vdCBwYXNzZWQgYXMgY29uc3RydWN0b3IgYXJndW1lbnRzLlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJNaXNzaW5nIHF1YWR0cmVlIGRpbWVuc2lvbnMuXCIgaWYgbm90IEB3aWR0aD8gb3Igbm90IEBoZWlnaHQ/XG4gICAgICAgIEB4ID89IDBcbiAgICAgICAgQHkgPz0gMFxuICAgICAgICBAbWF4RWxlbWVudHMgPz0gMVxuICAgICAgICBAY29udGVudHMgPSBbXVxuICAgICAgICBAb3ZlcnNpemVkID0gW11cbiAgICAgICAgQHNpemUgPSAwXG5cbiAgICAgICAgIyBEaW1lbnNpb24gJiBjb29yZGluYXRlcyBhcmUgY2hlY2tlZCwgYW5kIGVuIGVycm9yIGlzIHRocm93biBpbiBjYXNlIG9mIGJhZCBpbnB1dC5cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yIFwiRGltZW5zaW9ucyBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiIGlmIEB4IDwgMCBvciBAeSA8IDAgb3IgQHdpZHRoIDwgMSBvciBAaGVpZ2h0IDwgMVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJUaGUgbWF4aW11bSBvZiBlbGVtZW50cyBieSBsZWFmIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLlwiIGlmIEBtYXhFbGVtZW50cyA8IDFcblxuICAgICAgICB0aGF0ID0gQFxuXG4gICAgICAgICMgVGhlIHN1YnRyZWVzIGxpc3QsIGJ5IHBvc2l0aW9uLiBDb250YWlucyB0aGUgc3VidHJlZSwgYSBjcmVhdGlvbiBtZXRob2Qgd2l0aCBwcm9wZXIgY29vcmRpbmF0ZXMgJiBkaW1lbnNpb25zIGFuZCBhIGdldHRlci5cbiAgICAgICAgQGNoaWxkcmVuID0ge1xuICAgICAgICAgICAgIyBOb3J0aHdlc3QgdHJlZS5cbiAgICAgICAgICAgIFwiTldcIjpcbiAgICAgICAgICAgICAgICBjcmVhdGU6ICgpIC0+XG4gICAgICAgICAgICAgICAgICAgIG5ldyBRdWFkdHJlZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB4OiB0aGF0LnhcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHRoYXQueVxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQud2lkdGggLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heCAoTWF0aC5mbG9vciB0aGF0LmhlaWdodCAvIDIpLCAxXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRyZWU6IG51bGxcbiAgICAgICAgICAgICMgTm9ydGhlYXN0IHRyZWUuXG4gICAgICAgICAgICBcIk5FXCI6XG4gICAgICAgICAgICAgICAgY3JlYXRlOiAoKSAtPlxuICAgICAgICAgICAgICAgICAgICBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogdGhhdC54ICsgTWF0aC5tYXggKE1hdGguZmxvb3IgdGhhdC53aWR0aCAvIDIpLCAxXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiB0aGF0LnlcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwgdGhhdC53aWR0aCAvIDJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXggKE1hdGguZmxvb3IgdGhhdC5oZWlnaHQgLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB0cmVlOiBudWxsXG4gICAgICAgICAgICAjIFNvdXRod2VzdCB0cmVlLlxuICAgICAgICAgICAgXCJTV1wiOlxuICAgICAgICAgICAgICAgIGNyZWF0ZTogKCkgLT5cbiAgICAgICAgICAgICAgICAgICAgbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHRoYXQueFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5tYXggKE1hdGguZmxvb3IgdGhhdC5oZWlnaHQgLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4IChNYXRoLmZsb29yIHRoYXQud2lkdGggLyAyKSwgMVxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwgdGhhdC5oZWlnaHQgLyAyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhFbGVtZW50czogdGhhdC5tYXhFbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRyZWU6IG51bGxcbiAgICAgICAgICAgICMgU291dGhlYXN0IHRyZWUuXG4gICAgICAgICAgICBcIlNFXCI6XG4gICAgICAgICAgICAgICAgY3JlYXRlOiAoKSAtPlxuICAgICAgICAgICAgICAgICAgICBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogdGhhdC54ICsgTWF0aC5tYXggKE1hdGguZmxvb3IgdGhhdC53aWR0aCAvIDIpLCAxXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiB0aGF0LnkgKyBNYXRoLm1heCAoTWF0aC5mbG9vciB0aGF0LmhlaWdodCAvIDIpLCAxXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5jZWlsIHRoYXQud2lkdGggLyAyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGguY2VpbCB0aGF0LmhlaWdodCAvIDJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgdHJlZTogbnVsbFxuICAgICAgICB9XG4gICAgICAgICMgQWRkaW5nIGEgZ2V0dGVyIHdoaWNoIGFsc28gY3JlYXRlcyB0aGUgdHJlZSBpZiBuZWVkZWQuXG4gICAgICAgIGZvciBjaGlsZCBvZiBAY2hpbGRyZW5cbiAgICAgICAgICAgIEBjaGlsZHJlbltjaGlsZF0uZ2V0ID0gKCkgLT5cbiAgICAgICAgICAgICAgICBpZiBAdHJlZT8gdGhlbiBAdHJlZSBlbHNlIEB0cmVlID0gQGNyZWF0ZSgpOyBAdHJlZVxuXG4gICAgIyAjIyMgSW50ZXJuYWwgbWV0aG9kcyAmIHZhcnNcblxuICAgICMgUmV0cmlldmVzIHRoZSBjZW50ZXIgY29vcmRpbmF0ZXMgb2YgYW4gZWxlbWVudC5cbiAgICBnZXRDZW50ZXIgPSAoaXRlbSkgLT5cbiAgICAgICAgeDogTWF0aC5mbG9vcigoaXRlbS53aWR0aCAgPyAxKSAvIDIpICsgaXRlbS54XG4gICAgICAgIHk6IE1hdGguZmxvb3IoKGl0ZW0uaGVpZ2h0ID8gMSkgLyAyKSArIGl0ZW0ueVxuXG4gICAgIyBWYWxpZGF0ZXMgYW4gZWxlbWVudCBvZiB0aGUgcXVhZHRyZWUsIGJ5IGNoZWNraW5nIGl0cyBwcm9wZXJ0aWVzIGZvciB4ICYgeSBjb29yZGluYXRlcywgYW5kIHByb3BlciB2YWx1ZS5cbiAgICB2YWxpZGF0ZUVsZW1lbnQgPSAoZWxlbWVudCkgLT5cbiAgICAgICAgaWYgbm90IHR5cGVvZiBlbGVtZW50IGlzIFwib2JqZWN0XCIgb3Igbm90IGVsZW1lbnQueD8gb3Igbm90IGVsZW1lbnQueT8gb3IgZWxlbWVudC54IDwgMCBvciBlbGVtZW50LnkgPCAwXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJPYmplY3QgbXVzdCBjb250YWluIHggb3IgeSBwb3NpdGlvbnMgYXMgYXJndW1lbnRzLCBhbmQgdGhleSBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiXG4gICAgICAgIGlmIGVsZW1lbnQ/LndpZHRoIDwgMCBvciBlbGVtZW50Py5oZWlnaHQgPCAwXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJXaWR0aCBhbmQgaGVpZ2h0IGFyZ3VtZW50cyBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiXG5cbiAgICAjIENhbGN1bGF0ZXMgdGhlIGRpcmVjdGlvbiBvZiB0aGUgc3VidHJlZSB3aGljaCBhbiBlbGVtZW50IGJlbG9uZ3MgdG8uXG4gICAgY2FsY3VsYXRlRGlyZWN0aW9uID0gKGVsZW1lbnQsIHRyZWUpIC0+XG4gICAgICAgIGVsZW1lbnRcbiAgICAgICAgcXVhZENlbnRlciA9IGdldENlbnRlciB0cmVlXG5cbiAgICAgICAgaWYgZWxlbWVudC54IDwgcXVhZENlbnRlci54XG4gICAgICAgICAgICBpZiBlbGVtZW50LnkgPCBxdWFkQ2VudGVyLnkgdGhlbiBcIk5XXCJcbiAgICAgICAgICAgIGVsc2UgXCJTV1wiXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGlmIGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSB0aGVuIFwiTkVcIlxuICAgICAgICAgICAgZWxzZSBcIlNFXCJcblxuICAgICMgRGV0ZXJtaW5lcyBpZiBhbiBlbGVtZW50IGlzIG92ZXJzaXplZC4gQW4gb3ZlcnNpemVkIGVsZW1lbnQgaXMgYW4gZWxlbWVudCAndG9vIGJpZycgdG8gZml0IGludG8gc3VidHJlZXMuXG4gICAgaXNPdmVyc2l6ZWQgPSAoZWxlbWVudCwgdHJlZSkgLT5cbiAgICAgICAgZWxlbWVudC54IDwgdHJlZS54IG9yXG4gICAgICAgIGVsZW1lbnQueCArIChlbGVtZW50LndpZHRoID8gMCkgPj0gdHJlZS54ICsgdHJlZS53aWR0aCBvclxuICAgICAgICBlbGVtZW50LnkgPCB0cmVlLnkgb3JcbiAgICAgICAgZWxlbWVudC55ICsgKGVsZW1lbnQuaGVpZ2h0ID8gMCkgPj0gdHJlZS55ICsgdHJlZS5oZWlnaHRcblxuICAgICMgIyMjIEV4cG9zZWQgbWV0aG9kc1xuXG4gICAgIyBBZGQgYW4gZWxlbWVudCB0byB0aGUgcXVhZHRyZWUuXG4gICAgcHVzaDogKGl0ZW0pIC0+XG4gICAgICAgIHZhbGlkYXRlRWxlbWVudCBpdGVtXG5cbiAgICAgICAgZmlmbyA9IFt0cmVlOiBALCBlbGVtZW50OiBpdGVtXVxuXG4gICAgICAgIHdoaWxlIGZpZm8ubGVuZ3RoID4gMFxuICAgICAgICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF1cbiAgICAgICAgICAgIHRyZWUgPSB0b3AudHJlZVxuICAgICAgICAgICAgZWxlbWVudCA9IHRvcC5lbGVtZW50XG5cbiAgICAgICAgICAgIHRyZWUuc2l6ZSsrXG5cbiAgICAgICAgICAgIHJlbGF0ZWRDaGlsZCA9IHRyZWUuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uIGVsZW1lbnQsIHRyZWVdXG5cbiAgICAgICAgICAgIGlmIHRyZWUud2lkdGggaXMgMSBvciB0cmVlLmhlaWdodCBpcyAxIG9yIGlzT3ZlcnNpemVkIGVsZW1lbnQsIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKVxuICAgICAgICAgICAgICAgIHRyZWUub3ZlcnNpemVkLnB1c2ggZWxlbWVudFxuXG4gICAgICAgICAgICBlbHNlIGlmIHRyZWUuc2l6ZSA8PSB0cmVlLm1heEVsZW1lbnRzXG4gICAgICAgICAgICAgICAgdHJlZS5jb250ZW50cy5wdXNoIGVsZW1lbnRcblxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGZpZm8ucHVzaCB0cmVlOiByZWxhdGVkQ2hpbGQuZ2V0KCksIGVsZW1lbnQ6IGVsZW1lbnRcblxuICAgICAgICAgICAgICAgIGZvciBjIGluIHRyZWUuY29udGVudHNcbiAgICAgICAgICAgICAgICAgICAgZmlmby5wdXNoIHRyZWU6IHRyZWUuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uIGMsIHRyZWVdLmdldCgpLCBlbGVtZW50OiBjXG5cbiAgICAgICAgICAgICAgICB0cmVlLmNvbnRlbnRzID0gW11cbiAgICAgICAgQFxuXG4gICAgIyBSZW1vdmVzIGFuIGVsZW1lbnQgZnJvbSB0aGUgcXVhZHRyZWUuXG4gICAgcmVtb3ZlOiAoaXRlbSkgLT5cbiAgICAgICAgdmFsaWRhdGVFbGVtZW50IGl0ZW1cblxuICAgICAgICBpbmRleCA9IEBvdmVyc2l6ZWQuaW5kZXhPZiBpdGVtXG4gICAgICAgIGlmIGluZGV4ID4gLSAxXG4gICAgICAgICAgICBAb3ZlcnNpemVkLnNwbGljZSBpbmRleCwgMVxuICAgICAgICAgICAgQHNpemUtLVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgaW5kZXggPSBAY29udGVudHMuaW5kZXhPZiBpdGVtXG4gICAgICAgIGlmIGluZGV4ID4gLSAxXG4gICAgICAgICAgICBAb3ZlcnNpemVkLnNwbGljZSBpbmRleCwgMVxuICAgICAgICAgICAgQHNpemUtLVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcblxuICAgICAgICByZWxhdGVkQ2hpbGQgPSBAY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uIGl0ZW0sIEBdXG4gICAgICAgIGlmIG5vdCByZWxhdGVkQ2hpbGQudHJlZT9cbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgICAgIGlmIHJlbGF0ZWRDaGlsZC50cmVlLnJlbW92ZSBpdGVtXG4gICAgICAgICAgICBAc2l6ZS0tXG4gICAgICAgICAgICByZWxhdGVkQ2hpbGQudHJlZSA9IG51bGwgaWYgcmVsYXRlZENoaWxkLnRyZWUuc2l6ZSBpcyAwXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGZhbHNlXG5cbiAgICAjIFJldHVybnMgYW4gYXJyYXkgb2YgZWxlbWVudHMgd2hpY2ggY29sbGlkZXMgd2l0aCBgaXRlbWAgcHJvdmlkZWRgLlxuXG4gICAgIyBgaXRlbWAgaXMgYW4gb2JqZWN0IGhhdmluZyB4LCB5LCB3aWR0aCAmIGhlaWdodCBwcm9wZXJ0aWVzLlxuXG4gICAgIyBUaGUgZGVmYXVsdCBjb2xsaXNpb24gZnVuY3Rpb24gaXMgYSBiYXNpYyBib3VuZGluZyBib3ggYWxnb3JpdGhtLiBZb3UgY2FuIGNoYW5nZSBpdCBieSBwcm92aWRpbmcgYSBmdW5jdGlvbiBhcyBhIHNlY29uZCBhcmd1bWVudC5cbiAgICAjYGBgamF2YXNjcmlwdFxuICAgICNjb2xsaWRpbmcoe3g6IDEwLCB5OiAyMH0sIGZ1bmN0aW9uKGVsZW1lbnQxLCBlbGVtZW50Mil7XG4gICAgIyAgICByZXR1cm4gLy9QcmVkaWNhdGVcbiAgICAjfSlcbiAgICAjYGBgXG4gICAgY29sbGlkaW5nOiAoaXRlbSwgY29sbGlzaW9uRnVuY3Rpb24pIC0+XG4gICAgICAgIHZhbGlkYXRlRWxlbWVudCBpdGVtXG5cbiAgICAgICAgaWYgbm90IGNvbGxpc2lvbkZ1bmN0aW9uP1xuICAgICAgICAgICAgY29sbGlzaW9uRnVuY3Rpb24gPSAoZWx0MSwgZWx0MikgLT5cbiAgICAgICAgICAgICAgICBub3QoZWx0MS54ID4gZWx0Mi54ICsgKGVsdDIud2lkdGggPyAwKSAgICAgIG9yXG4gICAgICAgICAgICAgICAgICAgIGVsdDEueCArIChlbHQxLndpZHRoID8gMCkgPCBlbHQyLnggICAgICBvclxuICAgICAgICAgICAgICAgICAgICBlbHQxLnkgPiBlbHQyLnkgKyAoZWx0Mi5oZWlnaHQgPyAwKSAgICAgb3JcbiAgICAgICAgICAgICAgICAgICAgZWx0MS55ICsgKGVsdDEuaGVpZ2h0ID8gMCkgPCBlbHQyLnkpXG5cbiAgICAgICAgaXRlbXMgPSBbXVxuICAgICAgICBmaWZvID0gW0BdXG5cbiAgICAgICAgd2hpbGUgZmlmby5sZW5ndGggPiAwXG4gICAgICAgICAgICB0b3AgPSBmaWZvLnNwbGljZSgwLCAxKVswXVxuXG4gICAgICAgICAgICBmb3IgZWx0IGluIHRvcC5vdmVyc2l6ZWQgd2hlbiBlbHQgaXNudCBpdGVtIGFuZCBjb2xsaXNpb25GdW5jdGlvbiBpdGVtLCBlbHQgdGhlbiBpdGVtcy5wdXNoIGVsdFxuICAgICAgICAgICAgZm9yIGVsdCBpbiB0b3AuY29udGVudHMgIHdoZW4gZWx0IGlzbnQgaXRlbSBhbmQgY29sbGlzaW9uRnVuY3Rpb24gaXRlbSwgZWx0IHRoZW4gaXRlbXMucHVzaCBlbHRcblxuICAgICAgICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbiBpdGVtLCB0b3BdXG5cbiAgICAgICAgICAgIGlmIGlzT3ZlcnNpemVkIGl0ZW0sIHJlbGF0ZWRDaGlsZC5jcmVhdGUoKVxuICAgICAgICAgICAgICAgIGZvciBjaGlsZCBvZiB0b3AuY2hpbGRyZW4gd2hlbiB0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWU/XG4gICAgICAgICAgICAgICAgICAgIGZpZm8ucHVzaCB0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWVcblxuICAgICAgICAgICAgZWxzZSBpZiByZWxhdGVkQ2hpbGQudHJlZT9cbiAgICAgICAgICAgICAgICBmaWZvLnB1c2ggcmVsYXRlZENoaWxkLnRyZWVcblxuICAgICAgICBpdGVtc1xuXG4gICAgIyBBbGlhcyBvZiBgd2hlcmVgLlxuICAgIGdldDogKHBhcmFtcykgLT5cbiAgICAgICAgQHdoZXJlIHBhcmFtc1xuICAgICMgUmV0dXJucyBhbiBhcnJheSBvZiBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwYXJhbWV0ZXIgcHJvcGVydGllcy5cbiAgICB3aGVyZTogKHBhcmFtcykgLT5cbiAgICAgICAgdmFsaWRhdGVFbGVtZW50IHBhcmFtc1xuXG4gICAgICAgIGl0ZW1zID0gW11cbiAgICAgICAgZmlmbyA9IFtAXVxuXG4gICAgICAgIHdoaWxlIGZpZm8ubGVuZ3RoID4gMFxuICAgICAgICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF1cblxuICAgICAgICAgICAgZm9yIGVsdCBpbiB0b3Aub3ZlcnNpemVkXG4gICAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlXG4gICAgICAgICAgICAgICAgZm9yIGtleSBvZiBwYXJhbXMgd2hlbiBwYXJhbXNba2V5XSBpc250IGVsdFtrZXldIHRoZW4gY2hlY2sgPSBmYWxzZVxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2ggZWx0IGlmIGNoZWNrXG4gICAgICAgICAgICBmb3IgZWx0IGluIHRvcC5jb250ZW50c1xuICAgICAgICAgICAgICAgIGNoZWNrID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGZvciBrZXkgb2YgcGFyYW1zIHdoZW4gcGFyYW1zW2tleV0gaXNudCBlbHRba2V5XSB0aGVuIGNoZWNrID0gZmFsc2VcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoIGVsdCBpZiBjaGVja1xuXG4gICAgICAgICAgICByZWxhdGVkQ2hpbGQgPSB0b3AuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uIHBhcmFtcywgdG9wXVxuXG4gICAgICAgICAgICBpZiByZWxhdGVkQ2hpbGQudHJlZT9cbiAgICAgICAgICAgICAgICBmaWZvLnB1c2ggcmVsYXRlZENoaWxkLnRyZWVcblxuICAgICAgICBpdGVtc1xuXG4gICAgIyBGb3IgZWFjaCBlbGVtZW50LCBwZXJmb3JtcyBgYWN0aW9uYCB3aGVyZSBgYWN0aW9uYCBpcyBhIGZ1bmN0aW9uLlxuICAgICNgYGBqYXZhc2NyaXB0XG4gICAgI3F1YWQuZWFjaChmdW5jdGlvbihpdGVtKXsgY29uc29sZS5sb2coaXRlbSkgfSlcbiAgICAjYGBgXG4gICAgZWFjaDogKGFjdGlvbikgLT5cbiAgICAgICAgZmlmbyA9IFtAXVxuXG4gICAgICAgIHdoaWxlIGZpZm8ubGVuZ3RoID4gMFxuICAgICAgICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF1cbiAgICAgICAgICAgIGZvciBpIGluIHRvcC5vdmVyc2l6ZWQgdGhlbiBhY3Rpb24/KGkpXG4gICAgICAgICAgICBmb3IgaSBpbiB0b3AuY29udGVudHMgdGhlbiBhY3Rpb24/KGkpXG5cbiAgICAgICAgICAgIGZvciBjaGlsZCBvZiB0b3AuY2hpbGRyZW4gd2hlbiB0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWU/XG4gICAgICAgICAgICAgICAgZmlmby5wdXNoIHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZVxuICAgICAgICBAXG5cbiAgICAjIFJldHVybnMgYW4gYXJyYXkgb2YgZWxlbWVudHMgd2hpY2ggdmFsaWRhdGUgdGhlIHByZWRpY2F0ZS5cbiAgICBmaW5kOiAocHJlZGljYXRlKSAtPlxuICAgICAgICBmaWZvID0gW0BdXG4gICAgICAgIGl0ZW1zID0gW11cblxuICAgICAgICB3aGlsZSBmaWZvLmxlbmd0aCA+IDBcbiAgICAgICAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdXG4gICAgICAgICAgICBmb3IgaSBpbiB0b3Aub3ZlcnNpemVkIHdoZW4gcHJlZGljYXRlPyhpKSB0aGVuIGl0ZW1zLnB1c2ggaVxuICAgICAgICAgICAgZm9yIGkgaW4gdG9wLmNvbnRlbnRzIHdoZW4gcHJlZGljYXRlPyhpKSB0aGVuIGl0ZW1zLnB1c2ggaVxuXG4gICAgICAgICAgICBmb3IgY2hpbGQgb2YgdG9wLmNoaWxkcmVuIHdoZW4gdG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlP1xuICAgICAgICAgICAgICAgIGZpZm8ucHVzaCB0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWVcbiAgICAgICAgaXRlbXNcblxuICAgICMgUmV0dXJucyBhICoqY2xvbmVkKiogYFF1YWR0cmVlYCBvYmplY3Qgd2hpY2ggY29udGFpbnMgb25seSB0aGUgZWxlbWVudHMgdGhhdCB2YWxpZGF0ZSB0aGUgcHJlZGljYXRlLlxuICAgIGZpbHRlcjogKHByZWRpY2F0ZSkgLT5cbiAgICAgICAgZGVlcGNsb25lID0gKHRhcmdldCkgLT5cbiAgICAgICAgICAgIGNvcHljYXQgPSBuZXcgUXVhZHRyZWUgeDogdGFyZ2V0LngsIHk6IHRhcmdldC55LCB3aWR0aDogdGFyZ2V0LndpZHRoLCBoZWlnaHQ6IHRhcmdldC5oZWlnaHQsIG1heEVsZW1lbnRzOiB0YXJnZXQubWF4RWxlbWVudHNcbiAgICAgICAgICAgIGNvcHljYXQuc2l6ZSA9IDBcbiAgICAgICAgICAgIGZvciBjaGlsZCBvZiB0YXJnZXQuY2hpbGRyZW4gd2hlbiB0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWU/XG4gICAgICAgICAgICAgICAgY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZSA9IGRlZXBjbG9uZSB0YXJnZXQuY2hpbGRyZW5bY2hpbGRdLnRyZWVcbiAgICAgICAgICAgICAgICBjb3B5Y2F0LnNpemUgKz0gY29weWNhdC5jaGlsZHJlbltjaGlsZF0udHJlZT8uc2l6ZSA/IDBcblxuICAgICAgICAgICAgZm9yIGl0ZW0gaW4gdGFyZ2V0Lm92ZXJzaXplZCB3aGVuIG5vdCBwcmVkaWNhdGU/IG9yIHByZWRpY2F0ZT8oaXRlbSlcbiAgICAgICAgICAgICAgICBjb3B5Y2F0Lm92ZXJzaXplZC5wdXNoIGl0ZW1cbiAgICAgICAgICAgIGZvciBpdGVtIGluIHRhcmdldC5jb250ZW50cyB3aGVuIG5vdCBwcmVkaWNhdGU/IG9yIHByZWRpY2F0ZT8oaXRlbSlcbiAgICAgICAgICAgICAgICBjb3B5Y2F0LmNvbnRlbnRzLnB1c2ggaXRlbVxuXG4gICAgICAgICAgICBjb3B5Y2F0LnNpemUgKz0gY29weWNhdC5vdmVyc2l6ZWQubGVuZ3RoICsgY29weWNhdC5jb250ZW50cy5sZW5ndGhcbiAgICAgICAgICAgIGlmIGNvcHljYXQuc2l6ZSBpcyAwIHRoZW4gbnVsbCBlbHNlIGNvcHljYXRcblxuICAgICAgICBkZWVwY2xvbmUgQFxuXG4gICAgIyBWaXNpdHMgZWFjaCB0cmVlICYgc3VidHJlZSBjb250YWluZWQgaW4gdGhlIGBRdWFkdHJlZWAgb2JqZWN0LlxuICAgICMgRm9yIGVhY2ggbm9kZSwgcGVyZm9ybXMgdGhlIGBhY3Rpb25gIGZ1bmN0aW9uLCBpbnNpZGUgd2hpY2ggYHRoaXNgaXMgYmluZGVkIHRvIHRoZSBub2RlIHRyZWUgb2JqZWN0LlxuICAgIHZpc2l0OiAoYWN0aW9uKSAtPlxuICAgICAgICBmaWZvID0gW0BdXG5cbiAgICAgICAgd2hpbGUgZmlmby5sZW5ndGggPiAwXG4gICAgICAgICAgICB0aGF0ID0gZmlmby5zcGxpY2UoMCwgMSlbMF1cbiAgICAgICAgICAgIGFjdGlvbi5iaW5kKHRoYXQpKClcblxuICAgICAgICAgICAgZm9yIGNoaWxkIG9mIHRoYXQuY2hpbGRyZW4gd2hlbiB0aGF0LmNoaWxkcmVuW2NoaWxkXS50cmVlP1xuICAgICAgICAgICAgICAgIGZpZm8ucHVzaCB0aGF0LmNoaWxkcmVuW2NoaWxkXS50cmVlXG4gICAgICAgIEBcblxuIyBSZXF1aXJlIGV4cG9ydC5cbm1vZHVsZT8uZXhwb3J0cyA9IFF1YWR0cmVlXG4iLCJ2YXIgUXVhZHRyZWU7XG5cblF1YWR0cmVlID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgY2FsY3VsYXRlRGlyZWN0aW9uLCBnZXRDZW50ZXIsIGlzT3ZlcnNpemVkLCB2YWxpZGF0ZUVsZW1lbnQ7XG5cbiAgZnVuY3Rpb24gUXVhZHRyZWUoYXJnKSB7XG4gICAgdmFyIGNoaWxkLCB0aGF0O1xuICAgIHRoaXMueCA9IGFyZy54LCB0aGlzLnkgPSBhcmcueSwgdGhpcy53aWR0aCA9IGFyZy53aWR0aCwgdGhpcy5oZWlnaHQgPSBhcmcuaGVpZ2h0LCB0aGlzLm1heEVsZW1lbnRzID0gYXJnLm1heEVsZW1lbnRzO1xuICAgIGlmICgodGhpcy53aWR0aCA9PSBudWxsKSB8fCAodGhpcy5oZWlnaHQgPT0gbnVsbCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgcXVhZHRyZWUgZGltZW5zaW9ucy5cIik7XG4gICAgfVxuICAgIGlmICh0aGlzLnggPT0gbnVsbCkge1xuICAgICAgdGhpcy54ID0gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMueSA9PSBudWxsKSB7XG4gICAgICB0aGlzLnkgPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5tYXhFbGVtZW50cyA9PSBudWxsKSB7XG4gICAgICB0aGlzLm1heEVsZW1lbnRzID0gMTtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50cyA9IFtdO1xuICAgIHRoaXMub3ZlcnNpemVkID0gW107XG4gICAgdGhpcy5zaXplID0gMDtcbiAgICBpZiAodGhpcy54IDwgMCB8fCB0aGlzLnkgPCAwIHx8IHRoaXMud2lkdGggPCAxIHx8IHRoaXMuaGVpZ2h0IDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGltZW5zaW9ucyBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXJzLlwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubWF4RWxlbWVudHMgPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbWF4aW11bSBvZiBlbGVtZW50cyBieSBsZWFmIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLlwiKTtcbiAgICB9XG4gICAgdGhhdCA9IHRoaXM7XG4gICAgdGhpcy5jaGlsZHJlbiA9IHtcbiAgICAgIFwiTldcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54LFxuICAgICAgICAgICAgeTogdGhhdC55LFxuICAgICAgICAgICAgd2lkdGg6IE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH0sXG4gICAgICBcIk5FXCI6IHtcbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgICAgIHg6IHRoYXQueCArIE1hdGgubWF4KE1hdGguZmxvb3IodGhhdC53aWR0aCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHk6IHRoYXQueSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwodGhhdC53aWR0aCAvIDIpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQuaGVpZ2h0IC8gMiksIDEpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiU1dcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54LFxuICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChNYXRoLmZsb29yKHRoYXQud2lkdGggLyAyKSwgMSksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGguY2VpbCh0aGF0LmhlaWdodCAvIDIpLFxuICAgICAgICAgICAgbWF4RWxlbWVudHM6IHRoYXQubWF4RWxlbWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdHJlZTogbnVsbFxuICAgICAgfSxcbiAgICAgIFwiU0VcIjoge1xuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgeDogdGhhdC54ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LndpZHRoIC8gMiksIDEpLFxuICAgICAgICAgICAgeTogdGhhdC55ICsgTWF0aC5tYXgoTWF0aC5mbG9vcih0aGF0LmhlaWdodCAvIDIpLCAxKSxcbiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmNlaWwodGhhdC53aWR0aCAvIDIpLFxuICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwodGhhdC5oZWlnaHQgLyAyKSxcbiAgICAgICAgICAgIG1heEVsZW1lbnRzOiB0aGF0Lm1heEVsZW1lbnRzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyZWU6IG51bGxcbiAgICAgIH1cbiAgICB9O1xuICAgIGZvciAoY2hpbGQgaW4gdGhpcy5jaGlsZHJlbikge1xuICAgICAgdGhpcy5jaGlsZHJlbltjaGlsZF0uZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50cmVlID0gdGhpcy5jcmVhdGUoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGdldENlbnRlciA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICB2YXIgcmVmLCByZWYxO1xuICAgIHJldHVybiB7XG4gICAgICB4OiBNYXRoLmZsb29yKCgocmVmID0gaXRlbS53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDEpIC8gMikgKyBpdGVtLngsXG4gICAgICB5OiBNYXRoLmZsb29yKCgocmVmMSA9IGl0ZW0uaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDEpIC8gMikgKyBpdGVtLnlcbiAgICB9O1xuICB9O1xuXG4gIHZhbGlkYXRlRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBpZiAoIXR5cGVvZiBlbGVtZW50ID09PSBcIm9iamVjdFwiIHx8IChlbGVtZW50LnggPT0gbnVsbCkgfHwgKGVsZW1lbnQueSA9PSBudWxsKSB8fCBlbGVtZW50LnggPCAwIHx8IGVsZW1lbnQueSA8IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk9iamVjdCBtdXN0IGNvbnRhaW4geCBvciB5IHBvc2l0aW9ucyBhcyBhcmd1bWVudHMsIGFuZCB0aGV5IG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlcnMuXCIpO1xuICAgIH1cbiAgICBpZiAoKGVsZW1lbnQgIT0gbnVsbCA/IGVsZW1lbnQud2lkdGggOiB2b2lkIDApIDwgMCB8fCAoZWxlbWVudCAhPSBudWxsID8gZWxlbWVudC5oZWlnaHQgOiB2b2lkIDApIDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiV2lkdGggYW5kIGhlaWdodCBhcmd1bWVudHMgbXVzdCBiZSBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7XG4gICAgfVxuICB9O1xuXG4gIGNhbGN1bGF0ZURpcmVjdGlvbiA9IGZ1bmN0aW9uKGVsZW1lbnQsIHRyZWUpIHtcbiAgICBlbGVtZW50O1xuICAgIHZhciBxdWFkQ2VudGVyO1xuICAgIHF1YWRDZW50ZXIgPSBnZXRDZW50ZXIodHJlZSk7XG4gICAgaWYgKGVsZW1lbnQueCA8IHF1YWRDZW50ZXIueCkge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJOV1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU1dcIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVsZW1lbnQueSA8IHF1YWRDZW50ZXIueSkge1xuICAgICAgICByZXR1cm4gXCJORVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiU0VcIjtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgaXNPdmVyc2l6ZWQgPSBmdW5jdGlvbihlbGVtZW50LCB0cmVlKSB7XG4gICAgdmFyIHJlZiwgcmVmMTtcbiAgICByZXR1cm4gZWxlbWVudC54IDwgdHJlZS54IHx8IGVsZW1lbnQueCArICgocmVmID0gZWxlbWVudC53aWR0aCkgIT0gbnVsbCA/IHJlZiA6IDApID49IHRyZWUueCArIHRyZWUud2lkdGggfHwgZWxlbWVudC55IDwgdHJlZS55IHx8IGVsZW1lbnQueSArICgocmVmMSA9IGVsZW1lbnQuaGVpZ2h0KSAhPSBudWxsID8gcmVmMSA6IDApID49IHRyZWUueSArIHRyZWUuaGVpZ2h0O1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oaXRlbSkge1xuICAgIHZhciBjLCBlbGVtZW50LCBmaWZvLCBqLCBsZW4sIHJlZiwgcmVsYXRlZENoaWxkLCB0b3AsIHRyZWU7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGZpZm8gPSBbXG4gICAgICB7XG4gICAgICAgIHRyZWU6IHRoaXMsXG4gICAgICAgIGVsZW1lbnQ6IGl0ZW1cbiAgICAgIH1cbiAgICBdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgdHJlZSA9IHRvcC50cmVlO1xuICAgICAgZWxlbWVudCA9IHRvcC5lbGVtZW50O1xuICAgICAgdHJlZS5zaXplKys7XG4gICAgICByZWxhdGVkQ2hpbGQgPSB0cmVlLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihlbGVtZW50LCB0cmVlKV07XG4gICAgICBpZiAodHJlZS53aWR0aCA9PT0gMSB8fCB0cmVlLmhlaWdodCA9PT0gMSB8fCBpc092ZXJzaXplZChlbGVtZW50LCByZWxhdGVkQ2hpbGQuY3JlYXRlKCkpKSB7XG4gICAgICAgIHRyZWUub3ZlcnNpemVkLnB1c2goZWxlbWVudCk7XG4gICAgICB9IGVsc2UgaWYgKHRyZWUuc2l6ZSA8PSB0cmVlLm1heEVsZW1lbnRzKSB7XG4gICAgICAgIHRyZWUuY29udGVudHMucHVzaChlbGVtZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpZm8ucHVzaCh7XG4gICAgICAgICAgdHJlZTogcmVsYXRlZENoaWxkLmdldCgpLFxuICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgICAgfSk7XG4gICAgICAgIHJlZiA9IHRyZWUuY29udGVudHM7XG4gICAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICAgIGMgPSByZWZbal07XG4gICAgICAgICAgZmlmby5wdXNoKHtcbiAgICAgICAgICAgIHRyZWU6IHRyZWUuY2hpbGRyZW5bY2FsY3VsYXRlRGlyZWN0aW9uKGMsIHRyZWUpXS5nZXQoKSxcbiAgICAgICAgICAgIGVsZW1lbnQ6IGNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0cmVlLmNvbnRlbnRzID0gW107XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgdmFyIGluZGV4LCByZWxhdGVkQ2hpbGQ7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGluZGV4ID0gdGhpcy5vdmVyc2l6ZWQuaW5kZXhPZihpdGVtKTtcbiAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5vdmVyc2l6ZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIHRoaXMuc2l6ZS0tO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGluZGV4ID0gdGhpcy5jb250ZW50cy5pbmRleE9mKGl0ZW0pO1xuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICB0aGlzLm92ZXJzaXplZC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy5zaXplLS07XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmVsYXRlZENoaWxkID0gdGhpcy5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24oaXRlbSwgdGhpcyldO1xuICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZS5yZW1vdmUoaXRlbSkpIHtcbiAgICAgIHRoaXMuc2l6ZS0tO1xuICAgICAgaWYgKHJlbGF0ZWRDaGlsZC50cmVlLnNpemUgPT09IDApIHtcbiAgICAgICAgcmVsYXRlZENoaWxkLnRyZWUgPSBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmNvbGxpZGluZyA9IGZ1bmN0aW9uKGl0ZW0sIGNvbGxpc2lvbkZ1bmN0aW9uKSB7XG4gICAgdmFyIGNoaWxkLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBsZW4sIGxlbjEsIHJlZiwgcmVmMSwgcmVsYXRlZENoaWxkLCB0b3A7XG4gICAgdmFsaWRhdGVFbGVtZW50KGl0ZW0pO1xuICAgIGlmIChjb2xsaXNpb25GdW5jdGlvbiA9PSBudWxsKSB7XG4gICAgICBjb2xsaXNpb25GdW5jdGlvbiA9IGZ1bmN0aW9uKGVsdDEsIGVsdDIpIHtcbiAgICAgICAgdmFyIHJlZiwgcmVmMSwgcmVmMiwgcmVmMztcbiAgICAgICAgcmV0dXJuICEoZWx0MS54ID4gZWx0Mi54ICsgKChyZWYgPSBlbHQyLndpZHRoKSAhPSBudWxsID8gcmVmIDogMCkgfHwgZWx0MS54ICsgKChyZWYxID0gZWx0MS53aWR0aCkgIT0gbnVsbCA/IHJlZjEgOiAwKSA8IGVsdDIueCB8fCBlbHQxLnkgPiBlbHQyLnkgKyAoKHJlZjIgPSBlbHQyLmhlaWdodCkgIT0gbnVsbCA/IHJlZjIgOiAwKSB8fCBlbHQxLnkgKyAoKHJlZjMgPSBlbHQxLmhlaWdodCkgIT0gbnVsbCA/IHJlZjMgOiAwKSA8IGVsdDIueSk7XG4gICAgICB9O1xuICAgIH1cbiAgICBpdGVtcyA9IFtdO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF07XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgaWYgKGVsdCAhPT0gaXRlbSAmJiBjb2xsaXNpb25GdW5jdGlvbihpdGVtLCBlbHQpKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChlbHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGVsdCA9IHJlZjFba107XG4gICAgICAgIGlmIChlbHQgIT09IGl0ZW0gJiYgY29sbGlzaW9uRnVuY3Rpb24oaXRlbSwgZWx0KSkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goZWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVsYXRlZENoaWxkID0gdG9wLmNoaWxkcmVuW2NhbGN1bGF0ZURpcmVjdGlvbihpdGVtLCB0b3ApXTtcbiAgICAgIGlmIChpc092ZXJzaXplZChpdGVtLCByZWxhdGVkQ2hpbGQuY3JlYXRlKCkpKSB7XG4gICAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgICAgaWYgKHRvcC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAocmVsYXRlZENoaWxkLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICBmaWZvLnB1c2gocmVsYXRlZENoaWxkLnRyZWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHBhcmFtcykge1xuICAgIHJldHVybiB0aGlzLndoZXJlKHBhcmFtcyk7XG4gIH07XG5cbiAgUXVhZHRyZWUucHJvdG90eXBlLndoZXJlID0gZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgdmFyIGNoZWNrLCBlbHQsIGZpZm8sIGl0ZW1zLCBqLCBrLCBrZXksIGxlbiwgbGVuMSwgcmVmLCByZWYxLCByZWxhdGVkQ2hpbGQsIHRvcDtcbiAgICB2YWxpZGF0ZUVsZW1lbnQocGFyYW1zKTtcbiAgICBpdGVtcyA9IFtdO1xuICAgIGZpZm8gPSBbdGhpc107XG4gICAgd2hpbGUgKGZpZm8ubGVuZ3RoID4gMCkge1xuICAgICAgdG9wID0gZmlmby5zcGxpY2UoMCwgMSlbMF07XG4gICAgICByZWYgPSB0b3Aub3ZlcnNpemVkO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGVsdCA9IHJlZltqXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICBpZiAocGFyYW1zW2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjEgPSB0b3AuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgZWx0ID0gcmVmMVtrXTtcbiAgICAgICAgY2hlY2sgPSB0cnVlO1xuICAgICAgICBmb3IgKGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICBpZiAocGFyYW1zW2tleV0gIT09IGVsdFtrZXldKSB7XG4gICAgICAgICAgICBjaGVjayA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hlY2spIHtcbiAgICAgICAgICBpdGVtcy5wdXNoKGVsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlbGF0ZWRDaGlsZCA9IHRvcC5jaGlsZHJlbltjYWxjdWxhdGVEaXJlY3Rpb24ocGFyYW1zLCB0b3ApXTtcbiAgICAgIGlmIChyZWxhdGVkQ2hpbGQudHJlZSAhPSBudWxsKSB7XG4gICAgICAgIGZpZm8ucHVzaChyZWxhdGVkQ2hpbGQudHJlZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaSwgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHRvcDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgcmVmID0gdG9wLm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpID0gcmVmW2pdO1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgYWN0aW9uKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZWYxID0gdG9wLmNvbnRlbnRzO1xuICAgICAgZm9yIChrID0gMCwgbGVuMSA9IHJlZjEubGVuZ3RoOyBrIDwgbGVuMTsgaysrKSB7XG4gICAgICAgIGkgPSByZWYxW2tdO1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgYWN0aW9uKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGNoaWxkIGluIHRvcC5jaGlsZHJlbikge1xuICAgICAgICBpZiAodG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlICE9IG51bGwpIHtcbiAgICAgICAgICBmaWZvLnB1c2godG9wLmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHZhciBjaGlsZCwgZmlmbywgaSwgaXRlbXMsIGosIGssIGxlbiwgbGVuMSwgcmVmLCByZWYxLCB0b3A7XG4gICAgZmlmbyA9IFt0aGlzXTtcbiAgICBpdGVtcyA9IFtdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRvcCA9IGZpZm8uc3BsaWNlKDAsIDEpWzBdO1xuICAgICAgcmVmID0gdG9wLm92ZXJzaXplZDtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgICAgICBpID0gcmVmW2pdO1xuICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGkpIDogdm9pZCAwKSB7XG4gICAgICAgICAgaXRlbXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmVmMSA9IHRvcC5jb250ZW50cztcbiAgICAgIGZvciAoayA9IDAsIGxlbjEgPSByZWYxLmxlbmd0aDsgayA8IGxlbjE7IGsrKykge1xuICAgICAgICBpID0gcmVmMVtrXTtcbiAgICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHByZWRpY2F0ZShpKSA6IHZvaWQgMCkge1xuICAgICAgICAgIGl0ZW1zLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoY2hpbGQgaW4gdG9wLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIGZpZm8ucHVzaCh0b3AuY2hpbGRyZW5bY2hpbGRdLnRyZWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbiAgfTtcblxuICBRdWFkdHJlZS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgdmFyIGRlZXBjbG9uZTtcbiAgICBkZWVwY2xvbmUgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgIHZhciBjaGlsZCwgY29weWNhdCwgaXRlbSwgaiwgaywgbGVuLCBsZW4xLCByZWYsIHJlZjEsIHJlZjIsIHJlZjM7XG4gICAgICBjb3B5Y2F0ID0gbmV3IFF1YWR0cmVlKHtcbiAgICAgICAgeDogdGFyZ2V0LngsXG4gICAgICAgIHk6IHRhcmdldC55LFxuICAgICAgICB3aWR0aDogdGFyZ2V0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRhcmdldC5oZWlnaHQsXG4gICAgICAgIG1heEVsZW1lbnRzOiB0YXJnZXQubWF4RWxlbWVudHNcbiAgICAgIH0pO1xuICAgICAgY29weWNhdC5zaXplID0gMDtcbiAgICAgIGZvciAoY2hpbGQgaW4gdGFyZ2V0LmNoaWxkcmVuKSB7XG4gICAgICAgIGlmICghKHRhcmdldC5jaGlsZHJlbltjaGlsZF0udHJlZSAhPSBudWxsKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvcHljYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUgPSBkZWVwY2xvbmUodGFyZ2V0LmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgY29weWNhdC5zaXplICs9IChyZWYgPSAocmVmMSA9IGNvcHljYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUpICE9IG51bGwgPyByZWYxLnNpemUgOiB2b2lkIDApICE9IG51bGwgPyByZWYgOiAwO1xuICAgICAgfVxuICAgICAgcmVmMiA9IHRhcmdldC5vdmVyc2l6ZWQ7XG4gICAgICBmb3IgKGogPSAwLCBsZW4gPSByZWYyLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIGl0ZW0gPSByZWYyW2pdO1xuICAgICAgICBpZiAoKHByZWRpY2F0ZSA9PSBudWxsKSB8fCAodHlwZW9mIHByZWRpY2F0ZSA9PT0gXCJmdW5jdGlvblwiID8gcHJlZGljYXRlKGl0ZW0pIDogdm9pZCAwKSkge1xuICAgICAgICAgIGNvcHljYXQub3ZlcnNpemVkLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlZjMgPSB0YXJnZXQuY29udGVudHM7XG4gICAgICBmb3IgKGsgPSAwLCBsZW4xID0gcmVmMy5sZW5ndGg7IGsgPCBsZW4xOyBrKyspIHtcbiAgICAgICAgaXRlbSA9IHJlZjNba107XG4gICAgICAgIGlmICgocHJlZGljYXRlID09IG51bGwpIHx8ICh0eXBlb2YgcHJlZGljYXRlID09PSBcImZ1bmN0aW9uXCIgPyBwcmVkaWNhdGUoaXRlbSkgOiB2b2lkIDApKSB7XG4gICAgICAgICAgY29weWNhdC5jb250ZW50cy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb3B5Y2F0LnNpemUgKz0gY29weWNhdC5vdmVyc2l6ZWQubGVuZ3RoICsgY29weWNhdC5jb250ZW50cy5sZW5ndGg7XG4gICAgICBpZiAoY29weWNhdC5zaXplID09PSAwKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvcHljYXQ7XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gZGVlcGNsb25lKHRoaXMpO1xuICB9O1xuXG4gIFF1YWR0cmVlLnByb3RvdHlwZS52aXNpdCA9IGZ1bmN0aW9uKGFjdGlvbikge1xuICAgIHZhciBjaGlsZCwgZmlmbywgdGhhdDtcbiAgICBmaWZvID0gW3RoaXNdO1xuICAgIHdoaWxlIChmaWZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoYXQgPSBmaWZvLnNwbGljZSgwLCAxKVswXTtcbiAgICAgIGFjdGlvbi5iaW5kKHRoYXQpKCk7XG4gICAgICBmb3IgKGNoaWxkIGluIHRoYXQuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRoYXQuY2hpbGRyZW5bY2hpbGRdLnRyZWUgIT0gbnVsbCkge1xuICAgICAgICAgIGZpZm8ucHVzaCh0aGF0LmNoaWxkcmVuW2NoaWxkXS50cmVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICByZXR1cm4gUXVhZHRyZWU7XG5cbn0pKCk7XG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1vZHVsZSAhPT0gbnVsbCkge1xuICBtb2R1bGUuZXhwb3J0cyA9IFF1YWR0cmVlO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9